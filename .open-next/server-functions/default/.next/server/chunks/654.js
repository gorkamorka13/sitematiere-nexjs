"use strict";exports.id=654,exports.ids=[654],exports.modules={4636:(a,b,c)=>{c.d(b,{V:()=>d});let d="https://pub-78c42489fd854dc3a6975810aa00edf2.r2.dev"},74654:(a,b,c)=>{c.d(b,{Ek:()=>h,deleteFromR2:()=>g,uploadToR2:()=>f});var d=c(91043);c(31701);var e=c(75829);async function f(a,b){let c=new Uint8Array(await a.arrayBuffer());return await e.WN.send(new d.PutObjectCommand({Bucket:e.Mk,Key:b,Body:c,ContentType:a.type})),function(a){if(e.Vs){let b=a.split("/").map(a=>encodeURIComponent(a)).join("/");return`${e.Vs}/${b}`}return`/api/files/serve/${encodeURIComponent(a)}`}(b)}async function g(a){await e.WN.send(new d.DeleteObjectCommand({Bucket:e.Mk,Key:a}))}function h(a){if(e.Vs&&a.startsWith(e.Vs))return a.replace(`${e.Vs}/`,"");let b=a.match(/\/api\/files\/serve\/(.+)$/);return b?decodeURIComponent(b[1]):a}},75829:(a,b,c)=>{c.d(b,{Mk:()=>m,Vs:()=>n,WN:()=>l});var d=c(91043);class e{statusCode;reason;headers;body;constructor(a){this.statusCode=a.statusCode,this.reason=a.reason,this.headers=a.headers||{},this.body=a.body}static isInstance(a){return!!a&&"number"==typeof a.statusCode&&"object"==typeof a.headers}}let f=a=>encodeURIComponent(a).replace(/[!'()*]/g,g),g=a=>`%${a.charCodeAt(0).toString(16).toUpperCase()}`;function h(a,b){return new Request(a,b)}let i={supported:void 0};class j{config;configProvider;static create(a){return"function"==typeof a?.handle?a:new j(a)}constructor(a){"function"==typeof a?this.configProvider=a().then(a=>a||{}):(this.config=a??{},this.configProvider=Promise.resolve(this.config)),void 0===i.supported&&(i.supported=!!("undefined"!=typeof Request&&"keepalive"in h("https://[::1]")))}destroy(){}async handle(a,{abortSignal:b,requestTimeout:c}={}){this.config||(this.config=await this.configProvider);let d=c??this.config.requestTimeout,g=!0===this.config.keepAlive,j=this.config.credentials;if(b?.aborted){let a=Error("Request aborted");return a.name="AbortError",Promise.reject(a)}let k=a.path,l=function(a){let b=[];for(let c of Object.keys(a).sort()){let d=a[c];if(c=f(c),Array.isArray(d))for(let a=0,e=d.length;a<e;a++)b.push(`${c}=${f(d[a])}`);else{let a=c;(d||"string"==typeof d)&&(a+=`=${f(d)}`),b.push(a)}}return b.join("&")}(a.query||{});l&&(k+=`?${l}`),a.fragment&&(k+=`#${a.fragment}`);let m="";if(null!=a.username||null!=a.password){let b=a.username??"",c=a.password??"";m=`${b}:${c}@`}let{port:n,method:o}=a,p=`${a.protocol}//${m}${a.hostname}${n?`:${n}`:""}${k}`,q="GET"===o||"HEAD"===o?void 0:a.body,r={body:q,headers:new Headers(a.headers),method:o,credentials:j};this.config?.cache&&(r.cache=this.config.cache),q&&(r.duplex="half"),"undefined"!=typeof AbortController&&(r.signal=b),i.supported&&(r.keepalive=g),"function"==typeof this.config.requestInit&&Object.assign(r,this.config.requestInit(a));let s=()=>{},t=[fetch(h(p,r)).then(a=>{let b=a.headers,c={};for(let a of b.entries())c[a[0]]=a[1];return void 0==a.body?a.blob().then(b=>({response:new e({headers:c,reason:a.statusText,statusCode:a.status,body:b})})):{response:new e({headers:c,reason:a.statusText,statusCode:a.status,body:a.body})}}),function(a=0){return new Promise((b,c)=>{a&&setTimeout(()=>{let b=Error(`Request did not complete within ${a} ms`);b.name="TimeoutError",c(b)},a)})}(d)];return b&&t.push(new Promise((a,c)=>{let d=()=>{let a=Error("Request aborted");a.name="AbortError",c(a)};"function"==typeof b.addEventListener?(b.addEventListener("abort",d,{once:!0}),s=()=>b.removeEventListener("abort",d)):b.onabort=d})),Promise.race(t).finally(s)}updateHttpClientConfig(a,b){this.config=void 0,this.configProvider=this.configProvider.then(c=>(c[a]=b,c))}httpHandlerConfigs(){return this.config??{}}}var k=c(4636);let l=new d.S3Client({region:"auto",endpoint:process.env.R2_ENDPOINT,credentials:{accessKeyId:process.env.R2_ACCESS_KEY_ID,secretAccessKey:process.env.R2_SECRET_ACCESS_KEY},requestHandler:new j}),m=process.env.R2_BUCKET_NAME||"sitematiere-files",n=process.env.R2_PUBLIC_URL||k.V}};