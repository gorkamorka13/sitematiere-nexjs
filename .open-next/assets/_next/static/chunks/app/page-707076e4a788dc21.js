(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{29644:(e,r,t)=>{Promise.resolve().then(t.bind(t,82778))},34705:(e,r,t)=>{"use strict";t.d(r,{o:()=>s});var a=t(30926);let s=(0,a.createServerReference)("60a2c91805d2dc02c83b71a94ede20c8ce63f3a080",a.callServer,void 0,a.findSourceMapURL,"addImageToSlideshow")},37565:(e,r,t)=>{"use strict";t.d(r,{Z:()=>l});var a=t(12115),s=t(47650);function l(e){let{children:r}=e,[t,l]=(0,a.useState)(!1);return((0,a.useEffect)(()=>(l(!0),()=>l(!1)),[]),t)?(0,s.createPortal)(r,document.body):null}},82778:(e,r,t)=>{"use strict";t.d(r,{default:()=>th});var a=t(95155),s=t(12115),l=t(30926);let i=(0,l.createServerReference)("403075bbb4ad5049ad0ede41a2a49a9b0bc4a4af30",l.callServer,void 0,l.findSourceMapURL,"getProjectMedia");var n=function(e){return e.PRS="PRS",e.PEB="PEB",e.MPB="MPB",e.MXB="MXB",e.UB="UB",e.PASSERELLE="PASSERELLE",e.AUTRE="AUTRE",e}({}),o=function(e){return e.DONE="DONE",e.CURRENT="CURRENT",e.PROSPECT="PROSPECT",e}({}),d=function(e){return e.PLAN="PLAN",e.FLAG="FLAG",e.CLIENT_LOGO="CLIENT_LOGO",e.PIN="PIN",e.OTHER="OTHER",e}({}),c=t(59072),g=t(67909);let x=(0,g.default)(()=>Promise.all([t.e(4804),t.e(1761),t.e(5383)]).then(t.bind(t,95383)),{loadableGenerated:{webpack:()=>[95383]},ssr:!1,loading:()=>(0,a.jsx)("p",{className:"flex items-center justify-center h-full text-gray-500 bg-gray-100 rounded-lg",children:"Chargement de la carte des projets..."})});function u(e){return(0,a.jsx)(x,{...e})}var m=t(84885),h=t(58734),p=t(24033),b=t(12108),f=t(89715),y=t(65229),j=t(42196),v=t(64813),w=t(80534),N=t(14285),k=t(38707),C=t(35299),S=t(39867);let A={debug:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t]},info:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t]},warn:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];console.warn("[WARN]",...r)},error:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];console.error("[ERROR]",...r)}};function E(e){return(0,s.useMemo)(()=>({debug:function(){for(var r=arguments.length,t=Array(r),a=0;a<r;a++)t[a]=arguments[a];return A.debug("[".concat(e,"]"),...t)},info:function(){for(var r=arguments.length,t=Array(r),a=0;a<r;a++)t[a]=arguments[a];return A.info("[".concat(e,"]"),...t)},warn:function(){for(var r=arguments.length,t=Array(r),a=0;a<r;a++)t[a]=arguments[a];return A.warn("[".concat(e,"]"),...t)},error:function(){for(var r=arguments.length,t=Array(r),a=0;a<r;a++)t[a]=arguments[a];return A.error("[".concat(e,"]"),...t)}}),[e])}var P=t(55172),R=t(23311),L=t(7496),D=t.n(L);function T(e,r){let t,a=Math.abs(e),s=Math.floor(a),l=(a-s)*60,i=Math.floor(l),n=((l-i)*60).toFixed(2);return t=r?e>=0?"N":"S":e>=0?"E":"W","".concat(s,"\xb0 ").concat(i,"' ").concat(n,'" ').concat(t)}function I(e){var r;let t=e.trim().replace(/\s+/g," ").match(/(-?\d+)[°\s]+(\d+)['′\s]+(\d+\.?\d*)[\"″\s]*([NSEW])?/i);if(!t)throw Error("Invalid DMS format: ".concat(e));let a=parseInt(t[1],10),s=parseInt(t[2],10),l=parseFloat(t[3]),i=null==(r=t[4])?void 0:r.toUpperCase(),n=a+s/60+l/3600;return("S"===i||"W"===i)&&(n=-n),n}let M=(0,g.default)(()=>Promise.all([t.e(4804),t.e(1761),t.e(5383)]).then(t.bind(t,95383)),{loadableGenerated:{webpack:()=>[95383]},ssr:!1}),z=(0,g.default)(()=>Promise.all([t.e(4804),t.e(1761),t.e(2780)]).then(t.bind(t,40399)),{loadableGenerated:{webpack:()=>[40399]},ssr:!1}),F=e=>{let{open:r,children:t}=e;return r?(0,a.jsx)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center bg-black/60 backdrop-blur-sm px-2",children:(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col border border-gray-100 dark:border-gray-700 overflow-hidden animate-in zoom-in-95 duration-200",children:t})}):null};function U(e){let{isOpen:r,onClose:t,project:l,allProjects:i=[],filteredProjects:n,images:o=[]}=e,d=n&&n.length>0?n:i,[c,g]=(0,s.useState)(!1),x=E("ProjectExportDialog"),[u,m]=(0,s.useState)(""),[h,p]=(0,s.useState)(null),b=s.useRef(null),[A,L]=(0,s.useState)({globalMap:!1,projectMap:!1,progress:!0,description:!0,documents:!1,lastPhoto:!0});if(!r||!l)return null;let I=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16/9;return new Promise((t,a)=>{let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{let l,i,n,o,d=document.createElement("canvas"),c=d.getContext("2d");if(!c)return a("Could not get canvas context");s.width/s.height>r?(i=s.height,l=s.height*r,n=(s.width-l)/2,o=0):(l=s.width,i=s.width/r,n=0,o=(s.height-i)/2),d.width=1200,d.height=d.width/r,c.drawImage(s,n,o,l,i,0,0,d.width,d.height);let g=e.toLowerCase().endsWith(".png");t(d.toDataURL(g?"image/png":"image/jpeg",.9))},s.onerror=()=>a("Failed to load image at ".concat(e)),s.src=e.startsWith("http")?e:window.location.origin+(e.startsWith("/")?e:"/"+e)})},U=async(e,r)=>{try{p(e);let t="global"===e?3e3:2e3;await new Promise(e=>setTimeout(e,t)),window.dispatchEvent(new Event("resize")),await new Promise(e=>setTimeout(e,500));let a=document.getElementById(r);if(!a)return x.error("Element ".concat(r," not found after JIT wait")),p(null),null;x.debug("Starting capture for ".concat(r));let s=await R.gO(a,{quality:.85,backgroundColor:"#ffffff",pixelRatio:1,cacheBust:!0,skipFonts:!0,filter:e=>{if(e instanceof HTMLElement){var r;if("none"===e.style.display||(null==(r=e.classList)?void 0:r.contains("leaflet-control-container")))return!1}return!0}});return x.info("SUCCESS: ".concat(r)),p(null),s}catch(e){return x.error("Error capturing map ".concat(r,":"),e),p(null),null}},O=async()=>{g(!0);try{let a=new P.Ay({orientation:"p",unit:"mm",format:"a4"}),s=a.internal.pageSize.getWidth(),i=a.internal.pageSize.getHeight(),n=s-40,c=0,g=(e,r)=>(a.setFillColor(230,39,38),a.rect(20,r,4,8,"F"),a.setTextColor(230,39,38),a.setFontSize(14),a.setFont("helvetica","bold"),a.text(e.toUpperCase(),28,r+6.5),a.setDrawColor(229,231,235),a.line(20,r+12,s-20,r+12),r+20);a.setFillColor(230,39,38),a.roundedRect(20,10,32,10,1.5,1.5,"F"),a.setTextColor(255,255,255),a.setFontSize(14),a.setFont("times","bold"),a.text("Mati\xe8re",36,17,{align:"center"});try{let e=await I("/Matiere_logo_512.png",1).catch(()=>null);e&&a.addImage(e,"PNG",s-20-15,10,15,15)}catch(e){x.warn("Logo could not be loaded",e)}a.setTextColor(107,114,128),a.setFontSize(7),a.setFont("helvetica","normal"),a.text("GROUPE MATI\xc8RE",20,24),a.setDrawColor(229,231,235),a.line(20,26,s-20,26),c=38,a.setTextColor(230,39,38),a.setFontSize(22),a.setFont("helvetica","bold"),a.text("RAPPORT TECHNIQUE",20,c),c+=12,a.setTextColor(17,24,39),a.setFontSize(26),a.setFont("helvetica","bold"),a.text(l.name.toUpperCase(),20,c),c+=12;let u=[{label:"Identifiant du projet",value:l.projectCode||l.id},{label:"Localisation / Pays",value:l.country},{label:"Type d'ouvrage",value:l.type},{label:"Statut de r\xe9alisation",value:l.status},{label:"Coordonn\xe9es GPS",value:"".concat(T(l.latitude,!0)," | ").concat(T(l.longitude,!1))}],h=c;a.setFontSize(9),u.forEach((e,r)=>{let t=h+8*r;r%2==0&&(a.setFillColor(249,250,251),a.rect(20,t,n,8,"F")),a.setDrawColor(243,244,246),a.rect(20,t,n,8),a.setFont("helvetica","bold"),a.setTextColor(107,114,128),a.text(e.label,24,t+5.5),a.setFont("helvetica","normal"),a.setTextColor(17,24,39),a.text(String(e.value),74,t+5.5)}),c=h+8*u.length+15;let p=o[o.length-1];if(A.lastPhoto&&p)try{let e=await I(p.url,16/9),r=9*n/16;c+r>i-30&&(a.addPage(),c=30),a.addImage(e,"JPEG",20,c,n,r),c+=r+20}catch(e){x.warn("Could not load last photo for PDF",e)}if(A.globalMap||A.projectMap){m("Pr\xe9paration cartes..."),c=g("Localisation & Contexte",c);let e=(n-10)/2,r=3*e/4;if(c+r>i-30&&(a.addPage(),c=30),A.globalMap){m("Capture vue r\xe9gionale...");let t=await U("global","pdf-global-map-capture");t&&a.addImage(t,"JPEG",20,c,e,r)}if(A.projectMap){m("Capture vue locale...");let t=await U("project","pdf-project-map-capture");t&&a.addImage(t,"JPEG",20+e+10,c,e,r)}if(c+=r+8,a.setFontSize(9),a.setFont("helvetica","bold"),A.globalMap){a.setTextColor(79,70,229),a.text("Vue r\xe9gionale",20+e/2,c,{align:"center"}),a.setFont("helvetica","normal"),a.setTextColor(107,114,128),a.setFontSize(7);let r=d.length;a.text("".concat(r," projet").concat(r>1?"s":""," dans la r\xe9gion"),20+e/2,c+4,{align:"center"})}if(A.projectMap){let r=20+e+10;a.setFontSize(9),a.setFont("helvetica","bold"),a.setTextColor(79,70,229),a.text("Localisation pr\xe9cise",r+e/2,c,{align:"center"}),a.setFont("helvetica","normal"),a.setTextColor(107,114,128),a.setFontSize(7),a.text(l.name,r+e/2,c+4,{align:"center"});let t=T(l.latitude,!0),s=T(l.longitude,!1);a.text("".concat(t," | ").concat(s),r+e/2,c+8,{align:"center"})}m("Finalisation..."),c+=18}A.description&&l.description&&(c=g("Description du Projet",c),l.description.replace(/\\n/g,"\n").split("\n").filter(e=>e.trim().length>0).forEach((e,r)=>{if(c>i-20&&(a.addPage(),c=30),r%2==0&&(a.setFillColor(249,250,251),a.rect(20,c-5,n,8,"F")),e.includes(":")){let[r,...t]=e.split(":"),s=t.join(":").trim();a.setTextColor(107,114,128),a.setFontSize(9),a.setFont("helvetica","bold"),a.text(r.trim().toUpperCase(),24,c+1),a.setTextColor(31,41,55),a.setFont("helvetica","normal"),a.setFontSize(10);let l=a.splitTextToSize(s,n-60);a.text(l,75,c+1),c+=(Array.isArray(l)?5*l.length:5)+3}else{a.setTextColor(55,65,81),a.setFontSize(10),a.setFont("helvetica","normal");let r=a.splitTextToSize(e,n-8);a.text(r,24,c+1),c+=(Array.isArray(r)?5*r.length:5)+3}}),c+=12),A.progress&&(c>i-70&&(a.addPage(),c=30),c=g("Avancement du Projet",c),[{label:"Prospection",val:l.prospection},{label:"\xc9tudes",val:l.studies},{label:"Fabrication",val:l.fabrication},{label:"Transport",val:l.transport},{label:"Construction",val:l.construction}].forEach(e=>{if(a.setTextColor(17,24,39),a.setFontSize(9),a.setFont("helvetica","bold"),a.text(e.label.toUpperCase(),20,c),a.setFillColor(243,244,246),a.roundedRect(65,c-3.5,100,3.5,1.5,1.5,"F"),e.val>0){var r;let t=(r=e.val)>=100?[34,197,94]:r>50?[251,191,36]:r>25?[249,115,22]:[239,68,68];a.setFillColor(t[0],t[1],t[2]),a.roundedRect(65,c-3.5,e.val,3.5,1.5,1.5,"F")}a.setFont("helvetica","normal"),a.text("".concat(e.val,"%"),170,c),c+=10}),c+=10);let b=l.documents.filter(e=>"PLAN"===e.type||e.name.toLowerCase().includes("plan")),f=l.documents.filter(e=>"FLAG"!==e.type&&"CLIENT_LOGO"!==e.type&&"PLAN"!==e.type&&!e.name.toLowerCase().includes("plan"));if(A.documents&&(b.length>0||f.length>0)){if(c>i-50&&(a.addPage(),c=30),c=g("Plans & Documentation Technique",c),b.length>0){for(let e of b){c>i-40&&(a.addPage(),c=35),a.setTextColor(17,24,39),a.setFontSize(10),a.setFont("helvetica","bold"),a.text("Plan: ".concat(e.name),20,c),c+=8;let r=o.find(r=>r.name.toLowerCase().includes("plan")||r.name.toLowerCase().includes(e.name.split(".")[0].toLowerCase()));if(r)try{let e=await I(r.url,1.5),t=.8*n,s=2*t/3;c+s>i-20&&(a.addPage(),c=35),a.addImage(e,"JPEG",20+(n-t)/2,c,t,s),c+=s+12}catch(e){x.warn("Could not load plan preview",e)}}c+=5}f.length>0&&f.forEach(e=>{c>i-15&&(a.addPage(),c=35),a.setTextColor(107,114,128),a.setFontSize(9),a.setFont("helvetica","normal"),a.text("• ".concat(e.name," (").concat(e.type,")"),25,c),c+=6})}let y=a.internal.getNumberOfPages();for(let e=1;e<=y;e++)a.setPage(e),a.setDrawColor(229,231,235),a.line(20,i-15,s-20,i-15),a.setFontSize(8),a.setTextColor(107,114,128),a.text("Projet: ".concat(l.name," | Confidentialit\xe9: Interne Mati\xe8re"),20,i-10),a.text("Page ".concat(e," / ").concat(y),s-20,i-10,{align:"right"});let j="RAPPORT_TECHNIQUE_".concat(l.name.replace(/\s+/g,"_").toUpperCase(),".pdf");if(A.documents&&l.documents&&l.documents.length>0){m("Pr\xe9paration du ZIP avec annexes...");let t=new(D()),s=a.output("blob");t.file(j,s);let i=t.folder("Documents"),n=0;for(let t of l.documents)try{if(t.url){m("T\xe9l\xe9chargement des annexes... ".concat(n+1,"/").concat(l.documents.length));let a=await fetch(t.url);if(a.ok){let s=await a.blob(),l=t.name||"document_".concat(t.id);if(!l.includes(".")){var e,r;let a=null==(e=t.url.split(".").pop())?void 0:e.split("?")[0];if(a&&a.length>0&&a.length<10)l+=".".concat(a);else{let e=(null==(r=t.type)?void 0:r.toLowerCase())||"";e.includes("pdf")?l+=".pdf":e.includes("image")||e.includes("jpg")||e.includes("jpeg")?l+=".jpg":e.includes("png")?l+=".png":e.includes("dwg")||e.includes("autocad")?l+=".dwg":e.includes("doc")?l+=".docx":e.includes("xls")?l+=".xlsx":e.includes("zip")?l+=".zip":l+=".pdf"}}null==i||i.file(l,s),n++}}}catch(e){x.warn("Could not download document ".concat(t.id,":"),e)}m("G\xe9n\xe9ration du fichier ZIP...");let o=await t.generateAsync({type:"blob"}),d=URL.createObjectURL(o),c=document.createElement("a");c.href=d,c.download="RAPPORT_TECHNIQUE_".concat(l.name.replace(/\s+/g,"_").toUpperCase(),"_AVEC_ANNEXES.zip"),document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(d)}else a.save(j);t()}catch(e){x.error("PDF Generation failed:",e),alert("Erreur lors de la g\xe9n\xe9ration du rapport professionnel.")}finally{g(!1)}},V=e=>{let{id:r,label:t,icon:s,color:l,checked:i,onChange:n}=e;return(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-xl border border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/40 hover:bg-gray-50 dark:hover:bg-gray-900/60 transition-colors cursor-pointer",onClick:()=>n(!i),children:[(0,a.jsx)("input",{type:"checkbox",id:r,checked:i,onChange:e=>n(e.target.checked),className:"w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600 cursor-pointer",onClick:e=>e.stopPropagation()}),(0,a.jsxs)("label",{htmlFor:r,className:"flex flex-1 items-center gap-3 cursor-pointer",children:[(0,a.jsx)(s,{className:"w-4 h-4 ".concat(l)}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t})]})]})};return(0,a.jsxs)(F,{open:r,onClose:t,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{className:"w-5 h-5 text-indigo-600 flex-shrink-0"}),(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white uppercase tracking-tight",children:"Export Rapport"})]}),(0,a.jsx)("button",{onClick:t,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,a.jsx)(y.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[60vh] custom-scrollbar",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6 font-medium",children:["G\xe9n\xe9rez un document professionnel pour l'ouvrage ",(0,a.jsx)("span",{className:"text-indigo-600 font-bold",children:l.name}),"."]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(V,{id:"lastPhoto",label:"Photo de couverture",icon:j.A,color:"text-purple-500",checked:A.lastPhoto,onChange:e=>L(r=>({...r,lastPhoto:e}))}),(0,a.jsx)(V,{id:"description",label:"Description technique & Contexte",icon:v.A,color:"text-blue-500",checked:A.description,onChange:e=>L(r=>({...r,description:e}))}),(0,a.jsx)(V,{id:"progress",label:"Suivi d'avancement graphique",icon:w.A,color:"text-green-500",checked:A.progress,onChange:e=>L(r=>({...r,progress:e}))}),(0,a.jsx)(V,{id:"documents",label:"\uD83D\uDCE6 ZIP avec Annexes (Documents du projet)",icon:N.A,color:"text-orange-500",checked:A.documents,onChange:e=>L(r=>({...r,documents:e}))}),(0,a.jsxs)("div",{className:"pt-2",children:[(0,a.jsx)("div",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3 px-1",children:"Extensions Cartographiques"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(V,{id:"projectMap",label:"G\xe9o-localisation ponctuelle",icon:k.A,color:"text-indigo-400",checked:A.projectMap,onChange:e=>L(r=>({...r,projectMap:e}))}),(0,a.jsx)(V,{id:"globalMap",label:"Contexte r\xe9gional (Carte globale)",icon:k.A,color:"text-gray-400",checked:A.globalMap,onChange:e=>L(r=>({...r,globalMap:e}))})]})]})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row gap-3",children:[(0,a.jsx)("button",{onClick:t,disabled:c,className:"flex-1 px-4 py-2.5 rounded-xl border border-gray-200 dark:border-gray-700 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 transition-all font-bold",children:"Annuler"}),(0,a.jsx)("button",{onClick:O,disabled:c,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold shadow-lg shadow-indigo-600/20 transition-all active:scale-95 disabled:opacity-50",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.A,{className:"w-4 h-4 animate-spin"}),u||"G\xe9n\xe9ration..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.A,{className:"w-4 h-4"}),A.documents&&l.documents&&l.documents.length>0?"G\xe9n\xe9rer ZIP avec Annexes":"G\xe9n\xe9rer Rapport PDF"]})})]}),(0,a.jsx)("div",{ref:b,style:{position:"absolute",top:"-9999px",left:"-9999px",width:"1024px",height:"768px",overflow:"hidden",pointerEvents:"none"},children:"global"===h?(0,a.jsx)("div",{id:"pdf-global-map-capture",style:{width:"1024px",height:"768px"},children:(0,a.jsx)(M,{projects:d,isCapture:!0})}):"project"===h?(0,a.jsx)("div",{id:"pdf-project-map-capture",style:{width:"1024px",height:"768px"},children:(0,a.jsx)(z,{latitude:l.latitude,longitude:l.longitude,status:l.status,projectName:l.name,country:l.country,isCapture:!0})}):null})]})}var O=t(31259),V=t(6191),G=t(11010),B=t(71360),q=t(86651),W=t(21873),$=t(39068),_=t(14122),H=t(96548),K=t(6132),Q=t(61362),J=t(46046),X=t(61654),Z=t(15239);let Y=(0,l.createServerReference)("4005dfb6c61fe1117a659b8b8f1e2bbdcfa8a02a06",l.callServer,void 0,l.findSourceMapURL,"createProject"),ee=(0,l.createServerReference)("609660239ee32f4ba42137b792067d4d5bb7d4263c",l.callServer,void 0,l.findSourceMapURL,"deleteProject"),er=(0,l.createServerReference)("4015d10274367d9332f9694db1ebd12aa5416933e1",l.callServer,void 0,l.findSourceMapURL,"updateProject"),et=(0,g.default)(()=>Promise.all([t.e(4804),t.e(1761),t.e(8906)]).then(t.bind(t,38906)),{loadableGenerated:{webpack:()=>[38906]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"flex items-center justify-center h-[300px] bg-gray-100 dark:bg-gray-900 rounded-lg",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Chargement de la carte..."})]})})});function ea(e){let{latitude:r,longitude:t,onPositionChange:s,status:l,customPinUrl:i}=e;return(0,a.jsx)(et,{latitude:r,longitude:t,onPositionChange:s,status:l,customPinUrl:i})}var es=t(24054),el=t(46701);let ei={"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/webp":[".webp"],"image/gif":[".gif"],"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"video/mp4":[".mp4"],"video/webm":[".webm"],"application/zip":[".zip"],"application/x-rar-compressed":[".rar"]};function en(e){let{onFilesSelected:r,disabled:t}=e,l=(0,s.useCallback)(e=>{(null==e?void 0:e.length)>0&&r(e)},[r]),{getRootProps:i,getInputProps:n,isDragActive:o,isDragReject:d}=(0,es.VB)({onDrop:l,disabled:t,maxSize:0xa00000,accept:Object.keys(ei).reduce((e,r)=>(e[r]=ei[r],e),{})});return(0,a.jsxs)("div",{...i(),className:"\n        border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n        flex flex-col items-center justify-center gap-4 min-h-[200px]\n        ".concat(o?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50 hover:bg-accent/5","\n        ").concat(d?"border-destructive/50 bg-destructive/5":"","\n        ").concat(t?"opacity-50 cursor-not-allowed pointer-events-none":"","\n      "),children:[(0,a.jsx)("input",{...n()}),(0,a.jsx)("div",{className:"p-4 rounded-full bg-background border shadow-sm ".concat(o?"animate-bounce":""),children:o?(0,a.jsx)(el.A,{className:"h-8 w-8 text-primary"}):(0,a.jsx)(X.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:o?"D\xe9posez les fichiers ici":"Cliquez pour s\xe9lectionner ou glissez-d\xe9posez des fichiers ici"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Images (JPG, PNG, WebP), PDF, Documents (DOCX, XLSX) jusqu'\xe0 150Ko"})]})]})}var eo=t(92001);function ed(e){let{file:r,progress:t,status:s,error:l,onRemove:i}=e,n=r.type.startsWith("image/"),o=n?URL.createObjectURL(r):null;return(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 bg-card border rounded-lg group relative",children:[(0,a.jsx)("div",{className:"relative h-12 w-12 shrink-0 overflow-hidden rounded-md border flex items-center justify-center bg-muted",children:n&&o?(0,a.jsx)(Z.default,{src:o,alt:r.name,fill:!0,className:"object-cover",onLoad:()=>URL.revokeObjectURL(o)}):(0,a.jsx)(eo.A,{className:"h-6 w-6 text-muted-foreground"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium truncate pr-2",title:r.name,children:r.name}),"uploading"===s&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[t,"%"]})]}),(0,a.jsx)("div",{className:"h-1.5 w-full bg-secondary rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full transition-all duration-300 ".concat("error"===s?"bg-destructive":"success"===s?"bg-green-500":"bg-primary"),style:{width:"".concat(t,"%")}})}),l&&(0,a.jsx)("p",{className:"text-xs text-destructive mt-1 truncate",title:l,children:l})]}),(0,a.jsx)("div",{className:"shrink-0",children:"success"===s?(0,a.jsx)(Q.A,{className:"h-5 w-5 text-green-500"}):"error"===s?(0,a.jsx)(K.A,{className:"h-5 w-5 text-destructive"}):"uploading"===s?(0,a.jsx)(C.A,{className:"h-4 w-4 animate-spin text-primary"}):(0,a.jsxs)("button",{onClick:i,className:"p-1 hover:bg-destructive/10 hover:text-destructive rounded-full transition-colors",children:[(0,a.jsx)(y.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Remove file"})]})})]})}function ec(e){let{uploads:r,onRemove:t,onClearCompleted:s}=e;if(0===r.length)return null;let l=r.filter(e=>"success"===e.status||"error"===e.status).length,i=r.length,n=l===i&&i>0;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)(X.A,{className:"h-4 w-4"}),"Fichiers (",l,"/",i,")"]}),n&&(0,a.jsx)("button",{onClick:s,className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Tout effacer"})]}),(0,a.jsx)("div",{className:"space-y-2 max-h-[300px] overflow-y-auto pr-1",children:r.map((e,r)=>(0,a.jsx)(ed,{file:e.file,progress:e.progress,status:e.status,error:e.error,onRemove:()=>t(r)},"".concat(e.file.name,"-").concat(r)))}),n&&(0,a.jsxs)("div",{className:"p-3 bg-muted/50 rounded-lg flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(Q.A,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)("span",{children:"Tous les transferts sont termin\xe9s."})]})]})}var eg=t(97003),ex=t(60890),eu=t(1375);function em(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,t)).toFixed(r<0?0:r))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t])}function eh(e){return({DONE:"R\xe9alis\xe9",CURRENT:"En cours",PROSPECT:"Prospection"})[e]||e}function ep(e){let{files:r,selectedIds:t,onSelect:s,onRename:l,onPreview:i,onContextMenu:n}=e;return 0===r.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-muted-foreground",children:[(0,a.jsx)(eo.A,{className:"h-12 w-12 mb-4 opacity-20"}),(0,a.jsx)("p",{children:"Aucun fichier trouv\xe9"})]}):(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 p-4 pb-20",children:r.map(e=>{let r=t.has(e.id),o="IMAGE"===e.fileType,d="VIDEO"===e.fileType,c=function(e){let r=e.toLowerCase();return r.includes("/client/")||r.includes("/flag/")||r.includes("/pins/")||r.startsWith("client/")||r.startsWith("flag/")||r.startsWith("pins/")}(e.blobPath);return(0,a.jsxs)("div",{className:"\n                            group relative rounded-xl border bg-card cursor-pointer transition-all overflow-hidden\n                            hover:shadow-md hover:border-primary/50\n                            ".concat(r?"ring-2 ring-primary border-primary bg-primary/5":"border-border","\n                            ").concat(c?"h-24 sm:h-28 md:h-32":"aspect-square","\n                        "),onClick:r=>{r.stopPropagation(),s(e.id,r.ctrlKey||r.metaKey)},onDoubleClick:r=>{r.stopPropagation(),null==i||i(e)},onContextMenu:r=>{r.preventDefault(),null==n||n(r,e.id)},children:[(0,a.jsx)("div",{className:"flex items-center justify-center bg-muted/20 ".concat(c?"h-16 sm:h-20 md:h-24 w-full":"absolute inset-0"),children:o&&e.thumbnailUrl?(0,a.jsx)(Z.default,{src:e.thumbnailUrl,alt:e.name,fill:!c,width:c?80:void 0,height:c?60:void 0,className:"".concat(c?"object-contain max-h-full max-w-full w-auto h-auto":"object-cover"),sizes:c?"80px":"(max-width: 768px) 50vw, (max-width: 1200px) 33vw, 20vw"}):o&&e.blobUrl?(0,a.jsx)(Z.default,{src:e.blobUrl,alt:e.name,fill:!c,width:c?80:void 0,height:c?60:void 0,className:"".concat(c?"object-contain max-h-full max-w-full w-auto h-auto":"object-cover"),sizes:c?"80px":"200px"}):d&&e.thumbnailUrl?(0,a.jsxs)("div",{className:"relative ".concat("w-full h-full"),children:[(0,a.jsx)(Z.default,{src:e.thumbnailUrl,alt:e.name,fill:!c,width:c?80:void 0,height:c?60:void 0,className:"".concat(c?"object-contain max-h-full max-w-full w-auto h-auto":"object-cover"),sizes:c?"80px":"200px"}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:(0,a.jsx)("div",{className:"p-2 bg-black/50 rounded-full backdrop-blur-sm",children:(0,a.jsx)(ex.A,{className:"w-6 h-6 text-white"})})})]}):(0,a.jsx)(eb,{type:e.fileType,className:"text-muted-foreground/50 ".concat(c?"w-6 h-6":"w-12 h-12")})}),(0,a.jsx)("div",{className:"\n                                absolute z-10 transition-opacity cursor-pointer\n                                ".concat(c?"top-1 left-1":"top-2 left-2","\n                                ").concat(r?"opacity-100":"opacity-0 group-hover:opacity-100","\n                            "),onClick:r=>{r.stopPropagation(),s(e.id,!1,!0)},role:"checkbox","aria-checked":r,"aria-label":"".concat(r?"D\xe9s\xe9lectionner":"S\xe9lectionner"," le fichier ").concat(e.name),children:(0,a.jsx)("div",{className:"\n                                rounded-full border flex items-center justify-center\n                                ".concat(r?"bg-primary border-primary text-primary-foreground":"bg-white/80 border-gray-300 hover:border-primary","\n                                ").concat(c?"w-4 h-4":"w-5 h-5","\n                            "),children:r&&(0,a.jsx)(Q.A,{className:"".concat(c?"w-2.5 h-2.5":"w-3.5 h-3.5"),"aria-hidden":"true"})})}),(0,a.jsx)("div",{className:"\n                            absolute z-10 transition-opacity opacity-0 group-hover:opacity-100\n                            ".concat(c?"top-1 right-1":"top-2 right-2","\n                        "),children:(0,a.jsx)("button",{onClick:r=>{r.stopPropagation(),null==l||l(e)},className:"bg-white/80 rounded-full hover:bg-white text-gray-700 shadow-sm ".concat(c?"p-0.5":"p-1"),title:"Renommer","aria-label":"Renommer le fichier ".concat(e.name),children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:c?10:14,height:c?10:14,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})})}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent ".concat(c?"p-1 pt-3":"p-2 pt-6"),children:[(0,a.jsx)("p",{className:"font-medium text-white truncate ".concat(c?"text-[9px]":"text-xs"),title:e.name,children:e.name}),!c&&(0,a.jsx)("p",{className:"text-[10px] text-white/70",children:em(e.size)})]})]},e.id)})})}function eb(e){let{type:r,className:t}=e;switch(r){case"IMAGE":return(0,a.jsx)(j.A,{className:t});case"VIDEO":return(0,a.jsx)(ex.A,{className:t});case"DOCUMENT":return(0,a.jsx)(f.A,{className:t});case"ARCHIVE":return(0,a.jsx)(eu.A,{className:t});default:return(0,a.jsx)(eo.A,{className:t})}}function ef(e){let{searchQuery:r,onSearchChange:t,fileTypeFilter:s,onFilterChange:l,countryFilter:i,onCountryChange:n,projectFilter:o,onProjectChange:d,files:c=[],onFileSelect:g}=e,x=[...c].sort((e,r)=>e.name.localeCompare(r.name)),u=Array.from(new Set(c.filter(e=>{var r;return null==(r=e.project)?void 0:r.country}).map(e=>e.project.country))).sort(),m=new Map;c.forEach(e=>{e.project&&("Tous"!==i&&("Autre"===i?e.project.country:e.project.country!==i)||m.set(e.project.id,e.project.name))});let h=Array.from(m.entries()).sort((e,r)=>e[1].localeCompare(r[1])),p=c.some(e=>!e.project),b=c.some(e=>{var r;return!(null==(r=e.project)?void 0:r.country)});return(0,a.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-xs font-bold text-muted-foreground uppercase tracking-widest",children:"Filtres et Recherche"}),(""!==r||"ALL"!==s||"Tous"!==i||"ALL"!==o)&&(0,a.jsx)("button",{onClick:()=>{t(""),l("ALL"),n("Tous"),d("ALL")},className:"text-xs font-bold text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors uppercase tracking-wider",children:"R\xe9initialiser"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(q.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)("input",{type:"text",placeholder:"Rechercher des fichiers...",value:r,onChange:e=>t(e.target.value),className:"w-full pl-9 pr-4 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 h-10"})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("select",{onChange:e=>{let r=c.find(r=>r.id===e.target.value);r&&g&&g(r),e.target.value=""},className:"w-full px-4 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 appearance-none cursor-pointer text-ellipsis overflow-hidden whitespace-nowrap h-10",defaultValue:"",children:[(0,a.jsxs)("option",{value:"",disabled:!0,children:["\uD83D\uDCC1 Aller au fichier... (",x.length,")"]}),x.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:[(0,a.jsxs)("select",{value:o,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50",children:[(0,a.jsxs)("option",{value:"ALL",children:["Tous les projets (",h.length,")"]}),p&&(0,a.jsx)("option",{value:"ORPHANED",children:"Sans projet"}),h.map(e=>{let[r,t]=e,s="project-flags"===r||"project-clients"===r||"project-pins"===r||"Flag"===t||"Client"===t||"Pins"===t;return(0,a.jsx)("option",{value:r,children:s?"\uD83D\uDD34 ".concat(t):t},r)})]}),(0,a.jsxs)("select",{value:i,onChange:e=>n(e.target.value),className:"w-full px-4 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50",children:[(0,a.jsxs)("option",{value:"Tous",children:["Tous les pays (",u.length,")"]}),b&&(0,a.jsx)("option",{value:"Autre",children:"Autre (sans pays)"}),u.map(e=>(0,a.jsx)("option",{value:e,children:"Syst\xe8me"===e?"\uD83D\uDD34 ".concat(e):e},e))]}),(0,a.jsxs)("select",{value:s,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 sm:col-span-2 lg:col-span-1",children:[(0,a.jsx)("option",{value:"ALL",children:"Tous les types"}),(0,a.jsx)("option",{value:"IMAGE",children:"Images"}),(0,a.jsx)("option",{value:"VIDEO",children:"Vid\xe9os"}),(0,a.jsx)("option",{value:"DOCUMENT",children:"Documents"}),(0,a.jsx)("option",{value:"ARCHIVE",children:"Archives"})]})]})]})}var ey=t(93499),ej=t(90368),ev=t(27937);function ew(e){let{url:r,mimeType:t}=e;return(0,a.jsx)("div",{className:"relative w-full h-full flex items-center justify-center bg-black",children:(0,a.jsxs)("video",{controls:!0,preload:"metadata",className:"max-w-full max-h-[80vh] w-auto h-auto focus:outline-none",playsInline:!0,controlsList:"nodownload",children:[(0,a.jsx)("source",{src:r,type:t||"video/mp4"}),"Votre navigateur ne supporte pas la lecture de vid\xe9os."]},r)})}function eN(e){let{url:r,alt:t}=e,[l,i]=(0,s.useState)(!0);return(0,a.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center bg-black/90",children:[l&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:(0,a.jsx)(C.A,{className:"w-8 h-8 text-white animate-spin"})}),(0,a.jsx)("div",{className:"relative w-full h-full max-w-5xl max-h-[80vh]",children:(0,a.jsx)(Z.default,{src:r,alt:t,fill:!0,className:"object-contain transition-opacity duration-300 ".concat(l?"opacity-0":"opacity-100"),onLoad:()=>i(!1),sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 70vw"})})]})}let ek=(0,g.default)(()=>Promise.all([t.e(3309),t.e(2097),t.e(4119)]).then(t.bind(t,44119)).then(e=>e.PDFViewer),{loadableGenerated:{webpack:()=>[44119]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"text-white text-center",children:"Chargement du lecteur PDF..."})});function eC(e){let{file:r,files:t,onClose:l,onNavigate:i}=e,n=t.findIndex(e=>e.id===r.id),o=n>0,d=n<t.length-1&&-1!==n,c=(0,s.useCallback)(()=>{o&&i(t[n-1])},[n,t,o,i]),g=(0,s.useCallback)(()=>{d&&i(t[n+1])},[n,t,d,i]);return(0,s.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key&&c(),"ArrowRight"===e.key&&g(),"Escape"===e.key&&l()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,g,l]),(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] flex flex-col bg-black/95 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 text-white z-10 bg-black/50",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg truncate max-w-[80vw]",children:r.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:[n+1," sur ",t.length," • ",(r.size/1024).toFixed(1)," KB"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("a",{href:"/api/files/serve/".concat(r.blobPath,"?download=true&filename=").concat(encodeURIComponent(r.name)),download:r.name,className:"p-2 hover:bg-white/10 rounded-full transition-colors",title:"T\xe9l\xe9charger",children:(0,a.jsx)(S.A,{className:"w-6 h-6"})}),(0,a.jsx)("button",{onClick:l,className:"p-2 hover:bg-white/10 rounded-full transition-colors",title:"Fermer (Esc)",children:(0,a.jsx)(y.A,{className:"w-6 h-6"})})]})]}),(0,a.jsxs)("div",{className:"flex-1 relative overflow-hidden flex items-center justify-center p-4",children:[o&&(0,a.jsx)("button",{onClick:c,className:"absolute left-4 z-20 p-3 bg-black/50 hover:bg-black/80 text-white rounded-full transition-all group",children:(0,a.jsx)(ej.A,{className:"w-8 h-8 group-hover:scale-110 transition-transform"})}),d&&(0,a.jsx)("button",{onClick:g,className:"absolute right-4 z-20 p-3 bg-black/50 hover:bg-black/80 text-white rounded-full transition-all group",children:(0,a.jsx)(ev.A,{className:"w-8 h-8 group-hover:scale-110 transition-transform"})}),(0,a.jsx)("div",{className:"w-full h-full max-w-6xl mx-auto flex items-center justify-center",children:(()=>{switch(r.fileType){case"IMAGE":return(0,a.jsx)(eN,{url:r.blobUrl,alt:r.name});case"VIDEO":return(0,a.jsx)(ew,{url:r.blobUrl,mimeType:r.mimeType});case"DOCUMENT":if("application/pdf"===r.mimeType||r.name.toLowerCase().endsWith(".pdf"))return(0,a.jsx)(ek,{url:r.blobUrl});return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-white",children:[(0,a.jsx)("p",{children:"Aper\xe7u non disponible pour ce document."}),(0,a.jsxs)("a",{href:r.blobUrl,target:"_blank",rel:"noopener noreferrer",className:"mt-4 flex items-center gap-2 px-4 py-2 bg-white text-black rounded hover:bg-gray-200",children:[(0,a.jsx)(ey.A,{className:"w-4 h-4"}),"Ouvrir dans un nouvel onglet"]})]});default:return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-white",children:[(0,a.jsx)("p",{children:"Format de fichier non support\xe9 pour l'aper\xe7u."}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["(",r.mimeType,")"]})]})}})()})]})]})}var eS=t(48314),eA=t(57828),eE=t(18514),eP=t(26754);function eR(e){let{x:r,y:t,file:l,onClose:i,onPreview:n,onRename:o,onMove:d,onDelete:c,onRestore:g,showRestore:x}=e,u=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&i()},r=e=>{"Escape"===e.key&&i()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",r),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",r)}},[i]);let m={top:Math.min(t,window.innerHeight-200),left:Math.min(r,window.innerWidth-200)};return(0,a.jsxs)("div",{ref:u,style:m,className:"fixed z-[1600] w-56 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"px-2 py-1.5 border-b mb-1",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:l.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5",children:l.project?(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{children:"\uD83D\uDCC1"}),(0,a.jsx)("span",{children:l.project.name}),(0,a.jsxs)("span",{className:"text-gray-400",children:["(",l.project.country,")"]})]}):(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{children:"\uD83D\uDCC1"}),(0,a.jsx)("span",{children:"Global"})]})})]}),x?(0,a.jsxs)("button",{onClick:()=>{null==g||g(),i()},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground dark:hover:bg-gray-700",children:[(0,a.jsx)(eS.A,{className:"mr-2 h-4 w-4"}),"Restaurer"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>{n(),i()},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground dark:hover:bg-gray-700",children:[(0,a.jsx)(eA.A,{className:"mr-2 h-4 w-4"}),"Aper\xe7u"]}),(0,a.jsxs)("button",{onClick:()=>{o(),i()},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground dark:hover:bg-gray-700",children:[(0,a.jsx)(eE.A,{className:"mr-2 h-4 w-4"}),"Renommer"]}),(0,a.jsxs)("button",{onClick:()=>{d(),i()},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground dark:hover:bg-gray-700",children:[(0,a.jsx)(eP.A,{className:"mr-2 h-4 w-4"}),"D\xe9placer"]}),(0,a.jsxs)("a",{href:"/api/files/serve/".concat(l.blobPath,"?download=true&filename=").concat(encodeURIComponent(l.name)),download:l.name,onClick:i,className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground dark:hover:bg-gray-700 text-decoration-none text-inherit",children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"}),"T\xe9l\xe9charger"]})]}),(0,a.jsx)("div",{className:"h-px my-1 bg-muted dark:bg-gray-700"}),(0,a.jsxs)("button",{onClick:()=>{c(),i()},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400",children:[(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4"}),x?"Supprimer d\xe9finitivement":"Supprimer"]})]})}var eL=t(59847);function eD(e){let{fileIds:r,currentProjectId:t,onClose:l,onMove:i}=e,[n,o]=(0,s.useState)([]),[d,c]=(0,s.useState)(!0),[g,x]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),h=E("FileMoveDialog");(0,s.useEffect)(()=>{!async function(){try{let e=await fetch("/api/projects");if(e.ok){let r=await e.json();o(r)}}catch(e){h.error("Failed to fetch projects",e)}finally{c(!1)}}()},[h]);let p=async()=>{g&&(m(!0),await i(g),m(!1),l())};return(0,a.jsx)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:(0,a.jsxs)("div",{className:"bg-background p-6 rounded-lg shadow-xl w-full max-w-md border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"D\xe9placer les fichiers"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["S\xe9lectionnez le projet de destination pour ",r.length," fichier(s)."]}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto border rounded-md p-1 space-y-1 mb-4",children:d?(0,a.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,a.jsx)(C.A,{className:"w-5 h-5 animate-spin text-muted-foreground"})}):n.map(e=>(0,a.jsxs)("button",{onClick:()=>x(e.id),disabled:e.id===t,className:"\n                                    w-full flex items-center gap-2 px-3 py-2 text-sm rounded-sm transition-colors\n                                    ".concat(g===e.id?"bg-primary text-primary-foreground":"hover:bg-muted text-foreground","\n                                    ").concat(e.id===t?"opacity-50 cursor-not-allowed":"cursor-pointer","\n                                "),children:[(0,a.jsx)(eL.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"truncate",children:"project-flags"===e.id||"project-clients"===e.id||"project-pins"===e.id||"Syst\xe8me"===e.country?"\uD83D\uDD34 ".concat(e.name):e.name}),e.id===t&&(0,a.jsx)("span",{className:"ml-auto text-xs opacity-70",children:"(Actuel)"})]},e.id))}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:l,className:"px-4 py-2 text-sm text-muted-foreground hover:bg-muted rounded",disabled:u,children:"Annuler"}),(0,a.jsxs)("button",{onClick:p,disabled:!g||u,className:"px-4 py-2 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded font-medium flex items-center gap-2 disabled:opacity-50",children:[u&&(0,a.jsx)(C.A,{className:"w-3 h-3 animate-spin"}),"D\xe9placer"]})]})]})})}function eT(e){let{fileCount:r,isPermanent:t=!1,onClose:l,onConfirm:i}=e,[n,o]=(0,s.useState)(t||!0),[d,c]=(0,s.useState)(!1),g=async()=>{c(!0),await i(n),c(!1),l()};return(0,a.jsx)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:(0,a.jsxs)("div",{className:"bg-background p-6 rounded-lg shadow-xl w-full max-w-sm border border-red-100 dark:border-red-900/30",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4 text-red-600 dark:text-red-400",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 dark:bg-red-900/20 rounded-full",children:(0,a.jsx)(B.A,{className:"w-5 h-5"})}),(0,a.jsxs)("h3",{className:"text-lg font-semibold",children:["Supprimer ",r," fichier(s) ?"]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-6",children:n?"Cette action est irr\xe9versible. Les fichiers seront d\xe9finitivement effac\xe9s.":"Les fichiers seront d\xe9plac\xe9s vers la corbeille pendant 30 jours."}),!t&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-6 ml-1",children:[(0,a.jsx)("input",{type:"checkbox",id:"permanent-delete",checked:n,onChange:e=>o(e.target.checked),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),(0,a.jsx)("label",{htmlFor:"permanent-delete",className:"text-sm text-foreground cursor-pointer select-none",children:"Supprimer d\xe9finitivement"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:l,className:"px-4 py-2 text-sm text-muted-foreground hover:bg-muted rounded",disabled:d,children:"Annuler"}),(0,a.jsxs)("button",{onClick:g,disabled:d,className:"px-4 py-2 text-sm bg-red-600 text-white hover:bg-red-700 rounded font-medium flex items-center gap-2 disabled:opacity-50",children:[d&&(0,a.jsx)(C.A,{className:"w-3 h-3 animate-spin"}),"Supprimer"]})]})]})})}function eI(e){var r;let{isOpen:t,onClose:l,onSelect:i,initialProjectFilter:n}=e,[o,d]=(0,s.useState)([]),[c,g]=(0,s.useState)(!1),[x,u]=(0,s.useState)(""),[m,h]=(0,s.useState)("ALL"),[p,b]=(0,s.useState)("Tous"),[f,j]=(0,s.useState)(n||"ALL"),[v,w]=(0,s.useState)(null),N=E("DatabaseImagePicker"),[k,S]=(0,s.useState)(null),[A,P]=(0,s.useState)(""),[R,L]=(0,s.useState)(null),[D,T]=(0,s.useState)(null),[I,M]=(0,s.useState)(null),[z,F]=(0,s.useState)(null),U=(0,s.useCallback)(()=>{w(null),u(""),h("ALL"),b("Tous"),j(n||"ALL")},[n]),O=(0,s.useCallback)(async()=>{g(!0);try{let e=await fetch("/api/files/list?limit=500");if(e.ok){let r=await e.json();d(r.files||[])}}catch(e){N.error("Failed to fetch files",e)}finally{g(!1)}},[N]);(0,s.useEffect)(()=>{t&&(O(),U())},[t,U,O]),(0,s.useEffect)(()=>{if("ALL"!==f&&"ORPHANED"!==f){var e;let r=o.find(e=>{var r;return(null==(r=e.project)?void 0:r.id)===f});(null==r||null==(e=r.project)?void 0:e.country)&&b(r.project.country)}},[f,o]);let V=o.filter(e=>{var r,t,a;if("IMAGE"!==e.fileType||x&&!e.name.toLowerCase().includes(x.toLowerCase()))return!1;if("ALL"!==f){if("ORPHANED"===f){if(e.project)return!1}else if((null==(r=e.project)?void 0:r.id)!==f)return!1}return"Tous"!==p?"Autre"===p?!(null==(a=e.project)?void 0:a.country):(null==(t=e.project)?void 0:t.country)===p:"ALL"===m||e.fileType===m}),G=(0,s.useCallback)((e,r)=>{e.preventDefault();let t=o.find(e=>e.id===r);t&&T({x:e.clientX,y:e.clientY,file:t})},[o]),B=e=>{S(e),P(e.name)},W=async()=>{if(!k||!A||A===k.name)return void S(null);try{if(!(await fetch("/api/files/".concat(k.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:A})})).ok)throw Error("Rename failed");O()}catch(e){N.error("Rename error:",e),alert("Erreur lors du renommage")}finally{S(null)}},$=async e=>{if(I)try{await Promise.all(I.map(r=>fetch("/api/files/".concat(r),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})}))),O(),M(null)}catch(e){N.error("Move error:",e),alert("Erreur lors du d\xe9placement")}},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(z)try{if(!(await fetch("/api/files/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileIds:z,permanent:e})})).ok)throw Error("Delete failed");w(null),O(),F(null)}catch(e){N.error("Delete error:",e),alert("Erreur lors de la suppression")}};return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:l}),(0,a.jsxs)("div",{className:"relative bg-white dark:bg-gray-900 w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200 dark:border-gray-800 animate-in zoom-in-95 duration-300",children:[(0,a.jsxs)("div",{className:"p-5 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/40 rounded-lg",children:(0,a.jsx)(q.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white uppercase tracking-tight",children:"Biblioth\xe8que d'Images"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest leading-none mt-1",children:"S\xe9lectionnez une image pour traitement"})]})]}),(0,a.jsx)("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:(0,a.jsx)(y.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-5 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",children:(0,a.jsx)(ef,{searchQuery:x,onSearchChange:u,fileTypeFilter:m,onFilterChange:h,countryFilter:p,onCountryChange:b,projectFilter:f,onProjectChange:j,files:o,onFileSelect:e=>{u(e.name),w(e.id)}})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/30 dark:bg-gray-950/20 custom-scrollbar relative",children:[c?(0,a.jsxs)("div",{className:"flex flex-col justify-center items-center h-full gap-4",children:[(0,a.jsx)(C.A,{className:"h-10 w-10 animate-spin text-indigo-600"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500 animate-pulse",children:"Chargement de la biblioth\xe8que..."})]}):0===V.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-12 text-gray-400",children:[(0,a.jsx)(q.A,{className:"w-12 h-12 mb-4 opacity-20"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"Aucune image ne correspond aux crit\xe8res"}),(0,a.jsx)(eg.$,{variant:"link",onClick:U,className:"text-indigo-600 mt-2",children:"R\xe9initialiser les filtres"})]}):(0,a.jsx)(ep,{files:V,selectedIds:new Set(v?[v]:[]),onSelect:e=>{w(e)},onRename:B,onPreview:L,onContextMenu:G}),k&&(0,a.jsx)("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-2xl w-full max-w-sm border border-gray-200 dark:border-gray-800 animate-in zoom-in-95 duration-200",children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-4 dark:text-white",children:"Renommer l'image"}),(0,a.jsx)("input",{type:"text",value:A,onChange:e=>P(e.target.value),className:"w-full p-3 border rounded-xl mb-6 bg-gray-50 dark:bg-gray-800 dark:border-gray-700 focus:ring-2 focus:ring-indigo-500 outline-none text-sm transition-all",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&W(),"Escape"===e.key&&S(null)}}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)(eg.$,{onClick:()=>S(null),variant:"ghost",className:"text-xs font-bold uppercase tracking-widest",children:"Annuler"}),(0,a.jsx)(eg.$,{onClick:W,className:"bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold uppercase tracking-widest px-6",children:"Sauvegarder"})]})]})})]}),(0,a.jsxs)("div",{className:"p-5 border-t border-gray-200 dark:border-gray-800 flex justify-end gap-3 bg-gray-50/50 dark:bg-gray-900/50",children:[(0,a.jsx)(eg.$,{variant:"ghost",onClick:l,className:"font-bold uppercase tracking-widest text-xs",children:"Annuler"}),(0,a.jsx)("button",{onClick:()=>{if(v){let e=o.find(e=>e.id===v);e&&(i(e.blobUrl,e.name,e.id),l())}},disabled:!v,className:"px-8 py-3 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg\n                            ".concat(v?"bg-gray-900 dark:bg-white text-white dark:text-gray-900 hover:scale-105 active:scale-95 shadow-gray-200 dark:shadow-none":"bg-gray-200 dark:bg-gray-800 text-gray-400 cursor-not-allowed shadow-none","\n                        "),children:"Importer cette image"})]})]}),D&&(0,a.jsx)(eR,{x:D.x,y:D.y,file:D.file,onClose:()=>T(null),onPreview:()=>L(D.file),onRename:()=>B(D.file),onMove:()=>M([D.file.id]),onDelete:()=>F([D.file.id])}),R&&(0,a.jsx)(eC,{file:R,files:V,onClose:()=>L(null),onNavigate:L}),I&&(0,a.jsx)(eD,{fileIds:I,currentProjectId:(null==(r=o.find(e=>e.id===I[0]))?void 0:r.projectId)||null,onClose:()=>M(null),onMove:$}),z&&(0,a.jsx)(eT,{fileCount:z.length,onClose:()=>F(null),onConfirm:_})]}):null}var eM=t(78874);function ez(e){let{message:r,type:t,onClose:l,duration:i=5e3}=e,[n,o]=(0,s.useState)(100);(0,s.useEffect)(()=>{if(i>0){let e=setTimeout(()=>{l()},i),r=Date.now(),t=setInterval(()=>{let e=Math.max(0,100-(Date.now()-r)/i*100);o(e),0===e&&clearInterval(t)},16);return()=>{clearTimeout(e),clearInterval(t)}}},[i,l]);let d="success"===t;return(0,a.jsxs)("div",{className:"fixed top-20 sm:top-6 right-4 sm:right-6 z-[200] flex items-center gap-3 px-6 py-4 rounded-xl shadow-2xl backdrop-blur-sm border-2 animate-in slide-in-from-top-5 fade-in duration-300 ".concat(d?"bg-green-50/95 dark:bg-green-900/95 border-green-500 text-green-900 dark:text-green-50":"bg-red-50/95 dark:bg-red-900/95 border-red-500 text-red-900 dark:text-red-50"),children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:d?(0,a.jsx)(Q.A,{className:"w-6 h-6 text-green-600 dark:text-green-400"}):(0,a.jsx)(eM.A,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),(0,a.jsx)("p",{className:"font-medium text-sm",children:r}),(0,a.jsx)("button",{onClick:l,className:"flex-shrink-0 p-1 rounded-lg transition-colors ".concat(d?"hover:bg-green-200 dark:hover:bg-green-800":"hover:bg-red-200 dark:hover:bg-red-800"),children:(0,a.jsx)(y.A,{className:"w-4 h-4"})}),i>0&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 h-1 rounded-b-xl transition-all ease-linear ".concat(d?"bg-green-500":"bg-red-500"),style:{width:"".concat(n,"%")}})]})}function eF(e){var r,t,l,i,c,g,x,u,m,p;let{projects:b,isOpen:f,onClose:w,userRole:N,defaultTab:k}=e,C="ADMIN"===N,S=C||"USER"===N,[A,E]=(0,s.useState)(k||"modify");(0,s.useEffect)(()=>{f&&k&&(C||"create"!==k&&"delete"!==k?E(k):E("modify"))},[f,k,C]),(0,s.useEffect)(()=>{R(""),U(""),ef(""),ek("Tous"),"create"===A?(eS([{lat:44.916672,lng:2.45}]),eE(0)):(eS([]),eE(-1))},[A]);let[P,R]=(0,s.useState)(""),[L,D]=(0,s.useState)({latitude:0,longitude:0,description:"",prospection:0,studies:0,fabrication:0,transport:0,construction:0,flagName:"",clientLogoName:"",pinName:"",status:o.PROSPECT}),[M,z]=(0,s.useState)({name:"",country:"",type:n.PRS,status:o.PROSPECT,latitude:44.916672,longitude:2.45,description:"",projectCode:"",prospection:0,studies:0,fabrication:0,transport:0,construction:0,flagName:"",clientLogoName:"",pinName:""}),[F,U]=(0,s.useState)(""),[O,et]=(0,s.useState)("decimal"),[es,el]=(0,s.useState)(!1),[ei,eo]=(0,s.useState)(null),[ed,eg]=(0,s.useState)(null),[ex,eu]=(0,s.useState)([]),[em,ep]=(0,s.useState)(!1),[eb,ef]=(0,s.useState)(""),[ey,ej]=(0,s.useState)(!1),[ev,ew]=(0,s.useState)(-1),[eN,ek]=(0,s.useState)("Tous"),[eC,eS]=(0,s.useState)([]),[eA,eE]=(0,s.useState)(-1),[eP,eR]=(0,s.useState)(!1),[eL,eD]=(0,s.useState)(!1),[eT,eM]=(0,s.useState)(!1),eF=function(e,r){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];"create"===A?z(t=>({...t,latitude:e,longitude:r})):D(t=>({...t,latitude:e,longitude:r})),t&&(eS(t=>{let a=t.slice(0,eA+1);return a.push({lat:e,lng:r}),a.length>50&&a.shift(),a}),eE(e=>Math.min(e+1,49)))},eU=(0,s.useCallback)(()=>{if(eA>0){let e=eA-1;eE(e);let r=eC[e];r&&("create"===A?z(e=>({...e,latitude:r.lat,longitude:r.lng})):D(e=>({...e,latitude:r.lat,longitude:r.lng})))}},[eA,eC,A]),eO=(0,s.useCallback)(()=>{if(eA<eC.length-1){let e=eA+1;eE(e);let r=eC[e];r&&("create"===A?z(e=>({...e,latitude:r.lat,longitude:r.lng})):D(e=>({...e,latitude:r.lat,longitude:r.lng})))}},[eA,eC,A]);(0,s.useEffect)(()=>{if("modify"===A&&P){let t=b.find(e=>e.id===P);if(t){var e,r;eS([{lat:null!=(e=t.latitude)?e:0,lng:null!=(r=t.longitude)?r:0}]),eE(0)}}},[P,A,b]),(0,s.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&("z"!==e.key||e.shiftKey?("y"===e.key||"z"===e.key&&e.shiftKey)&&(e.preventDefault(),eO()):(e.preventDefault(),eU()))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[eU,eO]);let eV=(e,r)=>{try{var t,a;let s;if(s="dms"===O?I(e):parseFloat(e)||0,"latitude"===r&&!(s>=-90&&s<=90))return void eo({type:"error",message:"Latitude doit \xeatre entre -90 et +90"});if("longitude"===r&&!(s>=-180&&s<=180))return void eo({type:"error",message:"Longitude doit \xeatre entre -180 et +180"});eo(null);let l="latitude"===r?s:null!=(t=L.latitude)?t:0,i="longitude"===r?s:null!=(a=L.longitude)?a:0;D(e=>({...e,[r]:null!=s?s:0})),eS(e=>{let r=e.slice(0,eA+1);return r.push({lat:l,lng:i}),r.length>50&&r.shift(),r}),eE(e=>Math.min(e+1,49))}catch(e){eo({type:"error",message:"Format ".concat("dms"===O?"DMS":"d\xe9cimal"," invalide")})}},eG=Array.from(new Set((b||[]).map(e=>e.country).filter(Boolean))).sort(),eB=(b||[]).filter(e=>"Tous"===eN||e.country===eN),eq=eB.slice().sort((e,r)=>e.name.localeCompare(r.name)),eW=eB.filter(e=>e.name.toLowerCase().includes(eb.toLowerCase())).slice(0,5),e$=e=>{R(e.id),ef(""),ej(!1),ew(-1)};if((0,s.useEffect)(()=>{if(P){let l=b.find(e=>e.id===P);if(l){var e,r,t,a,s;let i=null==(e=l.documents)?void 0:e.find(e=>e.type===d.FLAG),n=null==(r=l.documents)?void 0:r.find(e=>e.type===d.CLIENT_LOGO||e.name.toLowerCase().includes("logo")),c=null==(t=l.documents)?void 0:t.find(e=>e.type===d.PIN);D({latitude:null!=(a=l.latitude)?a:0,longitude:null!=(s=l.longitude)?s:0,description:l.description||"",prospection:l.prospection||0,studies:l.studies||0,fabrication:l.fabrication||0,transport:l.transport||0,construction:l.construction||0,flagName:(null==i?void 0:i.url)||"",clientLogoName:(null==n?void 0:n.url)||"",pinName:(null==c?void 0:c.url)||"",status:l.status||o.PROSPECT}),eo(null)}}else D({latitude:0,longitude:0,description:"",prospection:0,studies:0,fabrication:0,transport:0,construction:0,flagName:"",clientLogoName:"",pinName:"",status:o.PROSPECT})},[P,b]),!f||!S)return null;let e_=async e=>{ep(!0);let r=ex.map(async r=>{if("success"===r.status)return;eH(r.file,{status:"uploading",progress:0});let t=new FormData;return t.append("file",r.file),t.append("projectId",e),new Promise(e=>{let a=new XMLHttpRequest;a.open("POST","/api/files/upload"),a.upload.onprogress=e=>{if(e.lengthComputable){let t=Math.round(e.loaded/e.total*100);eH(r.file,{progress:t})}},a.onload=()=>{a.status>=200&&a.status<300?eH(r.file,{status:"success",progress:100}):eH(r.file,{status:"error",error:"Upload failed"}),e()},a.onerror=()=>{eH(r.file,{status:"error",error:"Network error"}),e()},a.send(t)})});await Promise.all(r),ep(!1)},eH=(e,r)=>{eu(t=>t.map(t=>t.file===e?{...t,...r}:t))},eK=async e=>{e.preventDefault(),el(!0),eo(null);try{let e=await Y(M);e.success&&e.projectId?(ex.length>0&&await e_(e.projectId),eg({type:"success",message:"Projet cr\xe9\xe9 avec succ\xe8s !"}),z({name:"",country:"",type:n.PRS,status:o.PROSPECT,latitude:44.916672,longitude:2.45,description:"",projectCode:"",prospection:0,studies:0,fabrication:0,transport:0,construction:0,flagName:"",clientLogoName:"",pinName:""}),eu([]),setTimeout(()=>{E("modify"),R(e.projectId||"")},2e3)):eg({type:"error",message:e.error||"Une erreur est survenue lors de la cr\xe9ation."})}catch(e){eg({type:"error",message:"Erreur de communication avec le serveur."})}finally{el(!1)}},eQ=async()=>{if(P){el(!0),eo(null);try{let e=await ee(P,F);e.success?(eg({type:"success",message:"Projet supprim\xe9 d\xe9finitivement."}),R(""),U(""),setTimeout(()=>{E("modify")},1500)):eg({type:"error",message:e.error||"Une erreur est survenue lors de la suppression."})}catch(e){eg({type:"error",message:"Erreur de communication avec le serveur."})}finally{el(!1)}}},eJ=async e=>{if(e.preventDefault(),"create"===A)return eK(e);if(P){el(!0),eo(null);try{let e=await er({id:P,latitude:L.latitude,longitude:L.longitude,description:L.description,prospection:L.prospection,studies:L.studies,fabrication:L.fabrication,transport:L.transport,construction:L.construction,flagName:L.flagName,clientLogoName:L.clientLogoName,pinName:L.pinName,status:L.status});e.success?eg({type:"success",message:"Projet mis \xe0 jour avec succ\xe8s !"}):eg({type:"error",message:e.error||"Une erreur est survenue lors de la mise \xe0 jour."})}catch(e){eg({type:"error",message:"Erreur de communication avec le serveur."})}finally{el(!1)}}};return(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] flex items-start sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-5xl max-h-[calc(90vh-4rem)] sm:max-h-[90vh] overflow-hidden border border-gray-100 dark:border-gray-700 transition-all animate-in fade-in zoom-in duration-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-col border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 select-none",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/40 rounded-lg",children:"create"===A?(0,a.jsx)(V.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}):"modify"===A?(0,a.jsx)(G.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}):(0,a.jsx)(B.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsx)("h2",{className:"text-lg lg:text-xl font-bold text-gray-900 dark:text-white uppercase tracking-tight",children:"create"===A?"Cr\xe9ation de projet":"modify"===A?"Modification de projets":"Suppression de projet"})]}),(0,a.jsx)("button",{onClick:w,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:(0,a.jsx)(y.A,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"flex px-4 sm:px-5 gap-4 sm:gap-6 overflow-x-auto min-w-0 border-b border-gray-100 dark:border-gray-700 scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700",children:[C&&(0,a.jsx)("button",{onClick:()=>E("create"),className:"pb-3 text-sm font-bold uppercase tracking-wider transition-all border-b-2 whitespace-nowrap shrink-0 ".concat("create"===A?"text-indigo-600 dark:text-indigo-400 border-indigo-600 dark:border-indigo-400":"text-gray-400 border-transparent hover:text-gray-600 dark:hover:text-gray-200"),children:"Cr\xe9er"}),(0,a.jsx)("button",{onClick:()=>E("modify"),className:"pb-3 text-sm font-bold uppercase tracking-wider transition-all border-b-2 whitespace-nowrap shrink-0 ".concat("modify"===A?"text-indigo-600 dark:text-indigo-400 border-indigo-600 dark:border-indigo-400":"text-gray-400 border-transparent hover:text-gray-600 dark:hover:text-gray-200"),children:"Modifier"}),C&&(0,a.jsx)("button",{onClick:()=>E("delete"),className:"pb-3 text-sm font-bold uppercase tracking-wider transition-all border-b-2 whitespace-nowrap shrink-0 ".concat("delete"===A?"text-indigo-600 dark:text-indigo-400 border-indigo-600 dark:border-indigo-400":"text-gray-400 border-transparent hover:text-gray-600 dark:hover:text-gray-200"),children:"Supprimer"}),(0,a.jsx)("div",{className:"w-8 shrink-0","aria-hidden":"true"})]})]}),(0,a.jsxs)("div",{className:"overflow-y-auto max-h-[calc(90vh-160px)] flex-1",children:["modify"===A&&(0,a.jsxs)("form",{onSubmit:eJ,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 md:flex-[0.25]",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Filtrer par pays"}),(0,a.jsxs)("select",{value:eN,onChange:e=>{ek(e.target.value),R("")},className:"w-full px-4 py-2.5 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all dark:text-white",children:[(0,a.jsx)("option",{value:"Tous",children:"Tous les pays"}),eG.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex-1 md:flex-[0.35]",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Choisir un projet"}),(0,a.jsxs)("select",{value:P,onChange:e=>{R(e.target.value)},className:"w-full px-4 py-2.5 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all dark:text-white",required:!0,children:[(0,a.jsx)("option",{value:"",children:0===eq.length?"Aucun projet":"-- S\xe9lectionner --"}),eq.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.country,")"]},e.id))]})]}),(0,a.jsxs)("div",{className:"flex-1 md:flex-[0.4] relative",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Recherche rapide"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:eb,onChange:e=>{ef(e.target.value),ej(!0),ew(-1)},onFocus:()=>ej(!0),onKeyDown:e=>{ey&&0!==eW.length&&("ArrowDown"===e.key?(e.preventDefault(),ew(e=>(e+1)%eW.length)):"ArrowUp"===e.key?(e.preventDefault(),ew(e=>(e-1+eW.length)%eW.length)):"Enter"===e.key?(e.preventDefault(),ev>=0&&e$(eW[ev])):"Escape"===e.key&&ej(!1))},onBlur:()=>setTimeout(()=>ej(!1),200),placeholder:"Tapez le nom d'un ouvrage...",className:"w-full pl-10 pr-4 py-2.5 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all dark:text-white"}),(0,a.jsx)(q.A,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),ey&&eW.length>0&&(0,a.jsx)("div",{className:"absolute z-[110] w-full mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl max-h-48 overflow-auto animate-in fade-in slide-in-from-top-2 duration-200",children:eW.map((e,r)=>(0,a.jsx)("button",{type:"button",onMouseMove:()=>ew(r),onClick:()=>e$(e),className:"w-full text-left px-4 py-2 text-sm transition-colors border-b border-gray-50 dark:border-gray-700/50 last:border-0 ".concat(ev===r?"bg-indigo-50 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300":"hover:bg-indigo-50 dark:hover:bg-indigo-900/30"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.name}),(0,a.jsx)("span",{className:"text-xs opacity-60 italic",children:e.country})]})},e.id))})]})]})]}),P&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"w-4 h-4 text-indigo-500"})," Position sur la Carte"]}),(0,a.jsx)("div",{className:"rounded-xl overflow-hidden border border-gray-200 dark:border-gray-600 shadow-sm",children:(0,a.jsx)(ea,{latitude:L.latitude,longitude:L.longitude,onPositionChange:eF,status:L.status,customPinUrl:L.pinName})}),(0,a.jsx)("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 italic",children:"\uD83D\uDCA1 D\xe9placez le marqueur sur la carte pour ajuster les coordonn\xe9es"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{children:(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"w-4 h-4 text-gray-400"})," Latitude"]})})}),(0,a.jsx)("div",{children:(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"w-4 h-4 text-gray-400"})," Longitude"]})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_1fr_auto] gap-3 items-center",children:[(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",value:"decimal"===O?null!=(l=L.latitude)?l:0:T(null!=(i=L.latitude)?i:0,!0),onChange:e=>eV(e.target.value,"latitude"),disabled:!P,className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 transition-all dark:text-white font-mono text-sm",placeholder:"decimal"===O?"8.4657":"8\xb0 27' 56\" N",required:!0})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",value:"decimal"===O?null!=(c=L.longitude)?c:0:T(null!=(g=L.longitude)?g:0,!1),onChange:e=>eV(e.target.value,"longitude"),disabled:!P,className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 transition-all dark:text-white font-mono text-sm",placeholder:"decimal"===O?"-13.2317":"13\xb0 13' 54\" W",required:!0})}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 border border-gray-200 dark:border-gray-600 rounded-lg p-1 bg-white dark:bg-gray-800 shadow-sm",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>et(e=>"decimal"===e?"dms":"decimal"),className:"p-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-all flex items-center gap-1.5",title:"decimal"===O?"Passer en DMS":"Passer en D\xe9cimal",children:["decimal"===O?(0,a.jsx)(W.A,{className:"w-4 h-4"}):(0,a.jsx)($.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-[10px] font-bold uppercase",children:"decimal"===O?"DMS":"DEC"})]}),(0,a.jsx)("div",{className:"w-px h-6 bg-gray-200 dark:bg-gray-700 mx-1"}),(0,a.jsx)("button",{type:"button",onClick:eU,disabled:eA<=0||!P,className:"p-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center gap-1",title:"Annuler (Ctrl+Z)",children:(0,a.jsx)(_.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{type:"button",onClick:eO,disabled:eA>=eC.length-1||!P,className:"p-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center gap-1",title:"R\xe9tablir (Ctrl+Y)",children:(0,a.jsx)(H.A,{className:"w-4 h-4"})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 -mt-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"decimal"===O?"Ex: 8.4657":"Ex: 8\xb0 27' 56\" N"})}),(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"decimal"===O?"Ex: -13.2317":"Ex: 13\xb0 13' 54\" W"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"w-4 h-4 text-gray-400"})," Description"]}),(0,a.jsx)("textarea",{value:L.description,onChange:e=>D({...L,description:e.target.value}),disabled:!P,rows:6,className:"w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 transition-all dark:text-white resize-none",placeholder:"Saisissez la description du projet..."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2",children:[(0,a.jsx)(K.A,{className:"w-4 h-4 text-purple-500"})," Avancement du Projet"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Prospection",key:"prospection"},{label:"\xc9tudes",key:"studies"},{label:"Fabrication",key:"fabrication"},{label:"Transport",key:"transport"},{label:"Montage",key:"construction"}].map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-[10px] font-bold text-gray-500 uppercase mb-1",children:e.label}),(0,a.jsx)("input",{type:"number",min:"0",max:"100",value:0===L[e.key]?"":L[e.key],onChange:r=>{let t=r.target.value;if(""===t||"0"===t)D({...L,[e.key]:0});else{let r=parseInt(t.replace(/^0+/,"")||"0",10);isNaN(r)||D({...L,[e.key]:Math.min(100,Math.max(0,r))})}},disabled:!P,className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white text-sm"})]},e.key))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Statut du Projet"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[(0,a.jsx)("div",{className:"flex-1 w-full",children:(0,a.jsx)("select",{value:L.status,onChange:e=>D({...L,status:e.target.value}),disabled:!P,className:"w-full px-4 py-2.5 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white",children:Object.values(o).map(e=>(0,a.jsx)("option",{value:e,children:eh(e)},e))})}),P&&(0,a.jsxs)("div",{className:"flex items-center gap-3 px-4 py-2 bg-gray-50 dark:bg-gray-900/50 rounded-xl border border-gray-100 dark:border-gray-700 shrink-0",children:[(0,a.jsx)("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:"Pin Actuel :"}),(0,a.jsx)("div",{className:"relative w-8 h-8 rounded-lg overflow-hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 flex items-center justify-center p-1 shadow-sm",children:(0,a.jsx)(Z.default,{src:L.pinName&&(L.pinName.startsWith("http")||L.pinName.startsWith("/"))?L.pinName:"DONE"===L.status?"https://pub-78c42489fd854dc3a6975810aa00edf2.r2.dev/pins/realise.png":"CURRENT"===L.status?"https://pub-78c42489fd854dc3a6975810aa00edf2.r2.dev/pins/en_cours.png":"https://pub-78c42489fd854dc3a6975810aa00edf2.r2.dev/pins/prospection.png",alt:"Pin",width:24,height:24,className:"object-contain"})})]})]}),(0,a.jsx)("p",{className:"mt-2 text-xs text-gray-500 italic",children:"Le pin sur la carte sera automatiquement mis \xe0 jour selon le statut choisi (sauf si un pin personnalis\xe9 est s\xe9lectionn\xe9)."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"w-4 h-4"})," Identit\xe9 Visuelle"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Drapeau du Pays"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative group w-24 h-16 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 flex items-center justify-center shrink-0 shadow-sm",children:[L.flagName?(0,a.jsx)(Z.default,{src:L.flagName.startsWith("http")||L.flagName.startsWith("/")?L.flagName:"/".concat(L.flagName),alt:"Drapeau",fill:!0,className:"object-cover"}):(0,a.jsx)(j.A,{className:"w-6 h-6 text-gray-300"}),(0,a.jsx)("button",{type:"button",onClick:()=>eR(!0),className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-[10px] font-bold uppercase tracking-widest",children:"Choisir"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>eR(!0),className:"w-full px-4 py-2 text-left bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-indigo-400 transition-all text-xs text-gray-500 dark:text-gray-400 truncate",children:L.flagName?L.flagName.split("/").pop():"S\xe9lectionner une image..."}),L.flagName&&(0,a.jsx)("button",{type:"button",onClick:()=>D({...L,flagName:""}),className:"text-[10px] text-red-500 font-bold uppercase mt-1 ml-1 hover:underline",children:"Supprimer"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Logo Client"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative group w-24 h-16 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 flex items-center justify-center shrink-0 shadow-sm",children:[L.clientLogoName?(0,a.jsx)(Z.default,{src:L.clientLogoName.startsWith("http")||L.clientLogoName.startsWith("/")?L.clientLogoName:"/".concat(L.clientLogoName),alt:"Logo",fill:!0,className:"object-contain p-2"}):(0,a.jsx)(j.A,{className:"w-6 h-6 text-gray-300"}),(0,a.jsx)("button",{type:"button",onClick:()=>eD(!0),className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-[10px] font-bold uppercase tracking-widest",children:"Choisir"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>eD(!0),className:"w-full px-4 py-2 text-left bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-indigo-400 transition-all text-xs text-gray-500 dark:text-gray-400 truncate",children:L.clientLogoName?L.clientLogoName.split("/").pop():"S\xe9lectionner une image..."}),L.clientLogoName&&(0,a.jsx)("button",{type:"button",onClick:()=>D({...L,clientLogoName:""}),className:"text-[10px] text-red-500 font-bold uppercase mt-1 ml-1 hover:underline",children:"Supprimer"})]})]})]})]})]}),ei&&(0,a.jsxs)("div",{className:"p-4 rounded-xl flex items-center gap-3 animate-in fade-in slide-in-from-top-2 ".concat("success"===ei.type?"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-100 dark:border-green-800":"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-400 border border-red-100 dark:border-red-800"),children:["success"===ei.type?(0,a.jsx)(Q.A,{className:"w-5 h-5 flex-shrink-0"}):(0,a.jsx)(K.A,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:ei.message})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:w,className:"px-6 py-2.5 text-sm font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all",children:"Annuler"}),(0,a.jsx)("button",{type:"submit",disabled:es||!P,className:"flex items-center gap-2 px-8 py-2.5 text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl shadow-lg shadow-indigo-200 dark:shadow-none transition-all active:scale-95",children:es?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Mise \xe0 jour..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J.A,{className:"w-4 h-4"}),"Enregistrer les modifications"]})})]})]}),"create"===A&&(0,a.jsxs)("form",{onSubmit:eK,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-400 rounded-xl border border-indigo-100 dark:border-indigo-800 flex items-center gap-3",children:[(0,a.jsx)(Q.A,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm font-medium italic",children:"Pr\xeat \xe0 cr\xe9er un nouvel ouvrage. Remplissez les champs ci-dessous."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Nom du projet *"}),(0,a.jsx)("input",{type:"text",value:M.name,onChange:e=>z({...M,name:e.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white",placeholder:"Nom de l'ouvrage",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Pays *"}),(0,a.jsx)("input",{type:"text",value:M.country,onChange:e=>z({...M,country:e.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white",placeholder:"ex: Sierra Leone",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Type de projet *"}),(0,a.jsx)("select",{value:M.type,onChange:e=>z({...M,type:e.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white",required:!0,children:Object.values(n).map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Statut *"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("select",{value:M.status,onChange:e=>z({...M,status:e.target.value}),className:"flex-1 px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white",required:!0,children:Object.values(o).map(e=>(0,a.jsx)("option",{value:e,children:eh(e)},e))}),(0,a.jsx)("div",{className:"relative w-10 h-10 rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-900/50 border border-gray-100 dark:border-gray-700 flex items-center justify-center p-1.5 shrink-0",children:(0,a.jsx)(Z.default,{src:M.pinName&&(M.pinName.startsWith("http")||M.pinName.startsWith("/"))?M.pinName:"DONE"===M.status?"https://pub-78c42489fd854dc3a6975810aa00edf2.r2.dev/pins/realise.png":"CURRENT"===M.status?"https://pub-78c42489fd854dc3a6975810aa00edf2.r2.dev/pins/en_cours.png":"https://pub-78c42489fd854dc3a6975810aa00edf2.r2.dev/pins/prospection.png",alt:"Pin",width:28,height:28,className:"object-contain"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Code Projet"}),(0,a.jsx)("input",{type:"text",value:M.projectCode,onChange:e=>z({...M,projectCode:e.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white",placeholder:"ex: SLE-2024-001"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"w-4 h-4 text-indigo-500"})," Position G\xe9o-r\xe9f\xe9renc\xe9e"]}),(0,a.jsx)("div",{className:"rounded-xl overflow-hidden border border-gray-200 dark:border-gray-600 shadow-sm h-[300px]",children:(0,a.jsx)(ea,{latitude:M.latitude,longitude:M.longitude,onPositionChange:eF,status:M.status,customPinUrl:M.pinName})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"w-4 h-4 text-gray-400"})," Latitude"]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"w-4 h-4 text-gray-400"})," Longitude"]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_1fr_auto] gap-3 items-center",children:[(0,a.jsx)("input",{type:"text",value:"decimal"===O?null!=(x=M.latitude)?x:0:T(null!=(u=M.latitude)?u:0,!0),onChange:e=>{try{let r="dms"===O?I(e.target.value):parseFloat(e.target.value)||0;z(e=>({...e,latitude:r})),eS(e=>{var t;return[...e.slice(0,eA+1),{lat:r,lng:null!=(t=M.longitude)?t:0}].slice(-50)}),eE(e=>Math.min(e+1,49)),eo(null)}catch(e){eo({type:"error",message:"Format ".concat("dms"===O?"DMS":"d\xe9cimal"," invalide")})}},className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white font-mono text-sm",placeholder:"Latitude",required:!0}),(0,a.jsx)("input",{type:"text",value:"decimal"===O?null!=(m=M.longitude)?m:0:T(null!=(p=M.longitude)?p:0,!1),onChange:e=>{try{let r="dms"===O?I(e.target.value):parseFloat(e.target.value)||0;z(e=>({...e,longitude:r})),eS(e=>{var t;return[...e.slice(0,eA+1),{lat:null!=(t=M.latitude)?t:0,lng:r}].slice(-50)}),eE(e=>Math.min(e+1,49)),eo(null)}catch(e){eo({type:"error",message:"Format ".concat("dms"===O?"DMS":"d\xe9cimal"," invalide")})}},className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white font-mono text-sm",placeholder:"Longitude",required:!0}),(0,a.jsxs)("div",{className:"flex items-center gap-1 border border-gray-200 dark:border-gray-600 rounded-lg p-1 bg-white dark:bg-gray-800 shadow-sm",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>et(e=>"decimal"===e?"dms":"decimal"),className:"p-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-all flex items-center gap-1.5",title:"decimal"===O?"Passer en DMS":"Passer en D\xe9cimal",children:["decimal"===O?(0,a.jsx)(W.A,{className:"w-4 h-4"}):(0,a.jsx)($.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-[10px] font-bold uppercase",children:"decimal"===O?"DMS":"DEC"})]}),(0,a.jsx)("div",{className:"w-px h-6 bg-gray-200 dark:bg-gray-700 mx-1"}),(0,a.jsx)("button",{type:"button",onClick:eU,disabled:eA<=0,className:"p-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 disabled:opacity-40 transition-all",children:(0,a.jsx)(_.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{type:"button",onClick:eO,disabled:eA>=eC.length-1,className:"p-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 disabled:opacity-40 transition-all",children:(0,a.jsx)(H.A,{className:"w-4 h-4"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 -mt-1 md:-mt-2 px-1",children:[(0,a.jsx)("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 italic",children:"decimal"===O?"Ex: 8.4657":"Ex: 8\xb0 27' 56\" N"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 italic",children:"decimal"===O?"Ex: -13.2317":"Ex: 13\xb0 13' 54\" W"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"w-4 h-4 text-gray-400"})," Description du projet"]}),(0,a.jsx)("textarea",{value:M.description,onChange:e=>z({...M,description:e.target.value}),rows:4,className:"w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white resize-none",placeholder:"D\xe9tails de l'ouvrage..."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Avancement initial du Projet"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Prospection",key:"prospection"},{label:"\xc9tudes",key:"studies"},{label:"Fabrication",key:"fabrication"},{label:"Transport",key:"transport"},{label:"Montage",key:"construction"}].map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-[10px] font-bold text-gray-500 uppercase mb-1",children:e.label}),(0,a.jsx)("input",{type:"number",min:"0",max:"100",value:0===M[e.key]?"":M[e.key],onChange:r=>{let t=r.target.value;if(""===t||"0"===t)z({...M,[e.key]:0});else{let r=parseInt(t.replace(/^0+/,"")||"0",10);isNaN(r)||z({...M,[e.key]:Math.min(100,Math.max(0,r))})}},className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 transition-all dark:text-white text-sm"})]},e.key))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"w-4 h-4"})," Identite Visuelle"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Drapeau du Pays"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative group w-24 h-16 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 flex items-center justify-center shrink-0 shadow-sm",children:[M.flagName?(0,a.jsx)(Z.default,{src:M.flagName.startsWith("http")||M.flagName.startsWith("/")?M.flagName:"/".concat(M.flagName),alt:"Drapeau",fill:!0,className:"object-cover"}):(0,a.jsx)(j.A,{className:"w-6 h-6 text-gray-300"}),(0,a.jsx)("button",{type:"button",onClick:()=>eR(!0),className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-[10px] font-bold uppercase tracking-widest",children:"Choisir"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>eR(!0),className:"w-full px-4 py-2 text-left bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-indigo-400 transition-all text-xs text-gray-500 dark:text-gray-400 truncate",children:M.flagName?M.flagName.split("/").pop():"Selectionner une image..."}),M.flagName&&(0,a.jsx)("button",{type:"button",onClick:()=>z({...M,flagName:""}),className:"text-[10px] text-red-500 font-bold uppercase mt-1 ml-1 hover:underline",children:"Supprimer"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Logo Client"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative group w-24 h-16 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 flex items-center justify-center shrink-0 shadow-sm",children:[M.clientLogoName?(0,a.jsx)(Z.default,{src:M.clientLogoName.startsWith("http")||M.clientLogoName.startsWith("/")?M.clientLogoName:"/".concat(M.clientLogoName),alt:"Logo",fill:!0,className:"object-contain p-2"}):(0,a.jsx)(j.A,{className:"w-6 h-6 text-gray-300"}),(0,a.jsx)("button",{type:"button",onClick:()=>eD(!0),className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-[10px] font-bold uppercase tracking-widest",children:"Choisir"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("button",{type:"button",onClick:()=>eD(!0),className:"w-full px-4 py-2 text-left bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl hover:border-indigo-400 transition-all text-xs text-gray-500 dark:text-gray-400 truncate",children:M.clientLogoName?M.clientLogoName.split("/").pop():"Selectionner une image..."}),M.clientLogoName&&(0,a.jsx)("button",{type:"button",onClick:()=>z({...M,clientLogoName:""}),className:"text-[10px] text-red-500 font-bold uppercase mt-1 ml-1 hover:underline",children:"Supprimer"})]})]})]})]})]}),"\\r\\n",(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2",children:[(0,a.jsx)(X.A,{className:"w-4 h-4 text-blue-500"})," Documents et Photos (Optionnel)"]}),(0,a.jsx)(en,{onFilesSelected:e=>{let r=e.map(e=>({file:e,progress:0,status:"pending"}));eu(e=>[...e,...r])},disabled:es||em}),(0,a.jsx)(ec,{uploads:ex,onRemove:e=>eu(r=>r.filter((r,t)=>t!==e)),onClearCompleted:()=>eu([])})]}),ei&&(0,a.jsxs)("div",{className:"p-4 rounded-xl flex items-center gap-3 animate-in fade-in slide-in-from-top-2 ".concat("success"===ei.type?"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-400 border border-green-100 dark:border-green-800":"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-400 border border-red-100 dark:border-red-800"),children:["success"===ei.type?(0,a.jsx)(Q.A,{className:"w-5 h-5 flex-shrink-0"}):(0,a.jsx)(K.A,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:ei.message})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>E("modify"),className:"px-6 py-2.5 text-sm font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all",children:"Annuler"}),(0,a.jsxs)("button",{type:"submit",className:"flex items-center gap-2 px-8 py-2.5 text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 rounded-xl shadow-lg shadow-indigo-200 dark:shadow-none transition-all active:scale-95",children:[(0,a.jsx)(V.A,{className:"w-4 h-4"}),"Cr\xe9er le projet"]})]})]}),"delete"===A&&(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded-xl border border-red-100 dark:border-red-800 flex items-center gap-3",children:[(0,a.jsx)(K.A,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:"Zone de danger : Suppression de projet"}),(0,a.jsx)("span",{className:"text-xs",children:"Cette action est irr\xe9versible. Toutes les donn\xe9es et fichiers associ\xe9s seront d\xe9finitivement supprim\xe9s."})]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 md:flex-[0.3]",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Filtrer par pays"}),(0,a.jsxs)("select",{value:eN,onChange:e=>{ek(e.target.value),R("")},className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-red-500 transition-all dark:text-white",children:[(0,a.jsx)("option",{value:"Tous",children:"Tous les pays"}),eG.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"flex-1 md:flex-[0.35]",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Choisir le projet"}),(0,a.jsxs)("select",{value:P,onChange:e=>R(e.target.value),className:"w-full px-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-red-500 transition-all dark:text-white",children:[(0,a.jsx)("option",{value:"",children:0===eq.length?"Aucun projet":"-- S\xe9lectionner --"}),eq.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.country,")"]},e.id))]})]}),(0,a.jsxs)("div",{className:"flex-1 md:flex-[0.35] relative",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Recherche rapide"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:eb,onChange:e=>{ef(e.target.value),ej(!0)},onFocus:()=>ej(!0),onBlur:()=>setTimeout(()=>ej(!1),200),placeholder:"Tapez le nom...",className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-red-500 transition-all dark:text-white"}),(0,a.jsx)(q.A,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),ey&&eW.length>0&&(0,a.jsx)("div",{className:"absolute z-[110] w-full mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl max-h-48 overflow-auto animate-in fade-in slide-in-from-top-2 duration-200",children:eW.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>e$(e),className:"w-full text-left px-4 py-2 text-sm hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.name}),(0,a.jsxs)("span",{className:"ml-2 text-xs opacity-60",children:["(",e.country,")"]})]},e.id))})]})]})]}),P&&(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-6 rounded-2xl border border-gray-200 dark:border-gray-700 animate-in fade-in zoom-in duration-300",children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-gray-400 uppercase tracking-widest mb-4",children:"R\xe9capitulatif du projet"}),(()=>{let e=b.find(e=>e.id===P);return e?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase font-bold",children:"Nom de l'ouvrage"}),(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:e.name})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase font-bold",children:"Pays"}),(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:e.country})]}),(0,a.jsxs)("div",{className:"space-y-1 text-red-600 dark:text-red-400",children:[(0,a.jsx)("p",{className:"text-xs uppercase font-bold opacity-70",children:"Attention"}),(0,a.jsx)("p",{className:"text-sm font-medium italic",children:"Tous les documents et photos seront supprim\xe9s."})]})]}):null})(),(0,a.jsxs)("div",{className:"mt-8 pt-8 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:["Veuillez taper ",(0,a.jsxs)("span",{className:"text-red-600 dark:text-red-400 font-mono",children:['"',null==(r=b.find(e=>e.id===P))?void 0:r.name,'"']})," pour confirmer la suppression :"]}),(0,a.jsx)("input",{type:"text",value:F,onChange:e=>U(e.target.value),placeholder:"Nom du projet...",className:"w-full px-4 py-3 bg-white dark:bg-gray-800 border-2 border-red-200 dark:border-red-900/30 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all dark:text-white font-medium"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 mt-8",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{R(""),U("")},className:"px-6 py-2.5 text-sm font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all",children:"Annuler"}),(0,a.jsx)("button",{type:"button",disabled:es||F!==(null==(t=b.find(e=>e.id===P))?void 0:t.name),onClick:eQ,className:"flex items-center gap-2 px-8 py-2.5 text-sm font-bold text-white bg-red-600 hover:bg-red-700 disabled:opacity-30 disabled:cursor-not-allowed rounded-xl shadow-lg shadow-red-200 dark:shadow-none transition-all active:scale-95",children:es?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Suppression..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(B.A,{className:"w-4 h-4"}),"Supprimer d\xe9finitivement"]})})]})]})]}),(0,a.jsx)(eI,{isOpen:eP,onClose:()=>eR(!1),initialProjectFilter:"project-flags",onSelect:e=>{"create"===A?z({...M,flagName:e}):D({...L,flagName:e}),eR(!1)}}),(0,a.jsx)(eI,{isOpen:eL,onClose:()=>eD(!1),initialProjectFilter:"project-clients",onSelect:e=>{"create"===A?z({...M,clientLogoName:e}):D({...L,clientLogoName:e}),eD(!1)}}),(0,a.jsx)(eI,{isOpen:eT,onClose:()=>eM(!1),initialProjectFilter:"project-pins",onSelect:e=>{"create"===A?z({...M,pinName:e}):D({...L,pinName:e}),eM(!1)}})]})]}),ed&&(0,a.jsx)(ez,{message:ed.message,type:ed.type,onClose:()=>eg(null),duration:5e3})]})}var eU=t(87876),eO=t(23327),eV=t(89559),eG=t(15530),eB=t(80003);function eq(e){let{selectedCount:r,viewMode:t,onViewChange:s,onDelete:l,onMove:i,onRefresh:n,isRefreshing:o}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted/40 rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:r>0?(0,a.jsxs)("div",{className:"flex items-center gap-2 px-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-primary bg-primary/10 px-2 py-0.5 rounded-md",children:[r," s\xe9lectionn\xe9",r>1?"s":""]}),(0,a.jsx)("button",{onClick:i,className:"p-1.5 text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-500 dark:hover:text-blue-400 dark:hover:bg-blue-950/30 rounded-md transition-colors",title:"D\xe9placer la s\xe9lection",children:(0,a.jsx)(eP.A,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:l,className:"p-1.5 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-500 dark:hover:text-red-400 dark:hover:bg-red-950/30 rounded-md transition-colors",title:"Supprimer la s\xe9lection",children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})]}):(0,a.jsx)("span",{className:"text-sm text-muted-foreground px-2",children:"Aucune s\xe9lection"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:n,className:"p-1.5 hover:bg-background rounded-md transition-colors ".concat(o?"animate-spin text-primary":"text-muted-foreground"),title:"Actualiser",children:o?(0,a.jsx)(C.A,{className:"h-4 w-4"}):(0,a.jsx)(eV.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"w-px h-4 bg-border mx-1"}),(0,a.jsx)("button",{onClick:()=>s("grid"),className:"p-1.5 rounded-md transition-all ".concat("grid"===t?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:bg-background/50"),title:"Vue Grille",children:(0,a.jsx)(eG.A,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>s("list"),className:"p-1.5 rounded-md transition-all ".concat("list"===t?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:bg-background/50"),title:"Vue Liste",children:(0,a.jsx)(eB.A,{className:"h-4 w-4"})})]})]})}var eW=t(20017);function e$(e){let{files:r,selectedIds:t,onSelect:s,onRename:l,onPreview:i,onContextMenu:n,sortConfig:o,onSort:d}=e;if(0===r.length)return(0,a.jsx)("div",{className:"flex flex-col items-center justify-center p-12 text-muted-foreground",children:(0,a.jsx)("p",{children:"Aucun fichier trouv\xe9"})});let c=e=>(null==o?void 0:o.key)!==e?null:"asc"===o.direction?(0,a.jsx)(b.A,{className:"w-4 h-4 ml-1 inline"}):(0,a.jsx)(p.A,{className:"w-4 h-4 ml-1 inline"});return(0,a.jsx)("div",{className:"w-full overflow-auto p-4 pb-20",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b text-left text-muted-foreground select-none",children:[(0,a.jsx)("th",{className:"pb-3 pl-2 w-10"}),(0,a.jsxs)("th",{className:"pb-3 pl-2 font-medium cursor-pointer hover:text-foreground transition-colors",onClick:()=>null==d?void 0:d("name"),children:["Nom ",c("name")]}),(0,a.jsxs)("th",{className:"pb-3 font-medium hidden sm:table-cell cursor-pointer hover:text-foreground transition-colors",onClick:()=>null==d?void 0:d("fileType"),children:["Type ",c("fileType")]}),(0,a.jsxs)("th",{className:"pb-3 font-medium cursor-pointer hover:text-foreground transition-colors",onClick:()=>null==d?void 0:d("size"),children:["Taille ",c("size")]}),(0,a.jsxs)("th",{className:"pb-3 font-medium hidden md:table-cell cursor-pointer hover:text-foreground transition-colors",onClick:()=>null==d?void 0:d("createdAt"),children:["Date ",c("createdAt")]}),(0,a.jsx)("th",{className:"pb-3 w-10"})]})}),(0,a.jsx)("tbody",{children:r.map(e=>{let r=t.has(e.id),o=new Date(e.createdAt).toLocaleDateString();return(0,a.jsxs)("tr",{onClick:r=>{r.stopPropagation(),s(e.id,r.ctrlKey||r.metaKey)},onDoubleClick:r=>{r.stopPropagation(),null==i||i(e)},className:"\n                                    group border-b border-gray-100 dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors cursor-pointer text-sm\n                                    ".concat(r?"bg-indigo-50/60 dark:bg-indigo-900/20":"","\n                                "),onContextMenu:r=>{r.preventDefault(),null==n||n(r,e.id)},children:[(0,a.jsx)("td",{className:"py-2 pl-2",onClick:r=>{r.stopPropagation(),s(e.id,!1,!0)},children:(0,a.jsx)("div",{className:"\n                                        w-4 h-4 rounded border flex items-center justify-center\n                                        ".concat(r?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30","\n                                    "),children:r&&(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-sm"})})}),(0,a.jsx)("td",{className:"py-2 pl-2 font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded bg-muted flex items-center justify-center shrink-0 overflow-hidden relative",children:e.thumbnailUrl?(0,a.jsx)(Z.default,{src:e.thumbnailUrl,alt:"",fill:!0,className:"object-cover"}):(0,a.jsx)(e_,{type:e.fileType,className:"w-4 h-4 text-muted-foreground"})}),(0,a.jsx)("span",{className:"truncate max-w-[200px] sm:max-w-[300px]",children:e.name})]})}),(0,a.jsx)("td",{className:"py-2 hidden sm:table-cell text-muted-foreground lowercase",children:e.fileType}),(0,a.jsx)("td",{className:"py-2 text-muted-foreground font-mono text-xs",children:em(e.size)}),(0,a.jsx)("td",{className:"py-2 hidden md:table-cell text-muted-foreground",children:o}),(0,a.jsxs)("td",{className:"py-2 text-right pr-2 flex justify-end gap-1",children:[(0,a.jsx)("button",{onClick:r=>{r.stopPropagation(),null==l||l(e)},className:"p-1 hover:bg-background rounded text-muted-foreground hover:text-foreground",title:"Renommer",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})}),(0,a.jsx)("button",{className:"p-1 hover:bg-background rounded text-muted-foreground hover:text-foreground",children:(0,a.jsx)(eW.A,{className:"h-4 w-4"})})]})]},e.id)})})]})})}function e_(e){let{type:r,className:t}=e;switch(r){case"IMAGE":return(0,a.jsx)(j.A,{className:t});case"VIDEO":return(0,a.jsx)(ex.A,{className:t});case"DOCUMENT":return(0,a.jsx)(f.A,{className:t});case"ARCHIVE":return(0,a.jsx)(eu.A,{className:t});default:return(0,a.jsx)(eo.A,{className:t})}}function eH(){var e;let[r,t]=(0,s.useState)([]),[l,i]=(0,s.useState)(!0),[n,o]=(0,s.useState)("grid"),[d,c]=(0,s.useState)(""),g=function(e,r){let[t,a]=(0,s.useState)(e);return(0,s.useEffect)(()=>{let r=setTimeout(()=>{a(e)},300);return()=>{clearTimeout(r)}},[e,300]),t}(d,300),[x,u]=(0,s.useState)("ALL"),[m,h]=(0,s.useState)("Tous"),[p,b]=(0,s.useState)("ALL"),[f,y]=(0,s.useState)(new Set),[j,v]=(0,s.useState)(0),[w,N]=(0,s.useState)({key:"name",direction:"asc"}),[k,C]=(0,s.useState)(null),S=E("FileExplorer");(0,s.useEffect)(()=>{if("ALL"!==p&&"ORPHANED"!==p){var e;let t=r.find(e=>{var r;return(null==(r=e.project)?void 0:r.id)===p});(null==t||null==(e=t.project)?void 0:e.country)&&h(t.project.country)}},[p,r]);let A=(0,s.useMemo)(()=>[...r].sort((e,r)=>{if(!w)return 0;let{key:t,direction:a}=w,s=e[t],l=r[t];return("createdAt"===t&&(s=new Date(s).getTime(),l=new Date(l).getTime()),s<l)?"asc"===a?-1:1:s>l?"asc"===a?1:-1:0}),[r,w]),P=(0,s.useCallback)(async()=>{i(!0);try{let e=new URLSearchParams;"ALL"!==x&&e.append("fileType",x),"ALL"!==p&&e.append("projectId",p),"Tous"!==m&&e.append("country",m),g&&e.append("search",g);let r=await fetch("/api/files/list?".concat(e.toString()));if(!r.ok)throw Error("Failed to fetch files");let a=await r.json();t(a.files||[])}catch(e){S.error("Error fetching files:",e)}finally{i(!1)}},[x,p,m,g,S]);(0,s.useEffect)(()=>{P()},[P,j]);let[R,L]=(0,s.useState)(null),[D,T]=(0,s.useState)(""),[I,M]=(0,s.useState)(null),[z,F]=(0,s.useState)(null),[U,O]=(0,s.useState)(null),[V,G]=(0,s.useState)(null),B=(0,s.useCallback)(function(e,r){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=new Set(r||t?f:[]);a.has(e)?a.delete(e):a.add(e),y(a)},[f]),q=(0,s.useCallback)((e,r)=>{e.preventDefault();let t=A.find(e=>e.id===r);t&&(f.has(r)||B(r,e.ctrlKey||e.metaKey),F({x:e.clientX,y:e.clientY,file:t}))},[A,f,B]),W=e=>{L(e),T(e.name)},$=async()=>{if(!R||!D||D===R.name)return void L(null);try{if(!(await fetch("/api/files/".concat(R.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:D})})).ok)throw Error("Rename failed");C({message:"Fichier renomm\xe9 avec succ\xe8s",type:"success"}),v(e=>e+1)}catch(e){S.error("Rename error:",e),C({message:"Erreur lors du renommage",type:"error"})}finally{L(null)}},_=async e=>{if(U)try{let r=await fetch("/api/files/bulk-move",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileIds:U,projectId:e})});if(!r.ok){let e=await r.json();throw Error(e.error||"Move failed")}C({message:"".concat(U.length," fichier(s) d\xe9plac\xe9(s) avec succ\xe8s"),type:"success"}),v(e=>e+1),O(null),y(new Set)}catch(e){S.error("Move error:",e),C({message:e instanceof Error?e.message:"Erreur lors du d\xe9placement",type:"error"})}},H=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(V)try{if(!(await fetch("/api/files/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileIds:V,permanent:e})})).ok)throw Error("Delete failed");C({message:"".concat(V.length," fichier(s) supprim\xe9(s) avec succ\xe8s"),type:"success"}),y(new Set),v(e=>e+1),G(null)}catch(e){S.error("Delete error:",e),C({message:"Erreur lors de la suppression",type:"error"})}};return(0,a.jsxs)("div",{className:"flex flex-col h-full space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-4 bg-background z-10",children:[(0,a.jsx)(ef,{searchQuery:d,onSearchChange:c,fileTypeFilter:x,onFilterChange:u,countryFilter:m,onCountryChange:h,projectFilter:p,onProjectChange:b,files:r,onFileSelect:e=>{c(e.name)}}),(0,a.jsx)(eq,{selectedCount:f.size,viewMode:n,onViewChange:o,onMove:()=>O(Array.from(f)),onDelete:()=>{f.size>0&&G(Array.from(f))},onRefresh:()=>v(e=>e+1),isRefreshing:l})]}),(0,a.jsxs)("div",{className:"flex-1 min-h-0 bg-muted/10 rounded-lg border relative",children:[l&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/50 z-20",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),"grid"===n?(0,a.jsx)(ep,{files:A,selectedIds:f,onSelect:B,onRename:W,onPreview:M,onContextMenu:q}):(0,a.jsx)(e$,{files:A,selectedIds:f,onSelect:B,onRename:W,onPreview:M,onContextMenu:q,sortConfig:w,onSort:e=>{N(r=>(null==r?void 0:r.key)===e?{key:e,direction:"asc"===r.direction?"desc":"asc"}:{key:e,direction:"asc"})}}),!l&&0===A.length&&(0,a.jsx)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-muted-foreground pointer-events-none",children:(0,a.jsx)("p",{children:"Aucun fichier"})}),R&&(0,a.jsx)("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-background p-6 rounded-lg shadow-xl w-full max-w-sm border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Renommer le fichier"}),(0,a.jsx)("input",{type:"text",value:D,onChange:e=>T(e.target.value),className:"w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-primary outline-none",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&$(),"Escape"===e.key&&L(null)}}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>L(null),className:"px-4 py-2 text-sm text-muted-foreground hover:bg-muted rounded",children:"Annuler"}),(0,a.jsx)("button",{onClick:$,className:"px-4 py-2 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded font-medium",children:"Sauvegarder"})]})]})})]}),z&&(0,a.jsx)(eR,{x:z.x,y:z.y,file:z.file,onClose:()=>F(null),onPreview:()=>M(z.file),onRename:()=>W(z.file),onMove:()=>{f.has(z.file.id)?O(Array.from(f)):O([z.file.id])},onDelete:()=>{f.has(z.file.id)?G(Array.from(f)):G([z.file.id])}}),I&&(0,a.jsx)(eC,{file:I,files:A,onClose:()=>M(null),onNavigate:M}),U&&(0,a.jsx)(eD,{fileIds:U,currentProjectId:(null==(e=A.find(e=>e.id===U[0]))?void 0:e.projectId)||null,onClose:()=>O(null),onMove:_}),V&&(0,a.jsx)(eT,{fileCount:V.length,onClose:()=>G(null),onConfirm:H}),k&&(0,a.jsx)(ez,{message:k.message,type:k.type,onClose:()=>C(null)})]})}function eK(e){let{isOpen:r,isAdmin:t,onClose:l}=e,[i,n]=(0,s.useState)("dashboard"),o=E("FileManagementDialog"),[d,c]=(0,s.useState)(null),[g,x]=(0,s.useState)([]),u=(0,s.useCallback)(async()=>{try{let e=await fetch("/api/files/statistics");if(e.ok){let r=await e.json();c(r)}}catch(e){o.error("Erreur lors du chargement des statistiques:",e)}finally{}},[o]);(0,s.useEffect)(()=>{r&&t&&u()},[r,t,u]);let m=async e=>{let r=e.map(e=>({file:e,progress:0,status:"pending"}));x(e=>[...e,...r]),r.forEach(e=>p(e.file))},p=async e=>{b(e,{status:"uploading",progress:0});let r=new FormData;r.append("file",e);try{let t=new XMLHttpRequest;t.open("POST","/api/files/upload"),t.upload.onprogress=r=>{if(r.lengthComputable){let t=Math.round(r.loaded/r.total*100);b(e,{progress:t})}},t.onload=async()=>{if(t.status>=200&&t.status<300)try{JSON.parse(t.responseText),b(e,{status:"success",progress:100}),u()}catch(r){b(e,{status:"error",error:"Invalid response"})}else{let r="Upload failed";try{r=JSON.parse(t.responseText).error||r}catch(e){}b(e,{status:"error",error:r})}},t.onerror=()=>{b(e,{status:"error",error:"Network error"})},r.append("projectId","global_unassigned"),t.send(r)}catch(r){b(e,{status:"error",error:"Upload failed"})}},b=(e,r)=>{x(t=>t.map(t=>t.file===e?{...t,...r}:t))},v=d||{totalImages:0,totalPdfs:0,totalVideos:0,totalOthers:0,storageUsed:"0 MB",totalProjects:0,orphanedFiles:0,storageLimit:"1 GB",lastScan:new Date().toISOString()},w=Math.min(parseFloat(v.storageUsed)/1024*100,100);return r&&t?(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:l}),(0,a.jsxs)("div",{className:"relative w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 shadow-2xl rounded-2xl animate-in zoom-in-95 duration-300",children:[(0,a.jsxs)("div",{className:"flex flex-col border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 select-none",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/40 rounded-lg",children:(0,a.jsx)(eU.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg lg:text-xl font-bold text-gray-900 dark:text-white uppercase tracking-tight",children:"Gestion des Fichiers"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest leading-none mt-1",children:"Administration Globale"})]})]}),(0,a.jsx)("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:(0,a.jsx)(y.A,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"flex px-4 sm:px-5 gap-4 sm:gap-6 overflow-x-auto min-w-0 border-b border-gray-100 dark:border-gray-700 scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700",children:[(0,a.jsx)("button",{onClick:()=>n("dashboard"),className:"pb-3 text-sm font-bold uppercase tracking-wider transition-all border-b-2 whitespace-nowrap shrink-0 ".concat("dashboard"===i?"text-indigo-600 dark:text-indigo-400 border-indigo-600 dark:border-indigo-400":"text-gray-400 border-transparent hover:text-gray-600 dark:hover:text-gray-200"),children:"Tableau de bord"}),(0,a.jsx)("button",{onClick:()=>n("explorer"),className:"pb-3 text-sm font-bold uppercase tracking-wider transition-all border-b-2 whitespace-nowrap shrink-0 ".concat("explorer"===i?"text-indigo-600 dark:text-indigo-400 border-indigo-600 dark:border-indigo-400":"text-gray-400 border-transparent hover:text-gray-600 dark:hover:text-gray-200"),children:"Explorateur"}),(0,a.jsx)("button",{onClick:()=>n("upload"),className:"pb-3 text-sm font-bold uppercase tracking-wider transition-all border-b-2 whitespace-nowrap shrink-0 ".concat("upload"===i?"text-indigo-600 dark:text-indigo-400 border-indigo-600 dark:border-indigo-400":"text-gray-400 border-transparent hover:text-gray-600 dark:hover:text-gray-200"),children:"T\xe9l\xe9verser"}),(0,a.jsx)("div",{className:"w-8 shrink-0","aria-hidden":"true"})]})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto flex-grow custom-scrollbar",children:["dashboard"===i&&(0,a.jsxs)("div",{className:"animate-in fade-in slide-in-from-bottom-2 duration-300",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-2xl border border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:"Stockage (Cloudflare R2)"}),(0,a.jsx)(K.A,{className:"w-4 h-4 text-indigo-500"})]}),(0,a.jsxs)("div",{className:"flex items-baseline gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-2xl font-black text-gray-900 dark:text-white",children:v.storageUsed}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["/ ",v.storageLimit||"1 GB"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 h-2 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"bg-indigo-500 h-full transition-all duration-1000",style:{width:"".concat(w,"%")}})})]}),(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-2xl border border-gray-100 dark:border-gray-700 col-span-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:"R\xe9partition"}),(0,a.jsx)(h.A,{className:"w-4 h-4 text-blue-500"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"w-3.5 h-3.5 text-pink-500"}),(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Images"})]}),(0,a.jsx)("span",{className:"font-bold",children:v.totalImages})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{className:"w-3.5 h-3.5 text-blue-500"}),(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Documents"})]}),(0,a.jsx)("span",{className:"font-bold",children:v.totalPdfs})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ex.A,{className:"w-3.5 h-3.5 text-purple-500"}),(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Vid\xe9os"})]}),(0,a.jsx)("span",{className:"font-bold",children:v.totalVideos})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm p-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eu.A,{className:"w-3.5 h-3.5 text-orange-500"}),(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Autres"})]}),(0,a.jsx)("span",{className:"font-bold",children:v.totalOthers})]})]})]})]}),(0,a.jsx)("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-900/50 p-6 rounded-2xl",children:(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-xl shadow-sm h-fit",children:(0,a.jsx)(eO.A,{className:"w-5 h-5 text-indigo-500"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-bold text-indigo-900 dark:text-indigo-200 mb-1",children:"Informations Administration"}),(0,a.jsx)("p",{className:"text-xs text-indigo-700/80 dark:text-indigo-300/60 leading-relaxed italic",children:"Ceci est le tableau de bord global pour les administrateurs. Il permet de surveiller l'utilisation du stockage et de g\xe9rer tous les fichiers du syst\xe8me."})]})]})})]}),"explorer"===i&&(0,a.jsx)("div",{className:"h-full animate-in fade-in slide-in-from-bottom-2 duration-300",children:(0,a.jsx)(eH,{})}),"upload"===i&&(0,a.jsxs)("div",{className:"animate-in fade-in slide-in-from-bottom-2 duration-300 space-y-6",children:[(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 text-sm text-blue-800 dark:text-blue-200",children:(0,a.jsxs)("p",{className:"flex items-center gap-2",children:[(0,a.jsx)(eO.A,{className:"h-4 w-4"}),(0,a.jsx)("strong",{children:"Note:"})," S\xe9lectionnez un projet cible (WIP). Pour l'instant, les fichiers seront orphelins."]})}),(0,a.jsx)(en,{onFilesSelected:m}),(0,a.jsx)(ec,{uploads:g,onRemove:e=>{x(r=>r.filter((r,t)=>t!==e))},onClearCompleted:()=>x([])})]})]}),(0,a.jsx)("footer",{className:"p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 flex justify-end",children:(0,a.jsx)("button",{onClick:l,className:"px-8 py-3 bg-gray-900 dark:bg-white text-white dark:text-gray-900 text-xs font-black uppercase tracking-widest rounded-xl hover:scale-105 transition-all active:scale-95 shadow-lg shadow-gray-200 dark:shadow-none",children:"Fermer l'administration"})})]})]}):null}var eQ=t(52987),eJ=t(26667),eX=t(21786),eZ=t(56154),eY=t(79451);let e0=(e,r,t,a,s)=>{let l=document.createElement("canvas"),i=l.getContext("2d");if(!i)throw Error("Could not get canvas context");return l.width=r,l.height=t,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(e,0,0,r,t),l.toDataURL("image/".concat(s),a/100)},e1=(e,r)=>Math.round((e-r)/e*100);function e2(e){let{onImageLoad:r,isLoading:t}=e,l=(0,s.useCallback)(e=>{e.length>0&&r(e[0])},[r]),{getRootProps:i,getInputProps:n,isDragActive:o}=(0,es.VB)({onDrop:l,accept:{"image/*":[".png",".jpg",".jpeg",".webp"]},multiple:!1,disabled:t});return(0,a.jsxs)("div",{...i(),className:"relative border-2 border-dashed rounded-xl p-12 text-center cursor-pointer transition-all duration-300 ease-in-out\n        ".concat(o?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 scale-[1.02]":"border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-indigo-400 dark:hover:border-indigo-500","\n        ").concat(t?"opacity-50 cursor-not-allowed":"","\n      "),children:[(0,a.jsx)("input",{...n()}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4",children:[t?(0,a.jsx)(C.A,{className:"w-12 h-12 text-indigo-600 animate-spin"}):(0,a.jsx)("div",{className:"p-4 rounded-full ".concat(o?"bg-indigo-100 text-indigo-600":"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"),children:(0,a.jsx)(eX.A,{className:"w-8 h-8"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:o?"D\xe9posez l'image ici...":"Glissez-d\xe9posez une image ici"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ou cliquez pour s\xe9lectionner un fichier (JPG, PNG, WebP)"})]})]})]})}var e5=t(80891),e4=t(2821),e3=t(75889);let e6=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsxs)(e5.bL,{ref:r,className:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,e3.QP)((0,e4.$)(r))}("relative flex w-full touch-none select-none items-center",t),...s,children:[(0,a.jsx)(e5.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800",children:(0,a.jsx)(e5.Q6,{className:"absolute h-full bg-gray-900 dark:bg-gray-50"})}),(0,a.jsx)(e5.zi,{className:"block h-5 w-5 rounded-full border-2 border-gray-900 bg-white ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:border-gray-50 dark:bg-gray-950 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300"})]})});e6.displayName=e5.bL.displayName;let e9=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("label",{ref:r,className:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,e3.QP)((0,e4.$)(r))}("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...s})});e9.displayName="Label";var e8=t(78925),e7=t(99051);function re(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,e3.QP)((0,e4.$)(r))}let rr=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(e8.bL,{className:re("grid gap-2",t),...s,ref:r})});rr.displayName=e8.bL.displayName;let rt=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(e8.q7,{ref:r,className:re("aspect-square h-4 w-4 rounded-full border border-gray-900 text-gray-900 ring-offset-white focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-50 dark:text-gray-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",t),...s,children:(0,a.jsx)(e8.C1,{className:"flex items-center justify-center",children:(0,a.jsx)(e7.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});rt.displayName=e8.q7.displayName;var ra=t(5917);let rs=s.forwardRef((e,r)=>{let{className:t,checked:s,onCheckedChange:l,...i}=e;return(0,a.jsxs)("div",{className:"relative flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",className:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,e3.QP)((0,e4.$)(r))}("peer h-4 w-4 shrink-0 rounded-sm border border-gray-200 border-gray-900 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=checked]:text-gray-50 dark:border-gray-800 dark:border-gray-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=checked]:bg-gray-50 dark:data-[state=checked]:text-gray-900 appearance-none cursor-pointer",t),ref:r,checked:s,onChange:e=>null==l?void 0:l(e.target.checked),...i}),(0,a.jsx)(ra.A,{className:"absolute pointer-events-none opacity-0 peer-checked:opacity-100 h-3 w-3 top-0.5 left-0.5 text-current"})]})});rs.displayName="Checkbox";let rl=s.forwardRef((e,r)=>{let{className:t,type:s,...l}=e;return(0,a.jsx)("input",{type:s,className:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,e3.QP)((0,e4.$)(r))}("flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",t),ref:r,...l})});rl.displayName="Input";var ri=t(61750),rn=t(93141),ro=t(85921),rd=t(44173),rc=t(85710);function rg(e){let{originalDimensions:r,onResize:t,onCrop:l,onDownload:i,onUndo:n,onRedo:o,canUndo:d,canRedo:c,isProcessing:g}=e,[x,u]=(0,s.useState)(0),[m,h]=(0,s.useState)(0),[p,b]=(0,s.useState)(90),[f,y]=(0,s.useState)("jpeg"),[j,v]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{r&&(u(r.width),h(r.height))},[r]),r)?(0,a.jsxs)("div",{className:"space-y-6 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)(eg.$,{onClick:n,disabled:!d||g,variant:"outline",size:"sm",className:"flex-1 h-9 bg-gray-50/50 dark:bg-gray-900/30 font-bold hover:bg-gray-100 dark:hover:bg-gray-800 transition-all border-dashed",title:"Annuler (Ctrl+Z)",children:[(0,a.jsx)(_.A,{className:"w-4 h-4 mr-2"})," Annuler"]}),(0,a.jsxs)(eg.$,{onClick:o,disabled:!c||g,variant:"outline",size:"sm",className:"flex-1 h-9 bg-gray-50/50 dark:bg-gray-900/30 font-bold hover:bg-gray-100 dark:hover:bg-gray-800 transition-all border-dashed",title:"R\xe9tablir (Ctrl+Y)",children:[(0,a.jsx)(H.A,{className:"w-4 h-4 mr-2"})," R\xe9tablir"]})]}),(0,a.jsx)("div",{className:"h-px bg-gray-100 dark:bg-gray-700 my-4"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-widest flex items-center gap-2",children:[(0,a.jsx)(ri.A,{className:"w-4 h-4 text-indigo-500"})," Redimensionner"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(e9,{htmlFor:"width",className:"text-xs",children:"Largeur (px)"}),(0,a.jsx)(rl,{id:"width",type:"number",value:x,onChange:e=>(e=>{if(u(e),j&&r){var t;h((t=r.width,Math.round(e/t*r.height)))}})(Number(e.target.value)),className:"font-mono text-sm"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(e9,{htmlFor:"height",className:"text-xs",children:"Hauteur (px)"}),(0,a.jsx)(rl,{id:"height",type:"number",value:m,onChange:e=>{var t;h(t=Number(e.target.value)),j&&r&&u(Math.round(t*(r.width/r.height)))},className:"font-mono text-sm"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(rs,{id:"aspect",checked:j,onCheckedChange:e=>v(e)}),(0,a.jsx)(e9,{htmlFor:"aspect",className:"text-sm text-gray-600 dark:text-gray-400 font-normal",children:"Conserver le ratio d'aspect"})]})]}),(0,a.jsx)("div",{className:"h-px bg-gray-100 dark:bg-gray-700 my-4"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-widest flex items-center gap-2",children:[(0,a.jsx)(rn.A,{className:"w-4 h-4 text-blue-500"})," Format & Qualit\xe9"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(e9,{className:"text-xs text-gray-500 dark:text-gray-400",children:"Format de sortie"}),(0,a.jsxs)(rr,{value:f,onValueChange:e=>y(e),className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(rt,{value:"jpeg",id:"jpeg"}),(0,a.jsx)(e9,{htmlFor:"jpeg",className:"font-mono",children:"JPEG"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(rt,{value:"png",id:"png"}),(0,a.jsx)(e9,{htmlFor:"png",className:"font-mono",children:"PNG"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(rt,{value:"webp",id:"webp"}),(0,a.jsx)(e9,{htmlFor:"webp",className:"font-mono",children:"WebP"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,a.jsx)("div",{className:"flex justify-between",children:(0,a.jsxs)(e9,{className:"text-xs text-gray-500 dark:text-gray-400",children:["Qualit\xe9 (",p,"%)"]})}),(0,a.jsx)(e6,{value:[p],onValueChange:e=>b(e[0]),max:100,step:1,className:"w-full"})]})]}),(0,a.jsx)("div",{className:"h-px bg-gray-100 dark:bg-gray-700 my-4"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(eg.$,{onClick:()=>{t(x,m,p,f)},disabled:g,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white",children:[g?(0,a.jsx)(rn.A,{className:"w-4 h-4 mr-2 animate-spin"}):(0,a.jsx)(ro.A,{className:"w-4 h-4 mr-2"}),"Appliquer les changements"]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)(eg.$,{onClick:l,variant:"outline",disabled:g,className:"w-full h-11",children:[(0,a.jsx)(rd.A,{className:"w-4 h-4 mr-2"})," Recadrer l'image"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)(eg.$,{onClick:i,variant:"secondary",disabled:g,className:"h-11 bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 text-sm font-bold px-4",children:[(0,a.jsx)(S.A,{className:"w-4 h-4 mr-2"})," Sur mon PC"]}),(0,a.jsxs)(eg.$,{onClick:()=>{var e,r;return null==(e=(r=window).dispatchUploadEvent)?void 0:e.call(r)},variant:"secondary",disabled:g,className:"h-11 bg-green-50 text-green-700 hover:bg-green-100 dark:bg-green-900/20 dark:text-green-400 text-sm font-bold px-4",children:[(0,a.jsx)(rc.A,{className:"w-4 h-4 mr-2"})," Sur la Base"]})]})]})]})]}):null}var rx=t(35626);let ru=850/525;function rm(e){let{imageSrc:r,onApply:t,onCancel:l}=e,i=(0,s.useRef)(null),n=(0,s.useRef)(null),[o,d]=(0,s.useState)(null),[c,g]=(0,s.useState)(!1),[x,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[p,b]=(0,s.useState)(void 0),f=(0,s.useRef)({x:0,y:0}),v=(0,s.useCallback)(()=>{let e,r;if(!n.current||!i.current)return;let t=n.current,a=t.naturalWidth,s=t.naturalHeight,l=t.width,o=t.height,c=a/s;c>l/o?(e=l,r=l/c):(r=o,e=o*c);let g=e/a,x=850*g,u=525*g;(x>e||u>r)&&(e/r>ru?x=(u=r)*ru:u=(x=e)/ru),d({x:(l-e)/2+(e-x)/2,y:(o-r)/2+(r-u)/2,width:x,height:u})},[]),w=e=>{if(!n.current)return{x:0,y:0};let r=n.current.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}},N=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.stopPropagation(),e.preventDefault(),o&&(g(!0),u(r),"move"===r)){let r=w(e);f.current={x:r.x-o.x,y:r.y-o.y}}},k=(0,s.useCallback)(e=>{if(!c||!o||!n.current)return;let r=w(e),{width:t,height:a}=n.current.getBoundingClientRect();d(e=>{if(!e)return null;let s={...e};if("nw"===x){let t=e.x+e.width,a=e.y+e.height,l=t-r.x,i=l/ru,n=t-l,o=a-i;n>=0&&o>=0&&l>=50&&i>=50&&(s.x=n,s.y=o,s.width=l,s.height=i)}else if("ne"===x){let a=e.y+e.height,l=r.x-e.x,i=l/ru,n=a-i;e.x+l<=t&&n>=0&&l>=50&&i>=50&&(s.y=n,s.width=l,s.height=i)}else if("sw"===x){let t=e.x+e.width,l=t-r.x,i=l/ru,n=t-l;n>=0&&e.y+i<=a&&l>=50&&i>=50&&(s.x=n,s.width=l,s.height=i)}else if("se"===x){let l=r.x-e.x,i=l/ru;e.x+l<=t&&e.y+i<=a&&l>=50&&i>=50&&(s.width=l,s.height=i)}else if("move"===x){let l=r.x-f.current.x,i=r.y-f.current.y;l=Math.max(0,Math.min(l,t-e.width)),i=Math.max(0,Math.min(i,a-e.height)),s.x=l,s.y=i}return s})},[c,x,o]);(0,s.useEffect)(()=>(c&&(window.addEventListener("mousemove",k),window.addEventListener("mouseup",()=>g(!1))),()=>{window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",()=>g(!1))}),[c,k]);let C=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!o||!n.current)return;let r=n.current.width,t=n.current.height,a=n.current.naturalWidth,s=n.current.naturalHeight,l=a/r,i=s/t,c={x:o.x*l,y:o.y*i,width:o.width*l,height:o.height*i},g=document.createElement("canvas"),x=g.getContext("2d");if(!x)return;g.width=c.width,g.height=c.height,x.drawImage(n.current,c.x,c.y,c.width,c.height,0,0,c.width,c.height);let u=g.toDataURL("image/jpeg",.95);if(e){let e=document.createElement("canvas"),r=e.getContext("2d");if(r){e.width=850,e.height=525;let t=new Image;t.src=u,await new Promise(e=>t.onload=e),r.drawImage(t,0,0,850,525),u=e.toDataURL("image/jpeg",.95)}}h(u),b(e?{width:850,height:525}:void 0),d(c)};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl overflow-hidden shadow-2xl max-w-5xl w-full flex flex-col max-h-[90vh]",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center bg-gray-50 dark:bg-gray-900/50",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"w-5 h-5 text-indigo-600"}),m?"Aper\xe7u du r\xe9sultat":"Outil de Recadrage"]}),!m&&(0,a.jsxs)(eg.$,{variant:"ghost",size:"sm",onClick:v,className:"text-xs uppercase font-bold tracking-widest h-8",children:[(0,a.jsx)(eS.A,{className:"w-4 h-4 mr-2"})," R\xe9initialiser"]})]}),(0,a.jsx)("div",{className:"flex-grow overflow-auto p-8 flex items-center justify-center bg-gray-100 dark:bg-gray-950/50",ref:i,children:m?(0,a.jsxs)("div",{className:"relative group animate-in zoom-in-95 duration-200",children:[(0,a.jsx)("img",{src:m,alt:"Preview",className:"max-h-[60vh] object-contain block shadow-2xl border-4 border-white dark:border-gray-800"}),(0,a.jsxs)("div",{className:"absolute -bottom-4 left-1/2 -translate-x-1/2 bg-indigo-600 text-white text-[10px] px-3 py-1 rounded-full font-bold shadow-lg uppercase tracking-wider",children:["R\xe9sultat : ",p?"850 \xd7 525":"".concat(Math.round((null==o?void 0:o.width)||0)," \xd7 ").concat(Math.round((null==o?void 0:o.height)||0))," px"]})]}):(0,a.jsxs)("div",{className:"relative inline-block select-none",children:[(0,a.jsx)("img",{ref:n,src:r,alt:"Crop target",className:"max-h-[60vh] object-contain block pointer-events-none",onLoad:v}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 bg-black/60 backdrop-blur-[1px]",style:{height:o.y}}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 backdrop-blur-[1px]",style:{top:o.y+o.height}}),(0,a.jsx)("div",{className:"absolute left-0 bg-black/60 backdrop-blur-[1px]",style:{top:o.y,height:o.height,width:o.x}}),(0,a.jsx)("div",{className:"absolute right-0 bg-black/60 backdrop-blur-[1px]",style:{top:o.y,height:o.height,left:o.x+o.width}}),(0,a.jsxs)("div",{className:"absolute border-2 border-white shadow-[0_0_20px_rgba(0,0,0,0.5)] cursor-move",style:{top:o.y,left:o.x,width:o.width,height:o.height},onMouseDown:e=>N(e,"move"),children:[(0,a.jsx)("div",{className:"absolute -top-8 left-0 bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-[11px] px-2 py-1 pointer-events-none rounded shadow-md border font-bold",children:(()=>{if(!n.current)return"0 x 0";let e=n.current.naturalWidth/n.current.width,r=n.current.naturalHeight/n.current.height;return"".concat(Math.round(o.width*e)," \xd7 ").concat(Math.round(o.height*r)," px")})()}),(0,a.jsx)("div",{className:"absolute -top-2 -left-2 w-4 h-4 bg-white border-2 border-indigo-600 shadow-md cursor-nw-resize",onMouseDown:e=>N(e,"nw")}),(0,a.jsx)("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-white border-2 border-indigo-600 shadow-md cursor-ne-resize",onMouseDown:e=>N(e,"ne")}),(0,a.jsx)("div",{className:"absolute -bottom-2 -left-2 w-4 h-4 bg-white border-2 border-indigo-600 shadow-md cursor-sw-resize",onMouseDown:e=>N(e,"sw")}),(0,a.jsx)("div",{className:"absolute -bottom-2 -right-2 w-4 h-4 bg-white border-2 border-indigo-600 shadow-md cursor-se-resize",onMouseDown:e=>N(e,"se")})]})]})]})}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-100 dark:border-gray-800 flex flex-col sm:flex-row justify-between gap-3 bg-white dark:bg-gray-900",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eg.$,{variant:"ghost",onClick:()=>h(null),className:"text-xs font-bold uppercase tracking-widest order-3 sm:order-1",children:[(0,a.jsx)(rx.A,{className:"w-4 h-4 mr-2"})," Retour au r\xe9glage"]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 order-1 sm:order-2 w-full sm:w-auto",children:[(0,a.jsxs)(eg.$,{variant:"outline",onClick:l,className:"text-xs font-bold uppercase tracking-widest",children:[(0,a.jsx)(y.A,{className:"w-4 h-4 mr-2"})," Annuler tout"]}),(0,a.jsxs)(eg.$,{onClick:()=>{o&&t(o,p)},className:"bg-green-600 hover:bg-green-700 text-white text-xs font-bold uppercase tracking-widest px-8 shadow-md",children:[(0,a.jsx)(ra.A,{className:"w-4 h-4 mr-2"})," Accepter le r\xe9sultat"]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eg.$,{variant:"outline",onClick:l,className:"text-xs font-bold uppercase tracking-widest order-3 sm:order-1",children:[(0,a.jsx)(y.A,{className:"w-4 h-4 mr-2"})," Annuler"]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 order-1 sm:order-2 w-full sm:w-auto",children:[(0,a.jsxs)(eg.$,{onClick:()=>C(!1),variant:"secondary",className:"text-xs font-bold uppercase tracking-widest shadow-sm border",children:[(0,a.jsx)(ra.A,{className:"w-4 h-4 mr-2"})," Recadrer seul"]}),(0,a.jsxs)(eg.$,{onClick:()=>C(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold uppercase tracking-widest px-6 shadow-md",children:[(0,a.jsx)(rn.A,{className:"w-4 h-4 mr-2"})," Recadrer & Redimensionner (850x525)"]})]})]})})]})})}function rh(e){let{className:r,variant:t="default",...s}=e;return(0,a.jsx)("div",{className:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,e3.QP)((0,e4.$)(r))}("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",{"border-transparent bg-gray-900 text-gray-50 hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80":"default"===t,"border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80":"secondary"===t,"text-gray-950 dark:text-gray-50":"outline"===t,"border-transparent bg-red-500 text-gray-50 hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80":"destructive"===t},r),...s})}function rp(e){let{imageSrc:r,title:t,size:s,dimensions:l,compressionRatio:i,isResult:n,filename:o}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"p-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/50",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"w-4 h-4"}),t]}),o&&(0,a.jsx)("span",{className:"text-[10px] text-gray-400 font-medium truncate max-w-[150px]",children:o})]}),n&&void 0!==i&&(0,a.jsx)(rh,{variant:i>0?"default":"secondary",className:i>0?"bg-green-500 hover:bg-green-600":"",children:i>0?"-".concat(i,"%"):"0%"})]}),(0,a.jsxs)("div",{className:"relative flex-grow min-h-[200px] bg-gray-100 dark:bg-gray-900/50 flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 opacity-[0.4]",style:{backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"}}),(0,a.jsx)("img",{src:r,alt:t,className:"max-w-full max-h-[400px] object-contain relative z-10 shadow-lg rounded-lg"})]}),(0,a.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900/30 border-t border-gray-100 dark:border-gray-700 flex gap-4 text-xs text-gray-500 dark:text-gray-400",children:[l&&(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"uppercase font-bold text-[10px] tracking-wider text-gray-400",children:"Dimensions"}),(0,a.jsxs)("span",{className:"font-mono text-gray-700 dark:text-gray-300",children:[Math.round(l.width)," x ",Math.round(l.height),"px"]})]}),void 0!==s&&(0,a.jsxs)("div",{className:"flex flex-col border-l border-gray-200 dark:border-gray-700 pl-4",children:[(0,a.jsx)("span",{className:"uppercase font-bold text-[10px] tracking-wider text-gray-400",children:"Poids"}),(0,a.jsx)("span",{className:"font-mono text-gray-700 dark:text-gray-300",children:(e=>{if(0===e)return"0 Bytes";let r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(2))+" "+["Bytes","KB","MB","GB"][r]})(s)})]}),l&&(0,a.jsxs)("div",{className:"flex flex-col border-l border-gray-200 dark:border-gray-700 pl-4",children:[(0,a.jsx)("span",{className:"uppercase font-bold text-[10px] tracking-wider text-gray-400",children:"Ratio"}),(0,a.jsx)("span",{className:"font-mono text-gray-700 dark:text-gray-300",children:(l.width/l.height).toFixed(2)})]})]})]})}function rb(e){let{original:r,processed:t}=e;return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider text-center",children:"Avant"}),(0,a.jsx)(rp,{imageSrc:r.src,title:"Original",size:r.size,dimensions:{width:r.width,height:r.height},filename:r.file.name})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider text-center",children:"Apr\xe8s"}),(0,a.jsx)(rp,{imageSrc:t.src,title:"Modifi\xe9",size:t.size,dimensions:{width:t.width,height:t.height},compressionRatio:t.compressionRatio,filename:t.file.name,isResult:!0})]})]})}var rf=t(17787),ry=t(49027),rj=t(27587),rv=t(49476),rw=t(26983),rN=t(42366);function rk(e){let{id:r,image:t,isPublished:s,onRemove:l,onEdit:i}=e,{attributes:n,listeners:o,setNodeRef:d,transform:c,transition:g,isDragging:x}=(0,ry.gl)({id:r}),u=E("SortableImageCard"),m={transform:rj.Ks.Transform.toString(c),transition:g,opacity:x?.5:1};return(0,a.jsxs)("div",{ref:d,style:m,className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 p-3 sm:p-4 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-xl transition-all ".concat(x?"shadow-2xl scale-[1.02] z-50 bg-white dark:bg-gray-800":"hover:border-indigo-300 dark:hover:border-indigo-700"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[(0,a.jsx)("div",{...n,...o,className:"cursor-grab active:cursor-grabbing p-2 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg transition-colors shrink-0",children:(0,a.jsx)(rv.A,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400"})}),(0,a.jsx)("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-800 flex-shrink-0",children:(0,a.jsx)(Z.default,{src:(0,rN.M)(t.url),alt:t.alt||"Image",fill:!0,sizes:"(max-width: 640px) 64px, (max-width: 768px) 80px, 96px",className:"object-cover"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 sm:hidden",children:[(0,a.jsx)("p",{className:"text-[13px] font-bold text-gray-900 dark:text-white truncate",children:t.alt||"Sans titre"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 truncate mt-0.5",children:t.url.split("/").pop()})]})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:t.alt||"Sans titre"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-1",children:t.url.split("/").pop()})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:s?(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[(0,a.jsx)(Q.A,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,a.jsx)("span",{className:"text-xs font-bold text-green-700 dark:text-green-400 uppercase tracking-wider",children:"Publi\xe9"})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:[(0,a.jsx)(rw.A,{className:"w-4 h-4 text-amber-600 dark:text-amber-300"}),(0,a.jsx)("span",{className:"text-xs font-bold text-amber-700 dark:text-amber-300 uppercase tracking-wider",children:"Brouillon"})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[i&&(0,a.jsxs)(eg.$,{onClick:e=>{e.stopPropagation(),i()},variant:"ghost",size:"sm",className:"flex items-center gap-2 text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 px-3 h-9",children:[(0,a.jsx)(eJ.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-[10px] font-bold uppercase",children:"Retoucher"})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(eg.$,{type:"button",onMouseDown:e=>{u.debug("onMouseDown trash:",r),e.stopPropagation()},onClick:e=>{u.debug("onClick trash:",r),e.stopPropagation(),e.preventDefault();let t=e.currentTarget;"true"===t.getAttribute("data-confirm")?(u.info("Confirmed removal"),t.setAttribute("data-confirm","false"),l()):(u.info("Asking for confirmation"),t.setAttribute("data-confirm","true"),setTimeout(()=>{t&&t.setAttribute("data-confirm","false")},4e3))},variant:"ghost",size:"sm",className:"group relative flex items-center gap-2 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all cursor-pointer z-50 px-3 data-[confirm=true]:bg-red-600 data-[confirm=true]:text-white data-[confirm=true]:hover:bg-red-700","data-confirm":"false",children:[(0,a.jsx)(B.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"max-w-0 overflow-hidden whitespace-nowrap text-[10px] font-bold uppercase transition-all group-data-[confirm=true]:max-w-[100px] group-data-[confirm=true]:ml-1",children:"Supprimer ?"})]})})]})]})}var rC=t(3197);function rS(e){let{isOpen:r,onClose:t,images:s,projectName:l}=e;return r?(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] bg-black/95 flex flex-col animate-in fade-in duration-300",children:[(0,a.jsx)("div",{className:"absolute top-6 right-6 z-[110]",children:(0,a.jsx)(eg.$,{onClick:t,variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 rounded-full h-12 w-12",children:(0,a.jsx)(y.A,{className:"w-8 h-8"})})}),(0,a.jsx)("div",{className:"flex-grow flex items-center justify-center p-4 lg:p-8",children:(0,a.jsx)("div",{className:"w-full max-w-6xl",children:(0,a.jsx)(rC.R,{images:s,projectName:l})})}),(0,a.jsx)("div",{className:"p-6 text-center text-white/40 text-xs font-medium uppercase tracking-widest bg-gradient-to-t from-black to-transparent",children:"Mode aper\xe7u - Appuyez sur \xc9chap pour quitter"})]}):null}var rA=t(20063);let rE=(0,l.createServerReference)("60712d53f3bd9a1b05e7001f95cfb99f6055c27d07",l.callServer,void 0,l.findSourceMapURL,"getSlideshowImages");var rP=t(34705);let rR=(0,l.createServerReference)("4034410f536dd66bbb9d823d95a58cf8523840582b",l.callServer,void 0,l.findSourceMapURL,"removeSlideshowImage"),rL=(0,l.createServerReference)("6013e83935aae2b222efc37508424f367e3a76ca47",l.callServer,void 0,l.findSourceMapURL,"reorderSlideshowImages"),rD=(0,l.createServerReference)("406a33ef28382570b227b435fd5dfffa3067f13ae9",l.callServer,void 0,l.findSourceMapURL,"publishSlideshow"),rT=(0,l.createServerReference)("40007045edf6fc223d06418aeb1dddcede5ec03510",l.callServer,void 0,l.findSourceMapURL,"getProjectVideos"),rI=(0,l.createServerReference)("709021817a1e553bf869ddf24605560a9bcdb9c264",l.callServer,void 0,l.findSourceMapURL,"addProjectVideo"),rM=(0,l.createServerReference)("401d71534446b159d61ba7fa65c83928880ad2d1dd",l.callServer,void 0,l.findSourceMapURL,"deleteProjectVideo"),rz=(0,l.createServerReference)("601ff6415cb6d8130d6dd40b1cdf860a497c23bb57",l.callServer,void 0,l.findSourceMapURL,"reorderProjectVideos"),rF=(0,l.createServerReference)("40aa24afdfd41aed7a2c93164062c4da8f21066eaf",l.callServer,void 0,l.findSourceMapURL,"publishProjectVideos"),rU=(0,l.createServerReference)("40e95e540eb0711d453e7e1e281f796c81bfc0b8b4",l.callServer,void 0,l.findSourceMapURL,"unpublishProjectVideos"),rO=(0,l.createServerReference)("409ccce6b534e995a3719cd4819d0410c8202af918",l.callServer,void 0,l.findSourceMapURL,"toggleVideoPublishStatus");function rV(e){let{id:r,video:t,isPublished:s,onRemove:l,onTogglePublish:i}=e,{attributes:n,listeners:o,setNodeRef:d,transform:c,transition:g,isDragging:x}=(0,ry.gl)({id:r}),u={transform:rj.Ks.Transform.toString(c),transition:g,opacity:x?.5:1},m=(e=>{if(e.includes("youtube.com")||e.includes("youtu.be")){var r;let t=(null==(r=e.split("v=")[1])?void 0:r.split("&")[0])||e.split("/").pop();return"https://img.youtube.com/vi/".concat(t,"/default.jpg")}return null})(t.url);return(0,a.jsxs)("div",{ref:d,style:u,className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 p-3 sm:p-4 bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-xl transition-all ".concat(x?"shadow-2xl scale-[1.02] z-50 bg-white dark:bg-gray-800":"hover:border-indigo-300 dark:hover:border-indigo-700"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[(0,a.jsx)("div",{...n,...o,className:"cursor-grab active:cursor-grabbing p-2 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg transition-colors shrink-0",children:(0,a.jsx)(rv.A,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400"})}),(0,a.jsx)("div",{className:"relative w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-800 flex items-center justify-center flex-shrink-0",children:m?(0,a.jsx)("img",{src:m,alt:t.title||"Video thumbnail",className:"w-full h-full object-cover"}):(0,a.jsx)(ex.A,{className:"w-8 h-8 text-gray-400"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 sm:hidden",children:[(0,a.jsx)("p",{className:"text-[13px] font-bold text-gray-900 dark:text-white truncate",children:t.title||"Vid\xe9o sans titre"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 truncate mt-0.5",children:t.url})]})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 hidden sm:block",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:t.title||"Vid\xe9o sans titre"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-1",children:t.url})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("button",{onClick:i,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border transition-all ".concat(s?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30":"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800 hover:bg-amber-100 dark:hover:bg-amber-900/30"),title:s?"Masquer la vid\xe9o":"Publier la vid\xe9o",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Q.A,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,a.jsx)("span",{className:"text-xs font-bold text-green-700 dark:text-green-400 uppercase tracking-wider hidden sm:inline",children:"Publi\xe9"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(rw.A,{className:"w-4 h-4 text-amber-600 dark:text-amber-300"}),(0,a.jsx)("span",{className:"text-xs font-bold text-amber-700 dark:text-amber-300 uppercase tracking-wider hidden sm:inline",children:"Brouillon"})]})})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(eg.$,{type:"button",onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),e.preventDefault();let r=e.currentTarget;"true"===r.getAttribute("data-confirm")?(r.setAttribute("data-confirm","false"),l()):(r.setAttribute("data-confirm","true"),setTimeout(()=>{r&&r.setAttribute("data-confirm","false")},4e3))},variant:"ghost",size:"sm",className:"group relative flex items-center gap-2 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all cursor-pointer z-50 px-3 data-[confirm=true]:bg-red-600 data-[confirm=true]:text-white data-[confirm=true]:hover:bg-red-700","data-confirm":"false",children:[(0,a.jsx)(B.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"max-w-0 overflow-hidden whitespace-nowrap text-[10px] font-bold uppercase transition-all group-data-[confirm=true]:max-w-[100px] group-data-[confirm=true]:ml-1",children:"Supprimer ?"})]})})})]})}let rG=(0,l.createServerReference)("7009c7527762a23b48065ee56920f2b7bb3b53fb6a",l.callServer,void 0,l.findSourceMapURL,"getSignedVideoUploadAction");function rB(e){let{projectId:r,onUpload:t,onError:l}=e,[i,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)(0),[c,g]=(0,s.useState)("idle"),x=E("VideoDropzone"),u=(0,s.useCallback)(async e=>{if(0===e.length)return;let a=e[0];n(!0),d(0),g("preparing");try{let e=await rG(r,a.name,a.type);if(!e.success||!e.signedUrl||!e.publicUrl)throw Error(e.error||"Impossible de pr\xe9parer l'envoi");g("uploading"),await new Promise((r,t)=>{let s=new XMLHttpRequest;s.open("PUT",e.signedUrl),s.setRequestHeader("Content-Type",a.type),s.upload.onprogress=e=>{if(e.lengthComputable){let r=Math.round(e.loaded/e.total*100);d(r)}},s.onload=()=>{200===s.status?r(!0):t(Error("Erreur lors de l'envoi (".concat(s.status,")")))},s.onerror=()=>t(Error("Erreur r\xe9seau lors de l'envoi")),s.send(a)}),g("saving"),await t(e.publicUrl,a.name.replace(/\.[^/.]+$/,""))}catch(e){x.error("Upload error:",e),l(e instanceof Error?e.message:"Une erreur est survenue lors de l'envoi"),d(0)}finally{n(!1),g("idle"),d(0)}},[r,t,l,x]),{getRootProps:m,getInputProps:h,isDragActive:p}=(0,es.VB)({onDrop:u,accept:{"video/*":[".mp4",".mov",".avi",".webm",".m4v"]},maxFiles:1,disabled:i});return(0,a.jsxs)("div",{...m(),className:"relative flex flex-col items-center justify-center h-40 border-2 border-dashed rounded-2xl transition-all cursor-pointer ".concat(p?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":i?"border-gray-200 bg-gray-50/50 cursor-not-allowed":"border-gray-200 dark:border-gray-700 hover:border-indigo-400 hover:bg-gray-50 dark:hover:bg-gray-800/50"),children:[(0,a.jsx)("input",{...h()}),i?(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3 w-full px-8",children:[(0,a.jsxs)("div",{className:"relative w-12 h-12 flex items-center justify-center",children:[(0,a.jsx)(C.A,{className:"w-8 h-8 animate-spin text-indigo-500"}),(0,a.jsxs)("span",{className:"absolute text-[10px] font-bold text-indigo-600",children:[o,"%"]})]}),(0,a.jsx)("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:(()=>{switch(c){case"preparing":return"PR\xc9PARATION...";case"uploading":default:return"ENVOI EN COURS...";case"saving":return"ENREGISTREMENT..."}})()}),(0,a.jsx)("div",{className:"w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:"".concat(o,"%")}})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 text-center px-4",children:[(0,a.jsx)("div",{className:"p-2 bg-white dark:bg-gray-900 rounded-lg shadow-sm",children:(0,a.jsx)(ex.A,{className:"w-5 h-5 ".concat(p?"text-indigo-500":"text-gray-400")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-bold text-gray-700 dark:text-gray-300",children:p?"D\xe9posez la vid\xe9o ici":"Glissez une vid\xe9o ou cliquez"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 uppercase tracking-tighter mt-1",children:"MP4, MOV, AVI, WEBM (Max 500MB)"})]})]})]})}function rq(e){let{video:r,onClose:t}=e;return r?(0,a.jsx)("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-in fade-in duration-300",onClick:t,children:(0,a.jsxs)("div",{className:"relative max-w-5xl w-full aspect-video bg-black rounded-3xl overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{onClick:t,className:"absolute top-4 right-4 z-10 p-2 bg-black/40 hover:bg-black/60 text-white rounded-full transition-colors",children:(0,a.jsx)(y.A,{className:"w-6 h-6"})}),(0,a.jsx)("div",{className:"absolute top-4 left-6 z-10 px-4 py-2 bg-black/40 backdrop-blur-md rounded-xl",children:(0,a.jsx)("h3",{className:"text-white font-bold text-sm",children:r.title})}),(0,a.jsx)("video",{src:r.url,controls:!0,autoPlay:!0,className:"w-full h-full",children:"Votre navigateur ne supporte pas la lecture de vid\xe9os."})]})}):null}function rW(e){let{isOpen:r,onClose:t,onSelect:l,initialProjectFilter:i}=e,[n,o]=(0,s.useState)([]),[d,c]=(0,s.useState)(!1),[g,x]=(0,s.useState)(""),[u,m]=(0,s.useState)("Tous"),[h,p]=(0,s.useState)(i||"ALL"),[b,f]=(0,s.useState)(null),[j,v]=(0,s.useState)(null),w=E("DatabaseVideoPicker"),N=(0,s.useCallback)(()=>{f(null),x(""),m("Tous"),p(i||"ALL")},[i]),k=(0,s.useCallback)(async()=>{c(!0);try{let e=await fetch("/api/files/list?limit=500");if(e.ok){let r=await e.json();o(r.files||[])}}catch(e){w.error("Failed to fetch files",e)}finally{c(!1)}},[w]);(0,s.useEffect)(()=>{r&&(k(),N())},[r,N,k]),(0,s.useEffect)(()=>{if("ALL"!==h&&"ORPHANED"!==h){var e;let r=n.find(e=>{var r;return(null==(r=e.project)?void 0:r.id)===h});(null==r||null==(e=r.project)?void 0:e.country)&&m(r.project.country)}},[h,n]);let S=n.filter(e=>{var r,t,a;if("VIDEO"!==e.fileType||g&&!e.name.toLowerCase().includes(g.toLowerCase()))return!1;if("ALL"!==h){if("ORPHANED"===h){if(e.project)return!1}else if((null==(r=e.project)?void 0:r.id)!==h)return!1}return"Tous"===u||("Autre"===u?!(null==(a=e.project)?void 0:a.country):(null==(t=e.project)?void 0:t.country)===u)});return r?(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:t}),(0,a.jsxs)("div",{className:"relative bg-white dark:bg-gray-900 w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200 dark:border-gray-800 animate-in zoom-in-95 duration-300",children:[(0,a.jsxs)("div",{className:"p-5 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/40 rounded-lg",children:(0,a.jsx)(ex.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white uppercase tracking-tight",children:"Biblioth\xe8que Vid\xe9o"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-500 font-bold uppercase tracking-widest leading-none mt-1",children:"S\xe9lectionnez une vid\xe9o pour le projet"})]})]}),(0,a.jsx)("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:(0,a.jsx)(y.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-5 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",children:(0,a.jsx)(ef,{searchQuery:g,onSearchChange:x,fileTypeFilter:"VIDEO",onFilterChange:()=>{},countryFilter:u,onCountryChange:m,projectFilter:h,onProjectChange:p,files:n,onFileSelect:e=>{x(e.name),f(e.id)}})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/30 dark:bg-gray-950/20 custom-scrollbar relative",children:d?(0,a.jsxs)("div",{className:"flex flex-col justify-center items-center h-full gap-4",children:[(0,a.jsx)(C.A,{className:"h-10 w-10 animate-spin text-indigo-600"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500 animate-pulse",children:"Chargement de la biblioth\xe8que..."})]}):0===S.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full py-12 text-gray-400",children:[(0,a.jsx)(ex.A,{className:"w-12 h-12 mb-4 opacity-20"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"Aucune vid\xe9o trouv\xe9e"}),(0,a.jsx)(eg.$,{variant:"link",onClick:N,className:"text-indigo-600 mt-2",children:"R\xe9initialiser les filtres"})]}):(0,a.jsx)(ep,{files:S,selectedIds:new Set(b?[b]:[]),onSelect:e=>{f(e)},onPreview:v})}),(0,a.jsxs)("div",{className:"p-5 border-t border-gray-200 dark:border-gray-800 flex justify-end gap-3 bg-gray-50/50 dark:bg-gray-900/50",children:[(0,a.jsx)(eg.$,{variant:"ghost",onClick:t,className:"font-bold uppercase tracking-widest text-xs",children:"Annuler"}),(0,a.jsx)("button",{onClick:()=>{if(b){let e=n.find(e=>e.id===b);e&&(l(e.blobUrl,e.name),t())}},disabled:!b,className:"px-8 py-3 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg\n                            ".concat(b?"bg-gray-900 dark:bg-white text-white dark:text-gray-900 hover:scale-105 active:scale-95 shadow-gray-200 dark:shadow-none":"bg-gray-200 dark:bg-gray-800 text-gray-400 cursor-not-allowed shadow-none","\n                        "),children:"Importer cette vid\xe9o"})]})]}),j&&(0,a.jsx)(eC,{file:j,files:S,onClose:()=>v(null),onNavigate:v})]}):null}function r$(e){let{videos:r,loading:t,publishing:l,hasChanges:i,onPublish:n,onUnpublish:o,onRemove:d,onReorder:c,onAdd:g,onTogglePublish:x,setToast:u,projectId:m}=e,[h,p]=(0,s.useState)(null),[b,f]=(0,s.useState)(null),[y,j]=(0,s.useState)(!1),v=(0,rf.FR)((0,rf.MS)(rf.AN,{activationConstraint:{distance:5}}),(0,rf.MS)(rf.uN,{coordinateGetter:ry.JR})),w=async(e,r)=>{await g(e,r)&&u({message:"Vid\xe9o ajout\xe9e avec succ\xe8s !",type:"success"})},N=h?r.find(e=>e.id===h):null;return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-wider",children:["LISTE DES VID\xc9OS (",r.length,")"]}),i&&(0,a.jsxs)("span",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-amber-50 dark:bg-amber-900/20 text-[10px] font-bold text-amber-600 dark:text-amber-400 rounded-full border border-amber-100 dark:border-amber-800/30",children:[(0,a.jsx)("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse"}),"CHANGEMENTS NON PUBLI\xc9S"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eg.$,{size:"sm",variant:"outline",onClick:o,disabled:0===r.length||l,className:"text-[10px] font-bold tracking-widest uppercase h-9 px-4 hidden sm:flex",children:"TOUT D\xc9PUBLIER"}),(0,a.jsxs)(eg.$,{size:"sm",disabled:!i||l||0===r.length,onClick:n,className:"text-[10px] font-bold tracking-widest uppercase h-9 px-4 bg-indigo-600 hover:bg-indigo-700 text-white w-full sm:w-auto",children:[l?(0,a.jsx)(C.A,{className:"w-3.5 h-3.5 animate-spin mr-2"}):(0,a.jsx)(eX.A,{className:"w-3.5 h-3.5 mr-2"}),"TOUT PUBLIER"]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6",children:(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-3xl p-6 border border-gray-100 dark:border-gray-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h4",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2",children:[(0,a.jsx)(eX.A,{className:"w-3.5 h-3.5"}),"AJOUTER UNE VID\xc9O"]}),(0,a.jsxs)(eg.$,{variant:"outline",size:"sm",onClick:()=>j(!0),className:"bg-white dark:bg-gray-900 text-[10px] font-bold h-7",children:[(0,a.jsx)(rc.A,{className:"w-3 h-3 mr-2"}),"BIBLIOTH\xc8QUE (R2)"]})]}),(0,a.jsx)(rB,{projectId:m,onUpload:w,onError:e=>u({message:e,type:"error"})})]})}),(0,a.jsx)("div",{className:"space-y-4",children:t?(0,a.jsxs)("div",{className:"py-12 flex flex-col items-center justify-center text-gray-400",children:[(0,a.jsx)(C.A,{className:"w-8 h-8 animate-spin mb-4 text-indigo-500"}),(0,a.jsx)("p",{className:"text-xs",children:"Chargement des vid\xe9os..."})]}):0===r.length?(0,a.jsxs)("div",{className:"py-16 text-center text-gray-400",children:[(0,a.jsx)(ex.A,{className:"w-12 h-12 mb-4 mx-auto opacity-10"}),(0,a.jsx)("p",{className:"text-sm",children:"Aucune vid\xe9o li\xe9e \xe0 ce projet"})]}):(0,a.jsxs)(rf.Mp,{sensors:v,collisionDetection:rf.fp,onDragStart:e=>{p(e.active.id)},onDragEnd:e=>{let{active:t,over:a}=e;p(null),a&&t.id!==a.id&&c(r.findIndex(e=>e.id===t.id),r.findIndex(e=>e.id===a.id))},children:[(0,a.jsx)(ry.gB,{items:r.map(e=>e.id),strategy:ry._G,children:(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,a.jsx)("div",{onClick:()=>f(e),className:"cursor-pointer",children:(0,a.jsx)(rV,{id:e.id,video:e,isPublished:e.isPublished,onRemove:()=>d(e.id),onTogglePublish:()=>x(e.id)})},e.id))})}),(0,a.jsx)(rf.Hd,{children:N?(0,a.jsx)("div",{className:"scale-[1.02] shadow-2xl opacity-90 ring-2 ring-indigo-500 bg-white dark:bg-gray-800 rounded-xl overflow-hidden",children:(0,a.jsx)(rV,{id:N.id,video:N,isPublished:N.isPublished,onRemove:()=>{},onTogglePublish:()=>{}})}):null})]})}),(0,a.jsx)(rq,{video:b,onClose:()=>f(null)}),(0,a.jsx)(rW,{isOpen:y,onClose:()=>j(!1),onSelect:(e,r)=>{w(e,r.replace(/\.[^/.]+$/,""))},initialProjectFilter:m})]})}function r_(e){let{isOpen:r,onClose:t,projects:l,defaultTab:i="photos"}=e,[n,o]=(0,s.useState)(i),[d,c]=(0,s.useState)(null),g=(()=>{let[e,r]=(0,s.useState)(null),[t,a]=(0,s.useState)(null),[l,i]=(0,s.useState)(null),[n,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[g]=(0,s.useState)(null),[x,u]=(0,s.useState)([]),[m,h]=(0,s.useState)([]),p=(0,s.useCallback)((e,r,t)=>{let a={id:crypto.randomUUID(),action:e,details:r,thumbnail:t.src,timestamp:new Date,imageData:t};u(e=>[a,...e].slice(0,10)),h([])},[]),b=(0,s.useCallback)(async e=>{o(!0);try{let t=await new Promise((r,t)=>{let a=new FileReader;a.onload=e=>{var a;let s=new Image;s.onload=()=>r(s),s.onerror=t,s.src=null==(a=e.target)?void 0:a.result},a.onerror=t,a.readAsDataURL(e)}),s={src:t.src,file:e,width:t.width,height:t.height,size:e.size};r(s),a(s),i(null),u([]),h([])}catch(e){A.error("Failed to load image",e)}finally{o(!1)}},[]),f=(0,s.useCallback)(async(e,r)=>{o(!0);try{let t="/api/proxy?url=".concat(encodeURIComponent(e)),a=await fetch(t);if(!a.ok)throw Error("Proxy fetch failed: ".concat(a.statusText));let s=await a.blob(),l=new File([s],r,{type:s.type});await b(l)}catch(e){A.error("Failed to load image from URL",e)}finally{o(!1)}},[b]),y=(0,s.useCallback)(async(r,a,s,l)=>{if(t){o(!0);try{let n=new Image;n.src=t.src,await new Promise(e=>n.onload=e);let o=e0(n,r,a,s,l),d="data:image/"+l+";base64,",c=Math.round((o.length-d.length)*3/4),g={src:o,file:t.file,width:r,height:a,size:c,compressionRatio:0,tempAction:"Resize",tempDetails:"".concat(r,"x").concat(a,", Q").concat(s,", ").concat(l)};e&&(g.compressionRatio=e1(e.size,c)),i(g)}catch(e){A.error("Resize failed",e)}finally{o(!1)}}},[t,e]),j=(0,s.useCallback)(()=>{t&&c(!0)},[t]),v=(0,s.useCallback)(async(r,a)=>{if(t){o(!0);try{let s=new Image;s.src=t.src,await new Promise(e=>s.onload=e);let l=((e,r,t,a)=>{let s=document.createElement("canvas"),l=s.getContext("2d");if(!l)throw Error("Could not get canvas context");return s.width=r.width,s.height=r.height,l.drawImage(e,r.x,r.y,r.width,r.height,0,0,r.width,r.height),s.toDataURL("image/".concat(a),t/100)})(s,r,100,"jpeg"),n=r.width,o=r.height;if(a){let e=new Image;e.src=l,await new Promise(r=>e.onload=r),l=e0(e,a.width,a.height,95,"jpeg"),n=a.width,o=a.height}let d=Math.round((l.length-23)*3/4),g={src:l,file:t.file,width:n,height:o,size:d,compressionRatio:0,tempAction:a?"Crop & Resize":"Crop",tempDetails:"".concat(n,"x").concat(o)};e&&(g.compressionRatio=e1(e.size,d)),i(g),c(!1)}catch(e){A.error("Crop/Resize failed",e)}finally{o(!1)}}},[t,e]),w=(0,s.useCallback)(()=>{if(!l)return;let e={...l};a(e),p(e.tempAction||"Edit",e.tempDetails||"",e),i(null)},[l,p]),N=(0,s.useCallback)(()=>{i(null)},[]),k=(0,s.useCallback)(()=>{c(!1)},[]),C=(0,s.useCallback)(()=>{let e=l||t;if(!e)return;let r=document.createElement("a");r.href=e.src,r.download="processed-".concat(Date.now(),".jpg"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},[l,t]),S=(0,s.useCallback)(e=>{let r=x[e];r&&(a(r.imageData),i(null),h([]))},[x]),E=(0,s.useCallback)(()=>{if(x.length>0&&t){let r=x.slice(1);h(e=>[t,...e]),u(r),r.length>0?a(r[0].imageData):e&&a(e)}},[x,t,e]),P=(0,s.useCallback)(()=>{if(m.length>0&&t){let e=m[0],r=m.slice(1),t={id:crypto.randomUUID(),action:"Redo",details:"R\xe9tablissement de l'action",thumbnail:e.src,timestamp:new Date,imageData:e};u(e=>[t,...e]),h(r),a(e)}},[m,t]),R=(0,s.useCallback)(()=>{r(null),a(null),i(null),u([]),h([]),c(!1)},[]);return{originalImage:e,currentImage:t,processedImage:l,isProcessing:n,cropData:g,isCropping:d,history:x,loadImage:b,loadImageFromUrl:f,resizeImageAction:y,enableCrop:j,applyCrop:v,commitProcessedImage:w,cancelProcessedImage:N,cancelCrop:k,downloadImage:C,loadFromHistory:S,undo:E,redo:P,canUndo:x.length>0,canRedo:m.length>0,setIsProcessing:o,reset:R}})(),{slideshowImages:x,loading:u,publishing:m,hasUnpublishedChanges:h,toast:p,setToast:b,loadSlideshowImages:f,addImage:v,removeImage:w,reorderImages:N,publish:k}=function(e){let r=(0,rA.useRouter)(),[t,a]=(0,s.useState)([]),[l,i]=(0,s.useState)(!1),[n,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[g,x]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),b=(0,s.useCallback)(async r=>{if(!e)return void a([]);i(!0);try{let t=await rE(e,!1);if(r&&r())return;if(t.success&&t.images){let e=t.images;a(e);let r=e.some(e=>!e.isPublished);m(r)}else t.error&&(A.error("[useSlideshow] Error result:",t.error),p({message:t.error||"Erreur lors du chargement du slideshow",type:"error"}))}catch(e){if(r&&r())return;A.error("[useSlideshow] Error loading slideshow:",e),p({message:"Erreur technique lors du chargement",type:"error"})}finally{r&&r()||i(!1)}},[e]);(0,s.useEffect)(()=>{let e=!1;return a([]),b(()=>e),()=>{e=!0}},[e,b]);let f=async(t,a,s)=>{if(!e)return!1;i(!0);try{let t=await (0,rP.o)(e,s);if(t.success)return m(!0),await b(),r.refresh(),!0;return p({message:t.error||"Erreur lors de l'ajout",type:"error"}),!1}catch(e){return A.error("[useSlideshow] Error adding image:",e),p({message:"Erreur lors de l'ajout de l'image",type:"error"}),!1}finally{i(!1)}},y=async e=>{x(e);try{let r=await rR(e);if(r.success)return a(r=>{let t=r.filter(r=>r.id!==e),a=t.some(e=>!e.isPublished);return m(a),t}),!0;return p({message:r.error||"Erreur lors de la suppression",type:"error"}),!1}catch(e){return A.error("[useSlideshow] Error removing image:",e),p({message:"Erreur lors de la suppression",type:"error"}),!1}finally{x(null)}},j=async(s,l)=>{if(!e)return;let i=(0,ry.be)(t,s,l);a(i),m(!0),o(!0);try{let t=i.map(e=>e.id),a=await rL(e,t);a.success?r.refresh():(p({message:a.error||"Erreur sauvegarde ordre",type:"error"}),await b())}catch(e){A.error("[useSlideshow] Error saving order:",e),p({message:"Erreur lors de la sauvegarde de l'ordre",type:"error"})}finally{o(!1)}},v=async()=>{if(e){c(!0);try{let t=await rD(e);t.success?(p({message:"Slideshow publi\xe9 avec succ\xe8s !",type:"success"}),m(!1),a(e=>e.map(e=>({...e,isPublished:!0}))),r.refresh()):p({message:t.error||"Erreur publication",type:"error"})}catch(e){A.error("[useSlideshow] Error publishing:",e),p({message:"Erreur lors de la publication",type:"error"})}finally{c(!1)}}};return{slideshowImages:t,loading:l,saving:n,publishing:d,deletingId:g,hasUnpublishedChanges:u,toast:h,setToast:p,loadSlideshowImages:b,addImage:f,removeImage:y,reorderImages:j,publish:v}}(d),{videos:C,loading:S,publishing:E,hasUnpublishedChanges:P,toast:R,setToast:L,addVideo:D,removeVideo:T,reorderVideos:I,publish:M,unpublish:z,togglePublish:F}=function(e){let r=(0,rA.useRouter)(),[t,a]=(0,s.useState)([]),[l,i]=(0,s.useState)(!1),[n,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[g,x]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),b=(0,s.useCallback)(async r=>{if(!e)return void a([]);A.debug("[useSlideshowVideo] Loading videos for project:",e),i(!0);try{let t=await rT(e);if(A.debug("[useSlideshowVideo] result for project:",e,t),r&&r())return;if(t.success&&t.videos){let e=t.videos;a(e);let r=e.some(e=>!e.isPublished);m(r)}else t.error&&(A.error("[useSlideshowVideo] Server Action Error:",t.error),p({message:"Erreur serveur: ".concat(t.error),type:"error"}))}catch(t){if(r&&r())return;A.error("[useSlideshowVideo] Technical Error Details:",t);let e=(null==t?void 0:t.message)||("string"==typeof t?t:"Inconnue");p({message:"Erreur technique lors du chargement des vid\xe9os: ".concat(e),type:"error"})}finally{r&&r()||i(!1)}},[e]);(0,s.useEffect)(()=>{let e=!1;return a([]),b(()=>e),()=>{e=!0}},[e,b]);let f=async(t,a)=>{if(!e)return!1;i(!0);try{let s=await rI(e,t,a);if(s.success&&s.video)return m(!0),await b(),r.refresh(),!0;return p({message:s.error||"Erreur lors de l'ajout de la vid\xe9o",type:"error"}),!1}catch(e){return A.error("[useSlideshowVideo] Error adding video:",e),p({message:"Erreur technique lors de l'ajout",type:"error"}),!1}finally{i(!1)}},y=async e=>{x(e);try{let r=await rM(e);if(r.success)return a(r=>{let t=r.filter(r=>r.id!==e),a=t.some(e=>!e.isPublished);return m(a),t}),!0;return p({message:r.error||"Erreur lors de la suppression",type:"error"}),!1}catch(e){return A.error("[useSlideshowVideo] Error removing video:",e),p({message:"Erreur lors de la suppression",type:"error"}),!1}finally{x(null)}},j=async(s,l)=>{if(!e)return;let i=(0,ry.be)(t,s,l);a(i),o(!0);try{let t=i.map(e=>e.id),a=await rz(e,t);a.success?r.refresh():(p({message:a.error||"Erreur sauvegarde ordre",type:"error"}),await b())}catch(e){A.error("[useSlideshowVideo] Error saving order:",e),p({message:"Erreur lors de la sauvegarde de l'ordre",type:"error"}),await b()}finally{o(!1)}},v=async()=>{if(e){c(!0);try{let t=await rF(e);t.success?(p({message:"Vid\xe9os publi\xe9es avec succ\xe8s !",type:"success"}),m(!1),a(e=>e.map(e=>({...e,isPublished:!0}))),r.refresh()):p({message:t.error||"Erreur publication",type:"error"})}catch(e){A.error("[useSlideshowVideo] Error publishing:",e),p({message:"Erreur lors de la publication",type:"error"})}finally{c(!1)}}},w=async()=>{if(e){c(!0);try{let t=await rU(e);t.success?(p({message:"Vid\xe9os d\xe9publi\xe9es (brouillon) !",type:"success"}),m(!0),a(e=>e.map(e=>({...e,isPublished:!1}))),r.refresh()):p({message:t.error||"Erreur d\xe9publication",type:"error"})}catch(e){A.error("[useSlideshowVideo] Error unpublishing:",e),p({message:"Erreur d\xe9publication",type:"error"})}finally{c(!1)}}},N=async e=>{try{let s=await rO(e);if(s.success&&s.video){a(r=>r.map(r=>r.id===e?{...r,isPublished:s.video.isPublished}:r));let l=t.map(r=>r.id===e?{...r,isPublished:s.video.isPublished}:r);m(l.some(e=>!e.isPublished)),r.refresh()}else p({message:s.error||"Erreur modification statut",type:"error"})}catch(e){A.error("Error toggling publish:",e),p({message:"Erreur lors de la modification du statut",type:"error"})}};return{videos:t,loading:l,saving:n,publishing:d,deletingId:g,hasUnpublishedChanges:u,toast:h,setToast:p,loadVideos:b,addVideo:f,removeVideo:y,reorderVideos:j,publish:v,unpublish:w,togglePublish:N}}(d),[U,O]=(0,s.useState)(""),[V,G]=(0,s.useState)("");(0,s.useEffect)(()=>{r&&i&&o(i)},[r,i]);let B=(0,s.useCallback)(async(e,r)=>{b({message:"Chargement de l'image dans l'\xe9diteur...",type:"success"}),await g.loadImageFromUrl(e,r),o("edit")},[g,b]);(0,s.useEffect)(()=>{R&&(b(R),L(null))},[R,b,L]);let W=(0,s.useMemo)(()=>Array.from(new Set(l.map(e=>e.country).filter(Boolean).filter(e=>"Syst\xe8me"!==e))).sort(),[l]),_=(0,s.useMemo)(()=>l.filter(e=>{if("Syst\xe8me"===e.country)return!1;let r=e.name.toLowerCase().includes(U.toLowerCase()),t=!V||e.country===V;return r&&t}),[l,U,V]),H=l.find(e=>e.id===d);return r?(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center p-4 lg:p-8",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:t}),(0,a.jsxs)("div",{className:"relative w-full h-full lg:h-[90vh] lg:max-w-6xl bg-white dark:bg-gray-900 lg:rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 border border-gray-200 dark:border-gray-800",children:[(0,a.jsxs)("div",{className:"px-4 lg:px-6 py-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between bg-white dark:bg-gray-900 sticky top-0 z-10 shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-xl",children:(0,a.jsx)(j.A,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg lg:text-xl font-bold text-gray-900 dark:text-white",children:"Gestion M\xe9dia"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:block",children:"Configurez le diaporama et les vid\xe9os par projet"})]})]}),(0,a.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl transition-colors",children:(0,a.jsx)(y.A,{className:"w-5 h-5 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"flex-grow flex overflow-hidden relative",children:[(0,a.jsxs)("div",{className:"\n                        w-full lg:w-80 border-r border-gray-100 dark:border-gray-800 flex flex-col bg-gray-50/30 dark:bg-gray-900/30 shrink-0 transition-all duration-300 absolute inset-0 z-20 lg:static lg:z-auto\n                        ".concat(d?"translate-x-full lg:translate-x-0 opacity-0 lg:opacity-100 pointer-events-none lg:pointer-events-auto":"translate-x-0 opacity-100","\n                    "),children:[(0,a.jsx)("div",{className:"p-4 space-y-4 border-b border-gray-100 dark:border-gray-800",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(q.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Chercher un projet...",value:U,onChange:e=>O(e.target.value),className:"w-full h-10 pl-9 pr-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-indigo-500 transition-all"})]}),(0,a.jsxs)("select",{value:V,onChange:e=>G(e.target.value),className:"w-full h-10 px-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-indigo-500 transition-all appearance-none",children:[(0,a.jsx)("option",{value:"",children:"Tous les pays"}),W.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})}),(0,a.jsxs)("div",{className:"flex-grow overflow-y-auto p-2 space-y-1",children:[_.map(e=>(0,a.jsxs)("button",{onClick:()=>c(e.id),className:"w-full text-left p-3 rounded-xl transition-all flex items-center justify-between group ".concat(d===e.id?"bg-indigo-600 shadow-lg shadow-indigo-200 dark:shadow-none text-white":"hover:bg-white dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300"),children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-bold truncate",children:e.name}),(0,a.jsx)("p",{className:"text-[10px] uppercase tracking-wider ".concat(d===e.id?"text-indigo-100":"text-gray-400"),children:e.country||"International"})]}),(0,a.jsx)(eQ.A,{className:"w-4 h-4 transition-transform ".concat(d===e.id?"translate-x-0":"-translate-x-4 opacity-0 group-hover:translate-x-0 group-hover:opacity-100")})]},e.id)),0===_.length&&(0,a.jsx)("div",{className:"py-8 text-center px-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Aucun projet trouv\xe9"})})]})]}),(0,a.jsx)("div",{className:"flex-grow flex flex-col overflow-hidden bg-white dark:bg-gray-900 w-full",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"px-4 lg:px-6 py-3 border-b border-gray-100 dark:border-gray-800 flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 shrink-0",children:[(0,a.jsxs)("div",{className:"flex flex-col w-full lg:w-auto",children:[(0,a.jsxs)("button",{onClick:()=>c(null),className:"lg:hidden flex items-center gap-1 text-[10px] font-bold text-gray-400 hover:text-gray-600 mb-2 uppercase tracking-wider",children:[(0,a.jsx)(eQ.A,{className:"w-3 h-3 rotate-180"}),"Retour aux projets"]}),(0,a.jsx)("span",{className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-widest leading-none mb-1",children:"PROJET S\xc9LECTIONN\xc9"}),(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white truncate max-w-md",children:null==H?void 0:H.name})]}),(0,a.jsxs)("div",{className:"flex w-full lg:w-auto p-1 bg-gray-100 dark:bg-gray-800 rounded-xl overflow-x-auto no-scrollbar",children:[(0,a.jsxs)("button",{onClick:()=>o("photos"),className:"flex-1 lg:flex-none flex items-center justify-center gap-2 px-4 py-1.5 rounded-lg text-xs font-bold transition-all whitespace-nowrap ".concat("photos"===n?"bg-white dark:bg-gray-700 shadow-sm text-indigo-600 dark:text-indigo-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[(0,a.jsx)(j.A,{className:"w-4 h-4 shrink-0"}),"PHOTOS"]}),(0,a.jsxs)("button",{onClick:()=>o("videos"),className:"flex-1 lg:flex-none flex items-center justify-center gap-2 px-4 py-1.5 rounded-lg text-xs font-bold transition-all whitespace-nowrap ".concat("videos"===n?"bg-white dark:bg-gray-700 shadow-sm text-indigo-600 dark:text-indigo-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[(0,a.jsx)(ex.A,{className:"w-4 h-4 shrink-0"}),"VID\xc9OS"]}),(0,a.jsxs)("button",{onClick:()=>o("edit"),className:"flex-1 lg:flex-none flex items-center justify-center gap-2 px-4 py-1.5 rounded-lg text-xs font-bold transition-all whitespace-nowrap ".concat("edit"===n?"bg-white dark:bg-gray-700 shadow-sm text-indigo-600 dark:text-indigo-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[(0,a.jsx)(eJ.A,{className:"w-4 h-4 shrink-0"}),"OUTILS"]})]})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto p-4 lg:p-6",children:"photos"===n?(0,a.jsx)(rH,{images:x,loading:u,publishing:m,hasChanges:h,onPublish:k,onRemove:w,onReorder:N,onAdd:()=>{},addImage:v,projectName:null==H?void 0:H.name,onRetouch:B}):"videos"===n?(0,a.jsx)(r$,{videos:C,loading:S,publishing:E,hasChanges:P,onPublish:M,onUnpublish:z,onRemove:T,onReorder:I,onAdd:D,onTogglePublish:F,setToast:b,projectId:d}):(0,a.jsx)(rK,{processor:g,projectId:d,onSuccess:()=>{f(),o("photos")}})})]}):(0,a.jsxs)("div",{className:"flex-grow hidden lg:flex flex-col items-center justify-center text-gray-400 p-8 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gray-50 dark:bg-gray-800/50 rounded-full flex items-center justify-center mb-6 animate-pulse",children:(0,a.jsx)($.A,{className:"w-10 h-10 opacity-20"})}),(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:"S\xe9lectionnez un projet"}),(0,a.jsx)("p",{className:"text-sm max-w-xs",children:"Choisissez un projet dans la liste de gauche pour g\xe9rer ses m\xe9dias."})]})})]})]}),p&&(0,a.jsx)(ez,{message:p.message,type:p.type,onClose:()=>b(null)})]}):null}function rH(e){let{images:r,loading:t,publishing:l,hasChanges:i,onPublish:n,onRemove:o,onReorder:d,addImage:c,projectName:g,onRetouch:x}=e,[u,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),[b,f]=(0,s.useState)(null),y=(0,rf.FR)((0,rf.MS)(rf.AN,{activationConstraint:{distance:5}}),(0,rf.MS)(rf.uN,{coordinateGetter:ry.JR}));return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-wider",children:["DIAPORAMA (",r.length,")"]}),i&&(0,a.jsxs)("span",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-amber-50 dark:bg-amber-900/20 text-[10px] font-bold text-amber-600 dark:text-amber-400 rounded-full border border-amber-100 dark:border-amber-800/30",children:[(0,a.jsx)("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse"}),"CHANGEMENTS NON PUBLI\xc9S"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(eg.$,{size:"sm",variant:"outline",onClick:()=>p(!0),disabled:0===r.length,className:"text-[10px] font-bold tracking-widest uppercase h-9 px-4",children:[(0,a.jsx)(eA.A,{className:"w-3.5 h-3.5 mr-2"}),"TESTER"]}),(0,a.jsxs)(eg.$,{size:"sm",variant:"outline",onClick:()=>m(!0),className:"text-[10px] font-bold tracking-widest uppercase h-9 px-4 border-dashed",children:[(0,a.jsx)(V.A,{className:"w-3.5 h-3.5 mr-2"}),"AJOUTER"]}),(0,a.jsxs)(eg.$,{size:"sm",disabled:!i||l||0===r.length,onClick:n,className:"text-[10px] font-bold tracking-widest uppercase h-9 px-4 bg-indigo-600 hover:bg-indigo-700 text-white",children:[l?(0,a.jsx)(C.A,{className:"w-3.5 h-3.5 animate-spin mr-2"}):(0,a.jsx)(eX.A,{className:"w-3.5 h-3.5 mr-2"}),"PUBLIER"]})]})]}),t?(0,a.jsxs)("div",{className:"py-20 flex flex-col items-center justify-center text-gray-400",children:[(0,a.jsx)(C.A,{className:"w-10 h-10 animate-spin mb-4 text-indigo-500"}),(0,a.jsx)("p",{className:"text-sm",children:"Chargement des photos..."})]}):0===r.length?(0,a.jsxs)("div",{className:"py-20 border-2 border-dashed border-gray-100 dark:border-gray-800 rounded-3xl flex flex-col items-center justify-center text-gray-400 bg-gray-50/50 dark:bg-gray-900/50",children:[(0,a.jsx)(j.A,{className:"w-12 h-12 mb-4 opacity-10"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:"Aucune photo dans le diaporama"}),(0,a.jsx)("button",{onClick:()=>m(!0),className:"mt-4 text-xs font-bold text-indigo-600 hover:underline",children:"Ajouter la premi\xe8re photo"})]}):(0,a.jsxs)(rf.Mp,{sensors:y,collisionDetection:rf.fp,onDragStart:e=>{f(e.active.id)},onDragEnd:e=>{let{active:t,over:a}=e;f(null),a&&t.id!==a.id&&d(r.findIndex(e=>e.id===t.id),r.findIndex(e=>e.id===a.id))},children:[(0,a.jsx)(ry.gB,{items:r.map(e=>e.id),strategy:ry._G,children:(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,a.jsx)(rk,{id:e.id,image:e.image,isPublished:e.isPublished,onRemove:()=>o(e.id),onEdit:()=>x(e.image.url,e.image.alt||"photo.jpg")},e.id))})}),(0,a.jsx)(rf.Hd,{children:b?(0,a.jsx)("div",{className:"scale-[1.02] shadow-2xl opacity-90 ring-2 ring-indigo-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl overflow-hidden",children:(0,a.jsx)(rk,{id:b,image:r.find(e=>e.id===b).image,isPublished:r.find(e=>e.id===b).isPublished,onRemove:()=>{}})}):null})]}),(0,a.jsx)(eI,{isOpen:u,onClose:()=>m(!1),onSelect:async(e,r,t)=>{await c(e,r,t),m(!1)}}),(0,a.jsx)(rS,{isOpen:h,onClose:()=>p(!1),images:r,projectName:g})]})}function rK(e){var r,l,i;let{processor:n,projectId:o,onSuccess:d}=e,[c,g]=(0,s.useState)(!1),[x,u]=(0,s.useState)(!1),m=E("EditTab"),h=(0,s.useCallback)(async()=>{if(n.currentImage&&o){g(!0);try{var e,r;let a=await fetch(n.currentImage.src);if(!a.ok)throw Error("Failed to fetch image data");let s=await a.blob(),l=n.currentImage.src.split(";")[0].split("/")[1]||"png",i=(null==(r=n.originalImage)||null==(e=r.file)?void 0:e.name.replace(/\.[^/.]+$/,""))||"edit_".concat(Date.now()),c="mod_".concat(i,".").concat(l),g=new File([s],c,{type:s.type}),x=new FormData;x.append("file",g),x.append("projectId",o);let u=await fetch("/api/files/upload",{method:"POST",body:x}),m=await u.json();if(m.success&&m.files&&m.files.length>0){let{addImageToSlideshow:e}=await t.e(7659).then(t.bind(t,17659)),r=await e(o,m.files[0].id);if(r.success)d();else throw Error(r.error||"Erreur lors de l'ajout au diaporama")}else throw Error(m.error||"Erreur lors du t\xe9l\xe9versement")}catch(e){m.error("Save error:",e),alert(e instanceof Error?e.message:"Une erreur est survenue")}finally{g(!1)}}},[n.currentImage,n.originalImage,o,d,m]);return((0,s.useEffect)(()=>(window.dispatchUploadEvent=h,()=>{window.dispatchUploadEvent=void 0}),[h]),n.originalImage)?(0,a.jsxs)("div",{className:"space-y-6 relative h-full flex flex-col",children:[n.processedImage&&(0,a.jsxs)("div",{className:"flex items-center justify-between bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-100 dark:border-indigo-800 p-3 rounded-2xl animate-in fade-in slide-in-from-top-2",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start px-2",children:[(0,a.jsx)("span",{className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-wider",children:"Aper\xe7u des modifications"}),(0,a.jsxs)("span",{className:"text-xs font-bold text-gray-700 dark:text-gray-300",children:[n.processedImage.tempAction," : ",n.processedImage.tempDetails]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eg.$,{variant:"ghost",size:"sm",onClick:n.cancelProcessedImage,className:"text-xs font-bold uppercase tracking-wider",children:"Annuler"}),(0,a.jsx)(eg.$,{size:"sm",onClick:n.commitProcessedImage,className:"bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold uppercase tracking-wider",children:"Valider"})]})]}),c&&(0,a.jsx)("div",{className:"absolute inset-0 z-50 bg-white/50 backdrop-blur-sm flex items-center justify-center rounded-3xl",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(C.A,{className:"w-10 h-10 animate-spin text-indigo-600"}),(0,a.jsx)("p",{className:"font-bold text-gray-900",children:"Enregistrement..."})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow ",children:[(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,a.jsx)(rg,{originalDimensions:n.currentImage?{width:n.currentImage.width,height:n.currentImage.height}:null,onResize:n.resizeImageAction,onCrop:n.enableCrop,onDownload:n.downloadImage,onUndo:n.undo,onRedo:n.redo,canUndo:n.canUndo,canRedo:n.canRedo,isProcessing:n.isProcessing}),(0,a.jsxs)("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/10 rounded-2xl border border-amber-100 dark:border-amber-900/30",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)(eZ.A,{className:"w-4 h-4 text-amber-500"}),(0,a.jsx)("span",{className:"text-xs font-bold text-amber-900 dark:text-amber-300 uppercase tracking-widest",children:"MODE \xc9DITION"})]}),(0,a.jsx)("p",{className:"text-[10px] text-amber-700 dark:text-amber-400 leading-relaxed font-medium",children:'Vous travaillez sur une copie. Cliquez sur "Sur la Base" pour enregistrer et ajouter l\'image au diaporama.'})]}),(0,a.jsx)(eg.$,{variant:"ghost",onClick:n.reset,className:"w-full text-xs font-bold uppercase tracking-widest text-gray-500 hover:text-red-500 hover:bg-red-50",children:"Abandonner l'\xe9dition"})]}),(0,a.jsxs)("div",{className:"lg:col-span-2 flex flex-col h-full bg-gray-50/50 dark:bg-gray-900/50 rounded-3xl border border-gray-100 dark:border-gray-800/50 overflow-hidden min-h-[500px]",children:[(0,a.jsx)("div",{className:"flex-grow p-4 lg:p-8 flex items-center justify-center",children:n.processedImage?(0,a.jsx)(rb,{original:n.originalImage,processed:n.processedImage}):n.currentImage&&(0,a.jsx)(rp,{imageSrc:n.currentImage.src,title:"R\xe9sultat actuel",size:n.currentImage.size,dimensions:{width:n.currentImage.width,height:n.currentImage.height},filename:n.originalImage.file.name})}),(0,a.jsxs)("div",{className:"px-6 py-4 bg-white/50 dark:bg-gray-800/50 border-t border-gray-100 dark:border-gray-800 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(eY.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest",children:"Aper\xe7u temps r\xe9el"})]}),(0,a.jsxs)("div",{className:"text-[10px] font-mono text-gray-400",children:[null==(r=n.currentImage)?void 0:r.width,"x",null==(l=n.currentImage)?void 0:l.height," • ",Math.round(((null==(i=n.currentImage)?void 0:i.size)||0)/1024)," KB"]})]})]})]}),n.isCropping&&n.currentImage&&(0,a.jsx)("div",{className:"absolute inset-0 z-[120] bg-black/80 backdrop-blur-sm rounded-3xl overflow-hidden animate-in fade-in duration-300",children:(0,a.jsx)(rm,{imageSrc:n.currentImage.src,onApply:n.applyCrop,onCancel:n.cancelCrop})}),(0,a.jsx)(eI,{isOpen:x,onClose:()=>u(!1),onSelect:e=>{n.loadImageFromUrl(e,e.split("/").pop()||"image.jpg"),u(!1)}})]}):(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center py-12",children:[(0,a.jsx)(e2,{onImageLoad:n.loadImage,isLoading:n.isProcessing}),(0,a.jsx)("div",{className:"mt-8 flex gap-4",children:(0,a.jsxs)(eg.$,{variant:"outline",onClick:()=>u(!0),className:"text-xs font-bold uppercase tracking-widest px-6 h-11 border-dashed",children:[(0,a.jsx)(j.A,{className:"w-4 h-4 mr-2"}),"BIBLIOTH\xc8QUE (R2)"]})}),(0,a.jsx)(eI,{isOpen:x,onClose:()=>u(!1),onSelect:e=>{n.loadImageFromUrl(e,e.split("/").pop()||"image.jpg"),u(!1)}})]})}var rQ=t(17910),rJ=t(50069),rX=t(91169),rZ=t(70532),rY=t(39926),r0=t(21190),r1=t(26851);let r2=["#ef4444","#f97316","#f59e0b","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899"];function r5(e){let{isAdmin:r,isOpen:t,onClose:l}=e,[i,n]=(0,s.useState)([]),[o,d]=(0,s.useState)(!1),[g,x]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),[b,f]=(0,s.useState)({username:"",name:"",password:"",role:c.UserRole.USER,color:"#6366f1"}),j=E("SettingsDialogs"),v=(0,s.useCallback)(async()=>{if(r)try{d(!0);let e=await fetch("/api/users");if(e.ok){let r=await e.json();n(r)}}catch(e){j.error("Erreur lors du chargement des utilisateurs:",e)}finally{d(!1)}},[r,j]);(0,s.useEffect)(()=>{t&&v()},[t,v]);let w=async e=>{e.preventDefault();try{let e=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(e.ok)await v(),m(!1),f({username:"",name:"",password:"",role:c.UserRole.USER,color:"#6366f1"}),p(!1);else{let r=await e.json();alert(r.error||"Erreur lors de la cr\xe9ation")}}catch(e){j.error("Erreur creation utilisateur:",e),alert("Erreur lors de la cr\xe9ation de l'utilisateur")}},N=async e=>{if(e.preventDefault(),g)try{let e=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:g.id,...b})});if(e.ok)await v(),x(null),f({username:"",name:"",password:"",role:c.UserRole.USER,color:"#6366f1"}),p(!1);else{let r=await e.json();alert(r.error||"Erreur lors de la mise \xe0 jour")}}catch(e){j.error("Erreur mise \xe0 jour utilisateur:",e),alert("Erreur lors de la mise \xe0 jour de l'utilisateur")}},k=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer cet utilisateur ?"))try{let r=await fetch("/api/users?id=".concat(e),{method:"DELETE"});if(r.ok)await v();else{let e=await r.json();alert(e.error||"Erreur lors de la suppression")}}catch(e){j.error("Erreur suppression utilisateur:",e),alert("Erreur lors de la suppression de l'utilisateur")}};return(0,a.jsx)(a.Fragment,{children:t&&r&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[1050] flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onClick:l}),(0,a.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl flex flex-col border border-gray-100 dark:border-gray-700 overflow-hidden animate-in zoom-in-95 duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(u||g)&&(0,a.jsx)("button",{onClick:()=>{m(!1),x(null)},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",title:"Retour \xe0 la liste",children:(0,a.jsx)(ej.A,{className:"w-5 h-5 text-gray-500"})}),(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[(0,a.jsx)(rX.A,{className:"w-5 h-5"}),u?"Cr\xe9er un utilisateur":g?"Modifier ".concat(g.username):"Gestion des utilisateurs"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[!u&&!g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>{m(!0),x(null),f({username:"",name:"",password:"",role:c.UserRole.USER,color:"#6366f1"}),p(!1)},className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors shadow-sm",children:[(0,a.jsx)(V.A,{className:"w-4 h-4"}),"Ajouter un utilisateur"]}),(0,a.jsxs)("a",{href:"/export-db?password=export2026",className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-indigo-600 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800 rounded-lg hover:bg-indigo-100 dark:hover:bg-indigo-900/40 transition-colors shadow-sm",children:[(0,a.jsx)(rc.A,{className:"w-4 h-4"}),"Exporter la base"]})]}),(0,a.jsx)("button",{onClick:()=>{m(!1),x(null),l()},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-1",children:(0,a.jsx)(y.A,{className:"w-5 h-5"})})]})]}),(0,a.jsx)("div",{className:"flex-1 p-4 md:p-6",children:u||g?(0,a.jsxs)("form",{id:"user-mgmt-form",onSubmit:g?N:w,className:"max-w-4xl mx-auto pb-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_200px] gap-8 lg:gap-12",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6 bg-indigo-50/50 dark:bg-indigo-900/10 p-4 rounded-2xl border border-indigo-100/50 dark:border-indigo-900/30",children:[(0,a.jsx)(r1.A,{username:b.username,name:b.name,color:b.color,role:b.role,size:"lg"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base font-bold text-gray-900 dark:text-white",children:g?"Modifier l'utilisateur":"Nouveau membre"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Aper\xe7u de l'Avatar"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-1.5 ml-1",children:"Nom de connexion *"}),(0,a.jsx)("input",{type:"text",value:b.username,onChange:e=>f({...b,username:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-white transition-all shadow-sm",required:!0,placeholder:"ex: admin"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-1.5 ml-1",children:"Nom complet"}),(0,a.jsx)("input",{type:"text",value:b.name,onChange:e=>f({...b,name:e.target.value}),className:"w-full px-4 py-2.5 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-white transition-all shadow-sm",placeholder:"Nom affich\xe9"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-1.5 ml-1",children:["Mot de passe ",g&&"(laisser vide pour conserver)"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:h?"text":"password",value:b.password,onChange:e=>f({...b,password:e.target.value}),className:"w-full px-4 py-2.5 pr-12 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-white transition-all shadow-sm",required:!g,placeholder:"••••••"}),(0,a.jsx)("button",{type:"button",onClick:()=>p(!h),className:"absolute inset-y-0 right-0 flex items-center px-4 text-gray-400 hover:text-indigo-500 transition-colors",children:h?(0,a.jsx)(rZ.A,{className:"w-5 h-5"}):(0,a.jsx)(eA.A,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-1.5 ml-1",children:"Fonction / R\xf4le"}),(0,a.jsxs)("select",{value:b.role,onChange:e=>f({...b,role:e.target.value}),disabled:(null==g?void 0:g.username)==="admin",className:"w-full px-4 py-2.5 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-white transition-all shadow-sm appearance-none cursor-pointer ".concat((null==g?void 0:g.username)==="admin"?"opacity-50 cursor-not-allowed":""),children:[(0,a.jsx)("option",{value:"ADMIN",children:"Administrateur"}),(0,a.jsx)("option",{value:"USER",children:"Utilisateur"}),(0,a.jsx)("option",{value:"VISITOR",children:"Visiteur"})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50/50 dark:bg-gray-900/30 p-4 rounded-3xl border border-gray-100 dark:border-gray-700/50 h-fit w-[160px] mx-auto md:ml-auto md:mr-0",children:[(0,a.jsxs)("label",{className:"block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3 ml-1 flex items-center gap-2",children:[(0,a.jsx)(rY.A,{className:"w-3.5 h-3.5 text-indigo-500"}),"Teinte de l'Avatar"]}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2 w-fit",children:r2.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>f({...b,color:e}),className:"w-7 h-7 rounded-lg transition-all hover:scale-110 active:scale-95 shadow-sm ".concat(b.color===e?"ring-2 ring-white dark:ring-gray-800 shadow-md scale-110 z-10":""),style:{backgroundColor:e},title:e},e))}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("label",{className:"block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1",children:"Couleur personnalis\xe9e"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-white dark:bg-gray-800 p-1.5 rounded-xl border border-gray-100 dark:border-gray-700 shadow-inner w-fit pr-4",children:[(0,a.jsx)("input",{type:"color",value:b.color,onChange:e=>f({...b,color:e.target.value}),className:"w-8 h-8 rounded-lg cursor-pointer border-0 p-0 overflow-hidden"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-xs font-mono font-bold text-gray-900 dark:text-white uppercase tracking-wider leading-none mb-0.5",children:b.color}),(0,a.jsx)("span",{className:"text-[9px] text-gray-500 uppercase font-semibold leading-none",children:"Code Hex"})]})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-100 dark:border-gray-700 flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{m(!1),x(null),p(!1)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 transition-all",children:"Retour \xe0 la liste"}),(0,a.jsxs)("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2 text-sm font-bold text-white bg-indigo-600 rounded-xl hover:bg-indigo-700 shadow-lg shadow-indigo-200 dark:shadow-none transition-all hover:scale-[1.02] active:scale-95",children:[(0,a.jsx)(J.A,{className:"w-4 h-4"}),g?"Enregistrer les modifications":"Cr\xe9er le compte"]})]})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-900 sticky top-0 z-10",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 lg:px-4 py-3 text-left text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Avatar"}),(0,a.jsx)("th",{className:"px-3 lg:px-4 py-3 text-left text-xs font-bold text-gray-400 uppercase tracking-widest",children:"ID"}),(0,a.jsx)("th",{className:"hidden sm:table-cell px-4 py-3 text-left text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Nom complet"}),(0,a.jsx)("th",{className:"hidden md:table-cell px-4 py-3 text-left text-xs font-bold text-gray-400 uppercase tracking-widest",children:"R\xf4le"}),(0,a.jsx)("th",{className:"px-3 lg:px-4 py-3 text-right text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:o?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"Chargement..."})}):i.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,a.jsx)("td",{className:"px-3 lg:px-4 py-3",children:(0,a.jsx)(r1.A,{username:e.username,name:e.name,color:e.color,role:e.role,size:"md"})}),(0,a.jsx)("td",{className:"px-3 lg:px-4 py-3 text-sm font-semibold text-gray-900 dark:text-white",children:e.username}),(0,a.jsx)("td",{className:"hidden sm:table-cell px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:e.name||"-"}),(0,a.jsx)("td",{className:"hidden md:table-cell px-4 py-3 text-sm",children:(0,a.jsxs)("span",{className:"flex items-center gap-1.5 text-gray-700 dark:text-gray-300 font-medium",children:[(e=>{switch(e){case"ADMIN":return(0,a.jsx)(rQ.A,{className:"w-4 h-4"});case"USER":default:return(0,a.jsx)(rJ.A,{className:"w-4 h-4"});case"VISITOR":return(0,a.jsx)(eA.A,{className:"w-4 h-4"})}})(e.role),(e=>{switch(e){case"ADMIN":return"Administrateur";case"USER":return"Utilisateur";case"VISITOR":return"Visiteur";default:return e}})(e.role)]})}),(0,a.jsx)("td",{className:"px-3 lg:px-4 py-3 text-sm text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1 sm:gap-2",children:[(0,a.jsx)("button",{onClick:()=>{x(e),f({username:e.username||"",name:e.name||"",password:"",role:e.role,color:e.color||"#6366f1"}),m(!1),p(!1)},className:"p-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Modifier",children:(0,a.jsx)(r0.A,{className:"w-4 h-4"})}),"admin"!==e.username&&(0,a.jsx)("button",{onClick:()=>k(e.id),className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Supprimer",children:(0,a.jsx)(B.A,{className:"w-4 h-4"})})]})})]},e.id))})]})})})]})]})})}function r4(e){let{countries:r,availableNames:t,types:s,statuses:l,selectedCountry:i,selectedName:n,selectedTypes:o,selectedStatuses:d,searchQuery:c,setSearchQuery:g,showSuggestions:x,setShowSuggestions:u,searchSuggestions:m,focusedSuggestionIndex:h,setFocusedSuggestionIndex:p,onSearchSelect:b,handleKeyDown:f,resetFilters:y,selectedProject:j,onCountryChange:v,onNameChange:w,onToggleType:N,onToggleStatus:k}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 lg:p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 mb-8 transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4 border-b border-gray-50 dark:border-gray-700/50 pb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(q.A,{className:"w-4 h-4 text-indigo-500"}),(0,a.jsx)("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Filtres et Recherche"})]}),(0,a.jsx)("button",{onClick:y,className:"text-xs text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 dark:hover:text-indigo-300 font-bold uppercase tracking-wider transition-colors hover:underline",children:"R\xe9initialiser"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-12 gap-8 items-start",children:[(0,a.jsxs)("div",{className:"xl:col-span-5 flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("label",{htmlFor:"search",className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1",children:"Recherche rapide"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{id:"search",type:"text",value:c,onChange:e=>{g(e.target.value),u(!0),p(-1)},onFocus:()=>u(!0),onKeyDown:f,onBlur:()=>setTimeout(()=>u(!1),200),placeholder:"Rechercher un projet par nom...",className:"block w-full rounded-xl border-gray-200 dark:border-gray-700 py-3.5 pl-12 pr-4 text-sm focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 border bg-white dark:bg-gray-900 dark:text-white transition-all shadow-sm"}),(0,a.jsx)(q.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 group-focus-within:text-indigo-500 transition-colors"}),x&&m.length>0&&(0,a.jsx)("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl max-h-60 overflow-auto animate-in fade-in slide-in-from-top-2",children:m.map((e,r)=>(0,a.jsx)("button",{type:"button",onMouseMove:()=>p(r),onClick:()=>b(e),className:"w-full text-left px-4 py-3 border-b border-gray-50 dark:border-gray-700/50 last:border-0 ".concat(h===r?"bg-indigo-50 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300":"hover:bg-indigo-50 dark:hover:bg-indigo-900/30"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-semibold",children:e.name}),(0,a.jsx)("span",{className:"text-xs opacity-60 italic",children:e.country})]})},e.id))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"country",className:"block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1.5 ml-1",children:"Filtre Pays"}),(0,a.jsxs)("select",{id:"country",value:i,onChange:e=>v(e.target.value),className:"block w-full rounded-xl border-gray-200 dark:border-gray-700 py-2.5 pl-4 pr-10 text-sm focus:border-indigo-500 border bg-white dark:bg-gray-900 dark:text-white transition-all appearance-none",children:[(0,a.jsx)("option",{value:"",children:"Tous les pays"}),r.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1.5 ml-1",children:"S\xe9lection Projet"}),(0,a.jsxs)("select",{id:"name",value:n,onChange:e=>w(e.target.value),className:"block w-full rounded-xl border-gray-200 dark:border-gray-700 py-2.5 pl-4 pr-10 text-sm focus:border-indigo-500 border bg-white dark:bg-gray-900 dark:text-white transition-all appearance-none",children:[(0,a.jsx)("option",{value:"",children:"Tous les projets"}),t.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})]})]}),(0,a.jsxs)("div",{className:"xl:col-span-3 bg-gray-50/50 dark:bg-gray-900/40 p-4 rounded-xl border border-gray-100 dark:border-gray-800/50 h-full",children:[(0,a.jsx)("span",{className:"block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 ml-1",children:"Statut du Projet"}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:l.map(e=>(0,a.jsxs)("button",{onClick:()=>k(e),className:"relative flex items-center justify-between px-3 py-2.5 rounded-lg text-sm font-semibold border transition-all ".concat(d.includes(e)?"bg-indigo-600 border-indigo-500 text-white shadow-sm":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-200 dark:border-gray-700 hover:border-indigo-300"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(d.includes(e)?"bg-white":"bg-gray-300 dark:bg-gray-600")}),(0,a.jsx)("span",{children:eh(e)})]}),(null==j?void 0:j.status)===e&&(0,a.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-red-400 ring-4 ring-red-400/20"})]},e))})]}),(0,a.jsxs)("div",{className:"xl:col-span-4 bg-gray-50/50 dark:bg-gray-900/40 p-4 rounded-xl border border-gray-100 dark:border-gray-800/50 h-full",children:[(0,a.jsx)("span",{className:"block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 ml-1",children:"Type d'Ouvrage"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:s.map(e=>(0,a.jsxs)("button",{onClick:()=>N(e),className:"relative flex items-center gap-2 px-3 py-2.5 rounded-lg text-xs font-semibold border transition-all ".concat(o.includes(e)?"bg-indigo-600 border-indigo-500 text-white":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-200 dark:border-gray-700"),children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 rounded-full shrink-0 ".concat(o.includes(e)?"bg-white":"bg-gray-300 dark:bg-gray-600")}),(0,a.jsx)("span",{className:"truncate",children:e}),(null==j?void 0:j.type)===e&&(0,a.jsx)("div",{className:"absolute top-1 right-1 w-1 h-1 rounded-full bg-red-400"})]},e))})]})]})]})}var r3=t(7217),r6=t(12263),r9=t(46398),r8=t(18042);let r7=e=>e>=100?{text:"text-green-600 dark:text-green-400",bg:"bg-green-500",bgLight:"bg-green-100 dark:bg-green-900/30",border:"border-green-500/50",shadow:"shadow-green-200"}:e>50?{text:"text-yellow-600 dark:text-yellow-300",bg:"bg-yellow-500",bgLight:"bg-yellow-100 dark:bg-yellow-900/30",border:"border-yellow-500/50",shadow:"shadow-yellow-200"}:e>25?{text:"text-orange-600 dark:text-orange-400",bg:"bg-orange-500",bgLight:"bg-orange-100 dark:bg-orange-900/30",border:"border-orange-500/50",shadow:"shadow-orange-200"}:{text:"text-red-600 dark:text-red-400",bg:"bg-red-500",bgLight:"bg-red-100 dark:bg-red-900/30",border:"border-red-500/50",shadow:"shadow-red-200"};function te(e){let{selectedProject:r}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden transition-colors flex flex-col shrink-0",children:[(0,a.jsxs)("div",{className:"border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 px-4 py-3 flex items-center gap-2",children:[(0,a.jsx)(r3.A,{className:"w-4 h-4 text-purple-500"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Avancement du Projet"})]}),(0,a.jsxs)("div",{className:"p-4 lg:px-4 lg:py-6 flex flex-col md:flex-row gap-6 lg:gap-8",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-4 bg-gray-50/50 dark:bg-gray-900/50 rounded-2xl border border-gray-100 dark:border-gray-800 min-w-[140px]",children:[(0,a.jsxs)("div",{className:"relative flex items-center justify-center w-24 h-24 mb-3",children:[(0,a.jsxs)("svg",{className:"w-full h-full transform -rotate-90",children:[(0,a.jsx)("circle",{cx:"48",cy:"48",r:"40",fill:"transparent",stroke:"currentColor",strokeWidth:"6",className:"text-gray-200 dark:text-gray-700"}),(()=>{let e=Math.round((((null==r?void 0:r.prospection)||0)+((null==r?void 0:r.studies)||0)+((null==r?void 0:r.fabrication)||0)+((null==r?void 0:r.transport)||0)+((null==r?void 0:r.construction)||0))/5),t=80*Math.PI,s=r7(e);return(0,a.jsx)("circle",{cx:"48",cy:"48",r:"40",fill:"transparent",stroke:"currentColor",strokeWidth:"6",strokeDasharray:t,strokeDashoffset:t-e/100*t,strokeLinecap:"round",className:"".concat(s.text," transition-all duration-1000 ease-out")})})()]}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-xl font-black text-gray-900 dark:text-white",children:[Math.round((((null==r?void 0:r.prospection)||0)+((null==r?void 0:r.studies)||0)+((null==r?void 0:r.fabrication)||0)+((null==r?void 0:r.transport)||0)+((null==r?void 0:r.construction)||0))/5),"%"]})})]}),(0,a.jsx)("span",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest text-center",children:"Progression Globale"})]}),(0,a.jsx)("div",{className:"flex-grow flex flex-col gap-5 py-2",children:[{label:"Prospection",val:(null==r?void 0:r.prospection)||0,icon:(0,a.jsx)(q.A,{className:"w-3.5 h-3.5"})},{label:"\xc9tudes",val:(null==r?void 0:r.studies)||0,icon:(0,a.jsx)(r3.A,{className:"w-3.5 h-3.5"})},{label:"Fabrication",val:(null==r?void 0:r.fabrication)||0,icon:(0,a.jsx)(r6.A,{className:"w-3.5 h-3.5"})},{label:"Transport",val:(null==r?void 0:r.transport)||0,icon:(0,a.jsx)(r9.A,{className:"w-3.5 h-3.5"})},{label:"Montage",val:(null==r?void 0:r.construction)||0,icon:(0,a.jsx)(r8.A,{className:"w-3.5 h-3.5"})}].map((e,r,t)=>(0,a.jsxs)("div",{className:"relative last:mb-0",children:[r!==t.length-1&&(0,a.jsx)("div",{className:"absolute left-[17px] top-[24px] w-[2px] h-[34px] bg-gray-100 dark:bg-gray-700 z-0",children:(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full bg-indigo-500/30 transition-all duration-1000",style:{height:e.val>0?r<t.length-1&&t[r+1].val>0?"100%":"50%":"0%"}})}),(0,a.jsxs)("div",{className:"flex items-center gap-4 group relative z-10",children:[(0,a.jsx)("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center border transition-all duration-500 shadow-sm ".concat(e.val>0?"".concat(r7(e.val).bg," ").concat(r7(e.val).border," text-white scale-110"):"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-400"),children:e.icon}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsxs)("div",{className:"flex justify-between items-baseline mb-1",children:[(0,a.jsx)("h4",{className:"text-[11px] font-bold uppercase tracking-wider ".concat(e.val>0?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-500 text-[10px]"),children:e.label}),(0,a.jsxs)("span",{className:"text-[10px] font-mono font-bold px-2 py-0.5 rounded-full ".concat(e.val>0?"".concat(r7(e.val).bgLight," ").concat(r7(e.val).text):"bg-gray-100 dark:bg-gray-900 text-gray-500"),children:[e.val,"%"]})]}),(0,a.jsx)("div",{className:"w-full h-1.5 bg-gray-100 dark:bg-gray-700/50 rounded-full overflow-hidden border border-gray-200/50 dark:border-gray-700/30",children:(0,a.jsx)("div",{className:"h-full transition-all duration-1000 ease-out rounded-full ".concat(r7(e.val).bg),style:{width:"".concat(e.val,"%")}})})]})]})]},e.label))})]})]})}function tr(e){var r;let{selectedProject:t,flagDoc:s,logoDoc:l}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden transition-colors flex flex-col flex-grow min-h-0",children:[(0,a.jsxs)("div",{className:"border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 px-4 py-3 flex items-center justify-between shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{className:"w-4 h-4 text-indigo-500"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Description"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[s&&(0,a.jsxs)("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-white/50 dark:bg-black/20 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm shrink-0",children:[(0,a.jsx)("div",{className:"w-7 h-4.5 relative rounded-[2px] overflow-hidden border border-gray-100 dark:border-gray-800 bg-gray-100 dark:bg-gray-800",children:(0,a.jsx)(Z.default,{src:(0,rN.M)(s.url),alt:"",fill:!0,className:"object-cover"})}),(0,a.jsx)("span",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-tight hidden sm:inline-block",children:null==t?void 0:t.country})]}),l&&(0,a.jsx)("div",{className:"h-7 px-2 py-1 bg-white/50 dark:bg-black/20 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm flex items-center shrink-0 relative",children:(0,a.jsx)(Z.default,{src:(0,rN.M)(l.url),alt:"",height:20,width:60,className:"object-contain opacity-90 w-auto h-5"})})]})]}),(0,a.jsx)("div",{className:"px-3 py-4 text-sm text-gray-600 dark:text-gray-400 whitespace-pre-line overflow-y-auto custom-scrollbar",children:((r=null==t?void 0:t.description)?r.replace(/\\n/g,"\n"):"")||"S\xe9lectionnez un projet pour voir sa description."})]})}var tt=t(97624),ta=t(37354),ts=t(12932),tl=t(53511),ti=t(59e3),tn=t(62332),to=t(37565);function td(e){let{selectedProject:r,dynamicImages:t=[],videos:l=[],isLoading:i}=e,[n,o]=(0,s.useState)("photos"),[d,c]=(0,s.useState)(0),[g,x]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),b=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=(null==t?void 0:t.length)||0,r=(null==l?void 0:l.length)||0;0===e&&r>0&&!i?o("videos"):e>0&&o("photos")},[null==t?void 0:t.length,null==l?void 0:l.length,i]),(0,s.useEffect)(()=>(g&&t.length>1&&"photos"===n?b.current=setInterval(()=>{c(e=>(e+1)%t.length)},3e3):b.current&&(clearInterval(b.current),b.current=null),()=>{b.current&&clearInterval(b.current)}),[g,t.length,n]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(h?p(null):m(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h]);let f=(0,s.useCallback)(()=>c(e=>(e+1)%t.length),[t.length]),v=(0,s.useCallback)(()=>c(e=>(e-1+t.length)%t.length),[t.length]);if(!r||0===((null==t?void 0:t.length)||0)&&0===((null==l?void 0:l.length)||0)&&!i)return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden h-full min-h-[400px]",children:[(0,a.jsx)("div",{className:"border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 px-4 py-3",children:(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-tight",children:"M\xe9dia"})}),(0,a.jsxs)("div",{className:"p-4 flex flex-col items-center justify-center flex-grow h-full pt-20",children:[(0,a.jsx)("div",{className:"p-4 rounded-full bg-gray-50 dark:bg-gray-900 mb-4",children:(0,a.jsx)(j.A,{className:"w-8 h-8 text-gray-300 dark:text-gray-700"})}),(0,a.jsx)("span",{className:"text-sm text-gray-400 italic",children:"Aucun m\xe9dia disponible pour ce projet"})]})]});let w=(0,a.jsxs)("div",{className:u?"fixed inset-0 z-[1000] bg-white dark:bg-gray-950 p-4 pt-20 lg:pt-4 animate-in fade-in zoom-in-95 duration-200":"relative h-full",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden flex flex-col h-full transition-all duration-300",children:[(0,a.jsxs)("div",{className:"border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 px-4 py-2 flex items-center justify-between z-10 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)("button",{onClick:()=>o("photos"),className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-all ".concat("photos"===n?"bg-white dark:bg-gray-800 text-pink-500 shadow-sm border border-gray-100 dark:border-gray-700":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"),children:[(0,a.jsx)(j.A,{className:"w-3.5 h-3.5"}),"Photos ",t.length>0&&"(".concat(t.length,")")]}),l.length>0&&(0,a.jsxs)("button",{onClick:()=>o("videos"),className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-all ".concat("videos"===n?"bg-white dark:bg-gray-800 text-orange-500 shadow-sm border border-gray-100 dark:border-gray-700":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"),children:[(0,a.jsx)(ex.A,{className:"w-3.5 h-3.5"}),"Vid\xe9os (",l.length,")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["photos"===n&&t.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mr-2",children:[(0,a.jsxs)("span",{className:"text-[10px] font-mono text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-900 px-2 py-0.5 rounded-full border border-gray-300 dark:border-gray-700",children:[d+1," / ",t.length]}),g&&(0,a.jsx)("span",{className:"flex h-2 w-2 rounded-full bg-green-500 animate-pulse"})]}),(0,a.jsx)("button",{onClick:()=>m(!u),className:"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors text-gray-500 dark:text-gray-400",title:u?"Quitter le plein \xe9cran":"Plein \xe9cran",children:u?(0,a.jsx)(tt.A,{className:"w-5 h-5 text-red-500"}):(0,a.jsx)(ta.A,{className:"w-5 h-5 text-indigo-600"})})]})]}),(0,a.jsxs)("div",{className:"relative flex-grow flex flex-col min-h-[350px] overflow-hidden",children:[i?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-gray-900/50 backdrop-blur-sm z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"})}):null,"photos"===n?(0,a.jsxs)("div",{className:"flex flex-col h-full flex-grow",children:[(0,a.jsx)("div",{className:"flex-grow px-3 py-4 flex flex-col min-h-0",children:(0,a.jsx)("div",{className:"relative w-full h-full rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-900 group flex-grow",children:t.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.default,{src:(0,rN.M)(t[d].url),alt:t[d].name||"Photo ".concat(d+1),fill:!0,className:"object-contain transition-opacity duration-500",priority:!0}),(0,a.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between p-4 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[(0,a.jsx)("button",{onClick:v,className:"p-3 bg-white/90 dark:bg-gray-800/90 hover:bg-white dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-full shadow-lg transition-all transform hover:scale-110 active:scale-95",children:(0,a.jsx)(ej.A,{className:"w-8 h-8"})}),(0,a.jsx)("button",{onClick:f,className:"p-3 bg-white/90 dark:bg-gray-800/90 hover:bg-white dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-full shadow-lg transition-all transform hover:scale-110 active:scale-95",children:(0,a.jsx)(ev.A,{className:"w-8 h-8"})})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 italic text-sm",children:"Aucune photo"})})}),t.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"px-4 shrink-0",children:(0,a.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 h-1 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:"".concat((d+1)/t.length*100,"%")}})})}),(0,a.jsxs)("div",{className:"px-3 pb-4 pt-3 flex flex-col gap-3 shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>c(0),disabled:0===d,className:"p-2 text-gray-500 hover:text-indigo-600 disabled:opacity-30 transition-colors",children:(0,a.jsx)(ts.A,{className:"w-5 h-5 fill-current"})}),(0,a.jsx)("button",{onClick:v,className:"p-2 text-gray-500 hover:text-indigo-600 transition-colors",children:(0,a.jsx)(ej.A,{className:"w-6 h-6"})}),g?(0,a.jsx)("button",{onClick:()=>x(!1),className:"p-4 bg-amber-500 hover:bg-amber-600 text-white rounded-full shadow-lg transition-all transform hover:scale-105 active:scale-95",children:(0,a.jsx)(tl.A,{className:"w-6 h-6 fill-current"})}):(0,a.jsx)("button",{onClick:()=>x(!0),className:"p-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg transition-all transform hover:scale-105 active:scale-95",children:(0,a.jsx)(ro.A,{className:"w-6 h-6 fill-current"})}),(0,a.jsx)("button",{onClick:()=>{x(!1),c(0)},className:"p-2 text-gray-500 hover:text-red-500 transition-colors",children:(0,a.jsx)(ti.A,{className:"w-5 h-5 fill-current"})}),(0,a.jsx)("button",{onClick:f,className:"p-2 text-gray-500 hover:text-indigo-600 transition-colors",children:(0,a.jsx)(ev.A,{className:"w-6 h-6"})}),(0,a.jsx)("button",{onClick:()=>c(t.length-1),disabled:d===t.length-1,className:"p-2 text-gray-500 hover:text-indigo-600 disabled:opacity-30 transition-colors",children:(0,a.jsx)(tn.A,{className:"w-5 h-5 fill-current"})})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-[10px] uppercase tracking-wider font-bold text-gray-400 px-4",children:[(0,a.jsx)("span",{className:"bg-gray-100 dark:bg-gray-900 px-2 py-0.5 rounded border border-gray-200 dark:border-gray-700 transition-colors",children:g?"Automatique (3s)":"Manuel"}),(0,a.jsx)("span",{className:"font-mono text-gray-500 bg-gray-100 dark:bg-gray-900 px-2 py-0.5 rounded border border-gray-200 dark:border-gray-700 transition-colors max-w-[200px] truncate",children:t[d].name||"photo_".concat(d+1)})]})]})]})]}):(0,a.jsx)("div",{className:"p-4 flex flex-col flex-grow min-h-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pb-4",children:l.map(e=>(0,a.jsxs)("div",{onClick:()=>p(e),className:"flex items-center gap-3 p-3 rounded-xl bg-gray-50 dark:bg-gray-900/50 border border-gray-100 dark:border-gray-800 hover:border-orange-200 dark:hover:border-orange-900/50 hover:bg-white dark:hover:bg-gray-800 transition-all cursor-pointer group shadow-sm",children:[(0,a.jsxs)("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center flex-shrink-0 relative overflow-hidden transition-transform group-hover:scale-105",children:[(0,a.jsx)(ex.A,{className:"w-5 h-5 text-orange-500"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,a.jsx)(ro.A,{className:"w-5 h-5 text-white fill-white"})})]}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0 flex-1",children:[(0,a.jsx)("span",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 group-hover:text-orange-600 truncate",children:e.title||"Vid\xe9o Drone"}),(0,a.jsx)("span",{className:"text-[10px] text-gray-500 uppercase tracking-tight",children:"MP4 HD"})]})]},e.id))})})]})]}),h&&(0,a.jsx)("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-in fade-in duration-300",onClick:()=>p(null),children:(0,a.jsxs)("div",{className:"bg-black rounded-2xl overflow-hidden shadow-2xl max-w-5xl w-full flex flex-col animate-in zoom-in-95 duration-300",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 bg-gray-900/50 border-b border-gray-800",children:[(0,a.jsxs)("h3",{className:"text-sm font-bold text-white uppercase tracking-wider flex items-center gap-3",children:[(0,a.jsx)(ex.A,{className:"w-4 h-4 text-orange-500"}),h.title||"Lecture Vid\xe9o"]}),(0,a.jsx)("button",{onClick:()=>p(null),className:"p-2 hover:bg-white/10 rounded-full transition-colors group",children:(0,a.jsx)(y.A,{className:"w-5 h-5 text-gray-400 group-hover:text-white"})})]}),(0,a.jsx)("div",{className:"aspect-video bg-black relative",children:(0,a.jsxs)("video",{controls:!0,autoPlay:!0,className:"w-full h-full",src:(0,rN.M)(h.url),children:[(0,a.jsx)("source",{src:(0,rN.M)(h.url),type:"video/mp4"}),"Votre navigateur ne supporte pas la lecture de vid\xe9os."]})})]})})]});return u?(0,a.jsx)(to.Z,{children:w}):w}function tc(e){let{documents:r}=e;if(!r||0===r.length)return(0,a.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Aucun PDF disponible"});let t=r[0];return(0,a.jsx)("div",{className:"flex flex-col w-full",children:(0,a.jsx)("div",{className:"relative w-full h-[900px] lg:h-[1000px]",children:(0,a.jsx)("iframe",{src:t.url.startsWith("http")?"".concat(t.url,"#toolbar=1&navpanes=0&scrollbar=1"):"/".concat(t.url,"#toolbar=1&navpanes=0&scrollbar=1"),className:"w-full h-full border-0 rounded-b-xl",title:t.name})})})}var tg=t(93341),tx=t(20562),tu=t(8803);function tm(e){let{filteredProjects:r,selectedProject:t,handleProjectSelect:l,onExportClick:i,searchQuery:n,setSearchQuery:o,selectedCountry:d,onCountryChange:c}=e,[g,x]=(0,s.useState)({key:"name",direction:"asc"}),u=e=>{let r="asc";g&&g.key===e&&"asc"===g.direction&&(r="desc"),x({key:e,direction:r})},m=(0,s.useMemo)(()=>{let e=[...r];return g&&e.sort((e,r)=>{let t,a;if("statusLabel"===g.key)t=eh(e.status),a=eh(r.status);else{let s=g.key,l=e[s],i=r[s];t="string"==typeof l||"number"==typeof l||"boolean"==typeof l||null===l?l:String(l),a="string"==typeof i||"number"==typeof i||"boolean"==typeof i||null===i?i:String(i)}return null==t?1:null==a?-1:t<a?"asc"===g.direction?-1:1:t>a?"asc"===g.direction?1:-1:0}),e},[r,g]),h=e=>{let{columnKey:r}=e;return g&&g.key===r?"asc"===g.direction?(0,a.jsx)(tx.A,{className:"ml-1 w-3 h-3 text-indigo-500"}):(0,a.jsx)(tu.A,{className:"ml-1 w-3 h-3 text-indigo-500"}):(0,a.jsx)(tg.A,{className:"ml-1 w-3 h-3 opacity-30 group-hover:opacity-100 transition-opacity"})};return(0,a.jsx)("div",{className:"mt-8 flow-root",children:(0,a.jsx)("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,a.jsx)("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"shadow ring-1 ring-black ring-opacity-5 dark:ring-white dark:ring-opacity-10 sm:rounded-lg bg-white dark:bg-gray-800 overflow-hidden transition-colors",children:(0,a.jsx)("div",{className:"max-h-[500px] overflow-y-auto relative",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-300 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-900 sticky top-0 z-10 shadow-sm transition-colors",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{scope:"col",className:"py-2 pl-4 pr-3 text-left sm:pl-6 min-w-[150px]",children:[(0,a.jsxs)("button",{onClick:()=>u("name"),className:"group inline-flex items-center text-xs font-bold text-gray-400 uppercase tracking-widest hover:text-indigo-500 transition-colors",children:["Nom",(0,a.jsx)(h,{columnKey:"name"})]}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("input",{type:"text",value:n,onClick:e=>e.stopPropagation(),onChange:e=>o(e.target.value),placeholder:"Filtrer...",className:"block w-full rounded-md border-0 py-1 pl-7 pr-2 text-gray-900 dark:text-white bg-white dark:bg-gray-800 ring-1 ring-inset ring-gray-200 dark:ring-gray-700 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-xs transition-shadow shadow-sm"}),(0,a.jsx)(q.A,{className:"absolute left-2 top-1.5 w-3 h-3 text-gray-400 pointer-events-none"})]})]}),(0,a.jsxs)("th",{scope:"col",className:"px-3 py-2 text-left min-w-[120px]",children:[(0,a.jsxs)("button",{onClick:()=>u("country"),className:"group inline-flex items-center text-xs font-bold text-gray-400 uppercase tracking-widest hover:text-indigo-500 transition-colors",children:["Pays",(0,a.jsx)(h,{columnKey:"country"})]}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("input",{type:"text",value:d,onClick:e=>e.stopPropagation(),onChange:e=>c(e.target.value),placeholder:"Filtrer...",className:"block w-full rounded-md border-0 py-1 pl-7 pr-2 text-gray-900 dark:text-white bg-white dark:bg-gray-800 ring-1 ring-inset ring-gray-200 dark:ring-gray-700 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-xs transition-shadow shadow-sm"}),(0,a.jsx)(q.A,{className:"absolute left-2 top-1.5 w-3 h-3 text-gray-400 pointer-events-none"})]})]}),(0,a.jsx)("th",{scope:"col",className:"hidden sm:table-cell px-3 py-3.5 text-left",children:(0,a.jsxs)("button",{onClick:()=>u("type"),className:"group inline-flex items-center text-xs font-bold text-gray-400 uppercase tracking-widest hover:text-indigo-500 transition-colors",children:["Type",(0,a.jsx)(h,{columnKey:"type"})]})}),(0,a.jsx)("th",{scope:"col",className:"hidden md:table-cell px-3 py-3.5 text-left",children:(0,a.jsxs)("button",{onClick:()=>u("statusLabel"),className:"group inline-flex items-center text-xs font-bold text-gray-400 uppercase tracking-widest hover:text-indigo-500 transition-colors",children:["Statut",(0,a.jsx)(h,{columnKey:"statusLabel"})]})}),(0,a.jsx)("th",{scope:"col",className:"relative py-2 pl-3 pr-4 sm:pr-6 align-top",children:(0,a.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800",children:m.length>0?m.map(e=>(0,a.jsxs)("tr",{onClick:()=>l(e),className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer ".concat((null==t?void 0:t.id)===e.id?"bg-indigo-50 dark:bg-indigo-900/30 ring-2 ring-inset ring-indigo-500/20":""),children:[(0,a.jsx)("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-semibold text-gray-900 dark:text-white sm:pl-6",children:e.name}),(0,a.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400 font-medium",children:e.country}),(0,a.jsx)("td",{className:"hidden sm:table-cell whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400",children:e.type}),(0,a.jsx)("td",{className:"hidden md:table-cell whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400",children:(0,a.jsx)("span",{className:"inline-flex items-center rounded-lg px-2.5 py-1 text-[10px] font-bold uppercase tracking-wider ring-1 ring-inset ".concat("DONE"===e.status?"bg-green-50 text-green-700 ring-green-600/20 dark:bg-green-900/30 dark:text-green-400 dark:ring-green-400/20":"CURRENT"===e.status?"bg-red-50 text-red-700 ring-red-600/20 dark:bg-red-900/30 dark:text-red-400 dark:ring-red-400/20":"bg-blue-50 text-blue-700 ring-blue-600/20 dark:bg-blue-900/30 dark:text-blue-400 dark:ring-blue-400/20"),children:eh(e.status)})}),(0,a.jsx)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:(0,a.jsxs)("button",{onClick:r=>i(r,e),className:"flex items-center gap-1.5 ml-auto text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 bg-indigo-50 dark:bg-indigo-900/40 px-3 py-1.5 rounded-lg transition-colors group",title:"G\xe9n\xe9rer Rapport PDF","aria-label":"G\xe9n\xe9rer le rapport PDF du projet ".concat(e.name),children:[(0,a.jsx)(S.A,{className:"w-4 h-4 group-hover:scale-110 transition-transform","aria-hidden":"true"}),(0,a.jsx)("span",{className:"font-bold",children:"PDF"})]})})]},e.id)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"py-8 text-center text-gray-500 dark:text-gray-400 text-sm",children:"Aucun projet ne correspond \xe0 vos crit\xe8res."})})})]})})})})})})}function th(e){var r;let{initialProjects:t,user:l}=e,g=t.find(e=>"Sierra-L\xe9one"===e.country&&"Sewa"===e.name)||t.find(e=>"Sierra-L\xe9one"===e.country)||t[0],[x,f]=(0,s.useState)(""),[y,j]=(0,s.useState)(!1),[v,w]=(0,s.useState)(-1),[N,k]=(0,s.useState)((null==g?void 0:g.country)||(null==(r=t[0])?void 0:r.country)||""),[C,S]=(0,s.useState)(""),[A,P]=(0,s.useState)([]),[R,L]=(0,s.useState)([]),[D,T]=(0,s.useState)(g||t[0]||null),[I,M]=(0,s.useState)({images:[],pdfs:[]}),[z,F]=(0,s.useState)(!1),[V,G]=(0,s.useState)(!1),[B,q]=(0,s.useState)("modify"),[W,$]=(0,s.useState)(!1),[_,H]=(0,s.useState)(!1),[K,Q]=(0,s.useState)(!1),[J,X]=(0,s.useState)("photos"),[Z,Y]=(0,s.useState)(!1),[ee,er]=(0,s.useState)(null),[et,ea]=(0,s.useState)(0),[es,el]=(0,s.useState)(0),[ei,en]=(0,s.useState)(0),[eo,ed]=(0,s.useState)(null),ec=E("DashboardClient"),eg=(0,s.useCallback)(()=>el(e=>e+1),[]),ex=(0,s.useCallback)((e,r)=>{ed([e,r]),en(e=>e+1)},[]),eu=(0,s.useMemo)(()=>Array.from(new Set(t.map(e=>e.country).filter(Boolean).filter(e=>"Syst\xe8me"!==e))).sort(),[t]),em=Object.values(n),eh=Object.values(o),ep=(0,s.useMemo)(()=>t.filter(e=>!("Syst\xe8me"===e.country||N&&e.country!==N||x.trim()&&!e.name.toLowerCase().includes(x.toLowerCase()))&&(!(A.length>0)||!!A.includes(e.type))&&(!(R.length>0)||!!R.includes(e.status))),[t,N,x,A,R]),{flagDoc:eb,logoDoc:ef,pinDoc:ey}=(0,s.useMemo)(()=>{let e=(null==D?void 0:D.documents)||[];return{flagDoc:e.find(e=>e.type===d.FLAG),logoDoc:e.find(e=>e.type===d.CLIENT_LOGO||e.name.replace(/_/g," ").toLowerCase().includes("logo")),pinDoc:e.find(e=>e.type===d.PIN)}},[D]);(0,s.useEffect)(()=>{if(ep.length>0){let e=D&&ep.some(e=>e.id===D.id);if(D&&e){let e=ep.find(e=>e.id===D.id);e&&e!==D&&T(e)}else T(ep[0])}else T(null)},[ep,D]);let ej=(0,s.useCallback)(async e=>{F(!0);try{let r=await i(e);M(r)}catch(e){ec.error("Error fetching media:",e),M({images:[],pdfs:[]})}finally{F(!1)}},[ec]);(0,s.useEffect)(()=>{D?ej(D.name):M({images:[],pdfs:[]})},[D,ej]);let ev=(0,s.useMemo)(()=>{let e=t.filter(e=>"Syst\xe8me"!==e.country);return N&&(e=e.filter(e=>e.country===N)),e.map(e=>e.name).sort()},[t,N]),ew=(0,s.useMemo)(()=>t.filter(e=>"Syst\xe8me"!==e.country&&(!N||e.country===N)&&(!(A.length>0)||!!A.includes(e.type))&&(!(R.length>0)||!!R.includes(e.status))),[t,N,A,R]),eN=(0,s.useCallback)(e=>{T(e),k(e.country||""),S(e.name),ea(Date.now())},[]),ek=(0,s.useMemo)(()=>x.trim()?t.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())).slice(0,5):[],[x,t]),eC=e=>{let r=e.country===N;f(""),S(e.name),k(e.country||""),T(e),e.status&&L([e.status]),e.type&&P([e.type]),ea(Date.now()),r?ex(e.latitude,e.longitude):eg(),j(!1),w(-1)},eS=e=>{k(e),S(""),T(null),f(""),P(Object.values(n)),L(Object.values(o)),eg()},[eA,eE]=(0,s.useState)(!0);return(0,a.jsxs)(O.A,{user:l,onManageUsers:()=>$(!0),onManageProjects:e=>{q(e),G(!0)},onManageFiles:()=>H(!0),onManageMedia:e=>{e&&X(e),Q(!0)},children:[(0,a.jsxs)("div",{className:"mx-auto max-w-[1800px] px-2 sm:px-4 py-6 lg:py-10",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-black tracking-tight text-gray-900 dark:text-white uppercase",children:"Dashboard"}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm leading-6 text-gray-500 dark:text-gray-400",children:"Recherche et filtrage des projets."})]}),(0,a.jsx)(r4,{countries:eu,availableNames:ev,types:em,statuses:eh,selectedCountry:N,setSelectedCountry:k,selectedName:C,setSelectedName:S,selectedTypes:A,setSelectedTypes:P,selectedStatuses:R,setSelectedStatuses:L,searchQuery:x,setSearchQuery:f,showSuggestions:y,setShowSuggestions:j,searchSuggestions:ek,focusedSuggestionIndex:v,setFocusedSuggestionIndex:w,onSearchSelect:eC,handleKeyDown:e=>{y&&0!==ek.length&&("ArrowDown"===e.key?(e.preventDefault(),w(e=>(e+1)%ek.length)):"ArrowUp"===e.key?(e.preventDefault(),w(e=>(e-1+ek.length)%ek.length)):"Enter"===e.key?(e.preventDefault(),v>=0&&eC(ek[v])):"Escape"===e.key&&j(!1))},resetFilters:()=>{k(""),S(""),P(Object.values(n)),L(Object.values(o)),f(""),eg()},initialProjects:t,selectedProject:D,triggerFit:eg,onCountryChange:eS,onNameChange:e=>{S(e);let r=t.find(r=>r.name===e);if(r){let e=r.country===N;T(r),k(r.country||""),r.status&&L([r.status]),r.type&&P([r.type]),ea(Date.now()),e?ex(r.latitude,r.longitude):eg()}else f(""),T(null),L(Object.values(o)),P(Object.values(n))},onToggleType:e=>{P(r=>r.includes(e)?1===r.length?r:r.filter(r=>r!==e):[...r,e]),eg()},onToggleStatus:e=>{L(r=>r.includes(e)?1===r.length?r:r.filter(r=>r!==e):[...r,e]),eg()}}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 lg:px-3 lg:py-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 h-[400px] lg:h-[600px] flex flex-col relative overflow-hidden transition-colors",children:[(0,a.jsx)("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1",children:"Carte Globale"}),(0,a.jsx)("div",{className:"flex-grow relative w-full overflow-hidden rounded-xl border border-gray-100 dark:border-gray-700",children:(0,a.jsx)(u,{projects:ew,onSelectProject:eN,selectedProjectId:null==D?void 0:D.id,fitNonce:es,globalCenterNonce:ei,globalCenterPoint:eo})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 lg:px-3 lg:py-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 h-[400px] lg:h-[600px] flex flex-col relative overflow-hidden transition-colors",children:[(0,a.jsxs)("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1 truncate",children:["Projet : ",(null==D?void 0:D.name)||"Aucun"]}),(0,a.jsx)("div",{className:"flex-grow relative bg-gray-50 dark:bg-gray-900 rounded-xl w-full overflow-hidden border border-gray-100 dark:border-gray-700",children:D?(0,a.jsx)(m.default,{latitude:D.latitude,longitude:D.longitude,projectName:D.name,country:D.country||"",popupText:D.name,status:D.status,customPinUrl:null==ey?void 0:ey.url,nonce:et}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 dark:text-gray-500 text-sm",children:"S\xe9lectionnez un projet pour voir sa position."})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-6 h-full min-w-0",children:[(0,a.jsx)(te,{selectedProject:D}),(0,a.jsx)(tr,{selectedProject:D,flagDoc:eb,logoDoc:ef})]}),(0,a.jsx)(td,{selectedProject:D,dynamicImages:I.images,videos:(null==D?void 0:D.videos)||[],isLoading:z},(null==D?void 0:D.id)||"no-project")]}),I.pdfs.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 mb-6",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden transition-all duration-300",children:[(0,a.jsxs)("button",{onClick:()=>eE(!eA),className:"w-full border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 px-4 py-3 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-900 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"w-4 h-4 text-blue-500"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Documents & Plans"})]}),(0,a.jsx)("div",{className:"flex items-center text-gray-400",children:eA?(0,a.jsx)(p.A,{className:"w-4 h-4"}):(0,a.jsx)(b.A,{className:"w-4 h-4"})})]}),!eA&&(0,a.jsx)("div",{className:"p-0 animate-in fade-in slide-in-from-top-2 duration-300",children:(0,a.jsx)(tc,{documents:I.pdfs})})]})}),(0,a.jsx)(tm,{filteredProjects:ep,selectedProject:D,handleProjectSelect:eN,onExportClick:(e,r)=>{e.stopPropagation(),eN(r),er(r),Y(!0)},searchQuery:x,setSearchQuery:f,selectedCountry:N,onCountryChange:eS,selectedTypes:A,selectedStatuses:R}),(0,a.jsxs)("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400 text-right",children:[ep.length," projets trouv\xe9s"]})]}),(0,a.jsx)(eF,{projects:t,isOpen:V,onClose:()=>G(!1),userRole:l.role||c.UserRole.VISITOR,defaultTab:B}),(0,a.jsx)(eK,{isOpen:_,isAdmin:"ADMIN"===l.role,onClose:()=>H(!1)}),(0,a.jsx)(r_,{isOpen:K,onClose:()=>Q(!1),projects:t,defaultTab:J}),(0,a.jsx)(r5,{isAdmin:"ADMIN"===l.role,isOpen:W,onClose:()=>$(!1)}),(0,a.jsx)(U,{isOpen:Z,onClose:()=>Y(!1),project:ee,allProjects:t,filteredProjects:ew,images:I.images,globalMetadata:{appVersion:"1.0.0",buildDate:new Date().toISOString()}})]})}},84885:(e,r,t)=>{"use strict";t.d(r,{default:()=>l});var a=t(95155);let s=(0,t(67909).default)(()=>Promise.all([t.e(4804),t.e(1761),t.e(399)]).then(t.bind(t,40399)),{loadableGenerated:{webpack:()=>[40399]},ssr:!1,loading:()=>(0,a.jsx)("p",{className:"flex items-center justify-center h-full text-gray-500",children:"Chargement de la carte..."})});function l(e){var r,t,l,i;return(0,a.jsx)(s,{...e,status:null!=(r=e.status)?r:null,projectName:null!=(t=e.projectName)?t:"Projet sans nom",country:null!=(l=e.country)?l:"",customPinUrl:null!=(i=e.customPinUrl)?i:null})}}},e=>{e.O(0,[5033,3930,1356,2619,1426,3231,2957,5823,8441,1255,7358],()=>e(e.s=29644)),_N_E=e.O()}]);